!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=101)}([function(t,e,r){"use strict";r.d(e,"a",(function(){return u})),r.d(e,"b",(function(){return h}));var i=r(13),n=r(1),s=r(2),o=r(4);const a=Array;class u extends a{get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get magnitude(){return Math.hypot(...this)}get magnitudeSqr(){return this[0]*this[0]+this[1]*this[1]}get normalized(){const t=this.magnitude;return 0==t?h.zero():this.clone().div(h(t,t))}get negative(){return this.clone().negate()}get inversed(){return this.clone().inverse()}get isZero(){return 0===this.x&&0===this.y}constructor(t,e){super(t,e)}static zero(){return new u(0,0)}static one(){return new u(1,1)}static up(){return new u(0,1)}static down(){return new u(0,-1)}static left(){return new u(-1,0)}static right(){return new u(1,0)}static distance(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}static distanceSquared(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)}static math(t){return(...e)=>h(t(...e.map(t=>t.x)),t(...e.map(t=>t.y)))}asMut(){return this}plus(t){return h.plus(this,this,t)}minus(t){return h.minus(this,this,t)}mul(t){return h.mul(this,this,t)}div(t){return h.div(this,this,t)}dot(t){return this[0]*t[0]+this[1]*t[1]}normalize(){return h.normalize(this,this)}inverse(){return this[0]=1/this[0],this[1]=1/this[1],this}negate(){return this[0]=-this[0],this[1]=-this[1],this}oneMinus(){return this[0]=1-this[0],this[1]=1-this[1],this}equals(t){return void 0!==t&&(t[0]===this[0]&&t[1]===this[1])}clone(t=h.zero()){return t.set(this)}set(t){return this[0]=t[0]||0,this[1]=t[1]||0,this}fill(t){return this[0]=this[1]=t,this}toVec3(t=0){return Object(n.b)(this[0],this[1],t)}__to(t){switch(t){case i.a:return Object(i.b)(this[0],this[1],0,0);case n.a:return Object(n.b)(this[0],this[1],0)}return this.clone()}}function h(t,e=t){return new u(t,e)}h.from=t=>{const[e=0,r=0]=t;return h(e,r)},h.floor=t=>h(Math.floor(t.x),Math.floor(t.y)),h.zero=u.zero,h.one=u.one,h.left=u.left,h.right=u.right,h.down=u.down,h.up=u.up,h.math=u.math,h.plus=Object(s.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]+r,t[1]=e[1]+r):(t[0]=e[0]+r[0],t[1]=e[1]+(r[1]||0)),t),2,h.zero),h.minus=Object(s.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]-r,t[1]=e[1]-r):(t[0]=e[0]-r[0],t[1]=e[1]-(r[1]||0)),t),2,h.zero),h.mul=Object(s.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]*r,t[1]=e[1]*r):(t[0]=e[0]*r[0],t[1]=e[1]*r[1]),t),2,h.zero),h.div=Object(s.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]/r,t[1]=e[1]/r):(t[0]=e[0]/r[0],t[1]=e[1]/r[1]),t),2,h.zero),h.exp=Object(s.b)((t,e)=>("number"==typeof e?(t[0]=Math.exp(e),t[1]=Math.exp(e)):(t[0]=Math.exp(e[0]),t[1]=Math.exp(e[1])),t),1,h.zero),h.inverse=Object(s.b)((t,e)=>(t[0]=1/e[0],t[1]=1/e[1],t),1,h.zero),h.dot=(t,e)=>t[0]*e[0]+t[1]*e[1],h.cross=(t,e)=>t[0]*e[1]-t[1]*e[0],h.normalize=Object(s.b)(o.d.normalize,1,h.zero),h.perpendicular=Object(s.b)((t,e)=>(t[0]=-e[1],t[1]=e[0],t),1,h.zero),h.set=Object(s.b)((t,e)=>(t[0]=e[0],t[1]=e[1],t),1,h.zero),h.fill=Object(s.b)((t,e)=>(t[0]=t[1]=e,t),1,h.zero)},function(t,e,r){"use strict";r.d(e,"a",(function(){return u})),r.d(e,"b",(function(){return h}));var i=r(13),n=r(0),s=r(2),o=r(4);const a=Array;class u extends a{get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get magnitude(){return Math.hypot(...this)}get normalized(){const t=this.magnitude;return 0==t?h.zero():this.clone().div(h(t,t,t))}get negative(){return this.clone().negate()}get inversed(){return this.clone().inverse()}constructor(t,e,r){super(t,e,r)}static zero(){return new u(0,0,0)}static one(){return new u(1,1,1)}asMut(){return this}plus(t){return h.plus(this,this,t)}minus(t){return h.minus(this,this,t)}mul(t){return h.mul(this,this,t)}div(t){return h.div(this,this,t)}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}normalize(){return h.normalize(this,this)}inverse(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this}negate(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this}cross(t){return h(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}set(t){return this[0]=t[0]||0,this[1]=t[1]||0,this[2]=t[2]||0,this}fill(t){return this[0]=this[1]=this[2]=t,this}clone(t=h.zero()){return t.set(this)}setX(t){return this[0]=t,this}setY(t){return this[1]=t,this}setZ(t){return this[2]=t,this}toVec2(){return Object(n.b)(this[0],this[1])}equals(t){return void 0!==t&&(t[0]===this[0]&&t[1]===this[1]&&t[2]===this[2])}static math(t){return(...e)=>h(t(...e.map(t=>t.x)),t(...e.map(t=>t.y)),t(...e.map(t=>t.z)))}static mathNonAlloc(t,e,...r){return e[0]=t(...r.map(t=>t[0])),e[1]=t(...r.map(t=>t[1])),e[2]=t(...r.map(t=>t[2])),e}__to(t){switch(t){case i.a:return Object(i.b)(this[0],this[1],this[2],0);case n.a:return Object(n.b)(this[0],this[1])}return this.clone()}}function h(t,e=t,r=t){return new u(t,e,r)}h.from=t=>{const[e=0,r=0,i=0]=t;return h(e,r,i)},h.zero=u.zero,h.one=u.one,h.math=u.math,h.normalize=Object(s.b)(o.e.normalize,1,h.zero),h.inverse=Object(s.b)(o.e.inverse,1,h.zero),h.negate=Object(s.b)(o.e.negate,1,h.zero),h.plus=Object(s.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]+r,t[1]=e[1]+r,t[2]=e[2]+r):(t[0]=e[0]+r[0],t[1]=e[1]+(r[1]||0),t[2]=e[2]+(r[2]||0)),t),2,h.zero),h.minus=Object(s.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]-r,t[1]=e[1]-r,t[2]=e[2]-r):(t[0]=e[0]-r[0],t[1]=e[1]-(r[1]||0),t[2]=e[2]-(r[2]||0)),t),2,h.zero),h.mul=Object(s.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r):(t[0]=e[0]*r[0],t[1]=e[1]*(void 0===r[1]?1:r[1]),t[2]=e[2]*(void 0===r[2]?1:r[2])),t),2,h.zero),h.div=Object(s.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=e[0]/r[0],t[1]=e[1]/(void 0===r[1]?1:r[1]),t[2]=e[2]/(void 0===r[2]?1:r[2])),t),2,h.zero),h.set=Object(s.b)((t,e)=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t),1,h.zero),h.fill=Object(s.b)((t,e)=>(t[0]=t[1]=t[2]=e,t),1,h.zero)},function(t,e,r){"use strict";function i(t,e,r){return(...i)=>{if(i.length<=e){const e=r();return t(e,...i)}{let[e,...n]=i;return void 0===e&&(e=r()),t(e,...n)}}}r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return n}));Math.log(.01);const n={lerp:(t,e,r)=>(e-t)*r+t,linstep:(t,e,r)=>n.clamp((r-t)/(e-t),0,1),smoothStep(t,e,r){const i=n.linstep(t,e,r);return i*i*(3-2*i)},clamp:(t,e,r)=>Math.min(Math.max(t,e),r),mapClamped(t,e,r,i,s){const o=this.linstep(t,e,s);return n.lerp(r,i,o)},damp:function(t,e,r,i,s=.01,o=-Math.log(s)){const a=o/r,u=Math.exp(-i*a);return n.lerp(t,e,1-u)}}},function(t,e,r){"use strict";r.d(e,"c",(function(){return n})),r.d(e,"e",(function(){return a})),r.d(e,"d",(function(){return u})),r.d(e,"b",(function(){return h})),r.d(e,"a",(function(){return c}));var i=r(36);class n{constructor(){this.gl=null,this.width=0,this.height=0,this.assets=null,this.renderer=null}}let s,o=new class extends i.a{drawLine(t,e,r){}};const a=t=>s=t,u=()=>s,h=()=>{var t;return null===(t=u())||void 0===t?void 0:t.gl},c=t=>(t&&(o=t),o)},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return u})),r.d(e,"e",(function(){return s})),r.d(e,"f",(function(){return o}));var i={};r.r(i),r.d(i,"EPSILON",(function(){return h})),r.d(i,"ARRAY_TYPE",(function(){return c})),r.d(i,"RANDOM",(function(){return l})),r.d(i,"setMatrixArrayType",(function(){return d})),r.d(i,"toRadian",(function(){return m})),r.d(i,"equals",(function(){return p}));var n={};r.r(n),r.d(n,"create",(function(){return b})),r.d(n,"clone",(function(){return v})),r.d(n,"copy",(function(){return g})),r.d(n,"fromValues",(function(){return y})),r.d(n,"set",(function(){return x})),r.d(n,"identity",(function(){return w})),r.d(n,"transpose",(function(){return M})),r.d(n,"invert",(function(){return O})),r.d(n,"adjoint",(function(){return R})),r.d(n,"determinant",(function(){return T})),r.d(n,"multiply",(function(){return _})),r.d(n,"translate",(function(){return A})),r.d(n,"scale",(function(){return E})),r.d(n,"rotate",(function(){return S})),r.d(n,"rotateX",(function(){return j})),r.d(n,"rotateY",(function(){return P})),r.d(n,"rotateZ",(function(){return z})),r.d(n,"fromTranslation",(function(){return F})),r.d(n,"fromScaling",(function(){return C})),r.d(n,"fromRotation",(function(){return L})),r.d(n,"fromXRotation",(function(){return D})),r.d(n,"fromYRotation",(function(){return B})),r.d(n,"fromZRotation",(function(){return I})),r.d(n,"fromRotationTranslation",(function(){return k})),r.d(n,"fromQuat2",(function(){return U})),r.d(n,"getTranslation",(function(){return G})),r.d(n,"getScaling",(function(){return N})),r.d(n,"getRotation",(function(){return V})),r.d(n,"fromRotationTranslationScale",(function(){return W})),r.d(n,"fromRotationTranslationScaleOrigin",(function(){return q})),r.d(n,"fromQuat",(function(){return H})),r.d(n,"frustum",(function(){return K})),r.d(n,"perspective",(function(){return Y})),r.d(n,"perspectiveFromFieldOfView",(function(){return X})),r.d(n,"ortho",(function(){return Q})),r.d(n,"lookAt",(function(){return Z})),r.d(n,"targetTo",(function(){return $})),r.d(n,"str",(function(){return J})),r.d(n,"frob",(function(){return tt})),r.d(n,"add",(function(){return et})),r.d(n,"subtract",(function(){return rt})),r.d(n,"multiplyScalar",(function(){return it})),r.d(n,"multiplyScalarAndAdd",(function(){return nt})),r.d(n,"exactEquals",(function(){return st})),r.d(n,"equals",(function(){return ot})),r.d(n,"mul",(function(){return at})),r.d(n,"sub",(function(){return ut}));var s={};r.r(s),r.d(s,"create",(function(){return ht})),r.d(s,"clone",(function(){return ct})),r.d(s,"length",(function(){return lt})),r.d(s,"fromValues",(function(){return dt})),r.d(s,"copy",(function(){return ft})),r.d(s,"set",(function(){return mt})),r.d(s,"add",(function(){return pt})),r.d(s,"subtract",(function(){return bt})),r.d(s,"multiply",(function(){return vt})),r.d(s,"divide",(function(){return gt})),r.d(s,"ceil",(function(){return yt})),r.d(s,"floor",(function(){return xt})),r.d(s,"min",(function(){return wt})),r.d(s,"max",(function(){return Mt})),r.d(s,"round",(function(){return Ot})),r.d(s,"scale",(function(){return Rt})),r.d(s,"scaleAndAdd",(function(){return Tt})),r.d(s,"distance",(function(){return _t})),r.d(s,"squaredDistance",(function(){return At})),r.d(s,"squaredLength",(function(){return Et})),r.d(s,"negate",(function(){return St})),r.d(s,"inverse",(function(){return jt})),r.d(s,"normalize",(function(){return Pt})),r.d(s,"dot",(function(){return zt})),r.d(s,"cross",(function(){return Ft})),r.d(s,"lerp",(function(){return Ct})),r.d(s,"hermite",(function(){return Lt})),r.d(s,"bezier",(function(){return Dt})),r.d(s,"random",(function(){return Bt})),r.d(s,"transformMat4",(function(){return It})),r.d(s,"transformMat3",(function(){return kt})),r.d(s,"transformQuat",(function(){return Ut})),r.d(s,"rotateX",(function(){return Gt})),r.d(s,"rotateY",(function(){return Nt})),r.d(s,"rotateZ",(function(){return Vt})),r.d(s,"angle",(function(){return Wt})),r.d(s,"zero",(function(){return qt})),r.d(s,"str",(function(){return Ht})),r.d(s,"exactEquals",(function(){return Kt})),r.d(s,"equals",(function(){return Yt})),r.d(s,"sub",(function(){return Qt})),r.d(s,"mul",(function(){return Zt})),r.d(s,"div",(function(){return $t})),r.d(s,"dist",(function(){return Jt})),r.d(s,"sqrDist",(function(){return te})),r.d(s,"len",(function(){return ee})),r.d(s,"sqrLen",(function(){return re})),r.d(s,"forEach",(function(){return ie}));var o={};r.r(o),r.d(o,"create",(function(){return ne})),r.d(o,"clone",(function(){return se})),r.d(o,"fromValues",(function(){return oe})),r.d(o,"copy",(function(){return ae})),r.d(o,"set",(function(){return ue})),r.d(o,"add",(function(){return he})),r.d(o,"subtract",(function(){return ce})),r.d(o,"multiply",(function(){return le})),r.d(o,"divide",(function(){return de})),r.d(o,"ceil",(function(){return fe})),r.d(o,"floor",(function(){return me})),r.d(o,"min",(function(){return pe})),r.d(o,"max",(function(){return be})),r.d(o,"round",(function(){return ve})),r.d(o,"scale",(function(){return ge})),r.d(o,"scaleAndAdd",(function(){return ye})),r.d(o,"distance",(function(){return xe})),r.d(o,"squaredDistance",(function(){return we})),r.d(o,"length",(function(){return Me})),r.d(o,"squaredLength",(function(){return Oe})),r.d(o,"negate",(function(){return Re})),r.d(o,"inverse",(function(){return Te})),r.d(o,"normalize",(function(){return _e})),r.d(o,"dot",(function(){return Ae})),r.d(o,"cross",(function(){return Ee})),r.d(o,"lerp",(function(){return Se})),r.d(o,"random",(function(){return je})),r.d(o,"transformMat4",(function(){return Pe})),r.d(o,"transformQuat",(function(){return ze})),r.d(o,"zero",(function(){return Fe})),r.d(o,"str",(function(){return Ce})),r.d(o,"exactEquals",(function(){return Le})),r.d(o,"equals",(function(){return De})),r.d(o,"sub",(function(){return Be})),r.d(o,"mul",(function(){return Ie})),r.d(o,"div",(function(){return ke})),r.d(o,"dist",(function(){return Ue})),r.d(o,"sqrDist",(function(){return Ge})),r.d(o,"len",(function(){return Ne})),r.d(o,"sqrLen",(function(){return Ve})),r.d(o,"forEach",(function(){return We}));var a={};r.r(a),r.d(a,"create",(function(){return qe})),r.d(a,"identity",(function(){return He})),r.d(a,"setAxisAngle",(function(){return Ke})),r.d(a,"getAxisAngle",(function(){return Ye})),r.d(a,"getAngle",(function(){return Xe})),r.d(a,"multiply",(function(){return Qe})),r.d(a,"rotateX",(function(){return Ze})),r.d(a,"rotateY",(function(){return $e})),r.d(a,"rotateZ",(function(){return Je})),r.d(a,"calculateW",(function(){return tr})),r.d(a,"exp",(function(){return er})),r.d(a,"ln",(function(){return rr})),r.d(a,"pow",(function(){return ir})),r.d(a,"slerp",(function(){return nr})),r.d(a,"random",(function(){return sr})),r.d(a,"invert",(function(){return or})),r.d(a,"conjugate",(function(){return ar})),r.d(a,"fromMat3",(function(){return ur})),r.d(a,"fromEuler",(function(){return hr})),r.d(a,"str",(function(){return cr})),r.d(a,"clone",(function(){return gr})),r.d(a,"fromValues",(function(){return yr})),r.d(a,"copy",(function(){return xr})),r.d(a,"set",(function(){return wr})),r.d(a,"add",(function(){return Mr})),r.d(a,"mul",(function(){return Or})),r.d(a,"scale",(function(){return Rr})),r.d(a,"dot",(function(){return Tr})),r.d(a,"lerp",(function(){return _r})),r.d(a,"length",(function(){return Ar})),r.d(a,"len",(function(){return Er})),r.d(a,"squaredLength",(function(){return Sr})),r.d(a,"sqrLen",(function(){return jr})),r.d(a,"normalize",(function(){return Pr})),r.d(a,"exactEquals",(function(){return zr})),r.d(a,"equals",(function(){return Fr})),r.d(a,"rotationTo",(function(){return Cr})),r.d(a,"sqlerp",(function(){return Lr})),r.d(a,"setAxes",(function(){return Dr}));var u={};r.r(u),r.d(u,"create",(function(){return Br})),r.d(u,"clone",(function(){return Ir})),r.d(u,"fromValues",(function(){return kr})),r.d(u,"copy",(function(){return Ur})),r.d(u,"set",(function(){return Gr})),r.d(u,"add",(function(){return Nr})),r.d(u,"subtract",(function(){return Vr})),r.d(u,"multiply",(function(){return Wr})),r.d(u,"divide",(function(){return qr})),r.d(u,"ceil",(function(){return Hr})),r.d(u,"floor",(function(){return Kr})),r.d(u,"min",(function(){return Yr})),r.d(u,"max",(function(){return Xr})),r.d(u,"round",(function(){return Qr})),r.d(u,"scale",(function(){return Zr})),r.d(u,"scaleAndAdd",(function(){return $r})),r.d(u,"distance",(function(){return Jr})),r.d(u,"squaredDistance",(function(){return ti})),r.d(u,"length",(function(){return ei})),r.d(u,"squaredLength",(function(){return ri})),r.d(u,"negate",(function(){return ii})),r.d(u,"inverse",(function(){return ni})),r.d(u,"normalize",(function(){return si})),r.d(u,"dot",(function(){return oi})),r.d(u,"cross",(function(){return ai})),r.d(u,"lerp",(function(){return ui})),r.d(u,"random",(function(){return hi})),r.d(u,"transformMat2",(function(){return ci})),r.d(u,"transformMat2d",(function(){return li})),r.d(u,"transformMat3",(function(){return di})),r.d(u,"transformMat4",(function(){return fi})),r.d(u,"rotate",(function(){return mi})),r.d(u,"angle",(function(){return pi})),r.d(u,"zero",(function(){return bi})),r.d(u,"str",(function(){return vi})),r.d(u,"exactEquals",(function(){return gi})),r.d(u,"equals",(function(){return yi})),r.d(u,"len",(function(){return xi})),r.d(u,"sub",(function(){return wi})),r.d(u,"mul",(function(){return Mi})),r.d(u,"div",(function(){return Oi})),r.d(u,"dist",(function(){return Ri})),r.d(u,"sqrDist",(function(){return Ti})),r.d(u,"sqrLen",(function(){return _i})),r.d(u,"forEach",(function(){return Ai}));var h=1e-6,c="undefined"!=typeof Float32Array?Float32Array:Array,l=Math.random;function d(t){c=t}var f=Math.PI/180;function m(t){return t*f}function p(t,e){return Math.abs(t-e)<=h*Math.max(1,Math.abs(t),Math.abs(e))}function b(){var t=new c(16);return c!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function v(t){var e=new c(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function g(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function y(t,e,r,i,n,s,o,a,u,h,l,d,f,m,p,b){var v=new c(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=n,v[5]=s,v[6]=o,v[7]=a,v[8]=u,v[9]=h,v[10]=l,v[11]=d,v[12]=f,v[13]=m,v[14]=p,v[15]=b,v}function x(t,e,r,i,n,s,o,a,u,h,c,l,d,f,m,p,b){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=h,t[9]=c,t[10]=l,t[11]=d,t[12]=f,t[13]=m,t[14]=p,t[15]=b,t}function w(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function O(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],d=e[10],f=e[11],m=e[12],p=e[13],b=e[14],v=e[15],g=r*a-i*o,y=r*u-n*o,x=r*h-s*o,w=i*u-n*a,M=i*h-s*a,O=n*h-s*u,R=c*p-l*m,T=c*b-d*m,_=c*v-f*m,A=l*b-d*p,E=l*v-f*p,S=d*v-f*b,j=g*S-y*E+x*A+w*_-M*T+O*R;return j?(j=1/j,t[0]=(a*S-u*E+h*A)*j,t[1]=(n*E-i*S-s*A)*j,t[2]=(p*O-b*M+v*w)*j,t[3]=(d*M-l*O-f*w)*j,t[4]=(u*_-o*S-h*T)*j,t[5]=(r*S-n*_+s*T)*j,t[6]=(b*x-m*O-v*y)*j,t[7]=(c*O-d*x+f*y)*j,t[8]=(o*E-a*_+h*R)*j,t[9]=(i*_-r*E-s*R)*j,t[10]=(m*M-p*x+v*g)*j,t[11]=(l*x-c*M-f*g)*j,t[12]=(a*T-o*A-u*R)*j,t[13]=(r*A-i*T+n*R)*j,t[14]=(p*y-m*w-b*g)*j,t[15]=(c*w-l*y+d*g)*j,t):null}function R(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],d=e[10],f=e[11],m=e[12],p=e[13],b=e[14],v=e[15];return t[0]=a*(d*v-f*b)-l*(u*v-h*b)+p*(u*f-h*d),t[1]=-(i*(d*v-f*b)-l*(n*v-s*b)+p*(n*f-s*d)),t[2]=i*(u*v-h*b)-a*(n*v-s*b)+p*(n*h-s*u),t[3]=-(i*(u*f-h*d)-a*(n*f-s*d)+l*(n*h-s*u)),t[4]=-(o*(d*v-f*b)-c*(u*v-h*b)+m*(u*f-h*d)),t[5]=r*(d*v-f*b)-c*(n*v-s*b)+m*(n*f-s*d),t[6]=-(r*(u*v-h*b)-o*(n*v-s*b)+m*(n*h-s*u)),t[7]=r*(u*f-h*d)-o*(n*f-s*d)+c*(n*h-s*u),t[8]=o*(l*v-f*p)-c*(a*v-h*p)+m*(a*f-h*l),t[9]=-(r*(l*v-f*p)-c*(i*v-s*p)+m*(i*f-s*l)),t[10]=r*(a*v-h*p)-o*(i*v-s*p)+m*(i*h-s*a),t[11]=-(r*(a*f-h*l)-o*(i*f-s*l)+c*(i*h-s*a)),t[12]=-(o*(l*b-d*p)-c*(a*b-u*p)+m*(a*d-u*l)),t[13]=r*(l*b-d*p)-c*(i*b-n*p)+m*(i*d-n*l),t[14]=-(r*(a*b-u*p)-o*(i*b-n*p)+m*(i*u-n*a)),t[15]=r*(a*d-u*l)-o*(i*d-n*l)+c*(i*u-n*a),t}function T(t){var e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8],c=t[9],l=t[10],d=t[11],f=t[12],m=t[13],p=t[14],b=t[15];return(e*o-r*s)*(l*b-d*p)-(e*a-i*s)*(c*b-d*m)+(e*u-n*s)*(c*p-l*m)+(r*a-i*o)*(h*b-d*f)-(r*u-n*o)*(h*p-l*f)+(i*u-n*a)*(h*m-c*f)}function _(t,e,r){var i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],d=e[9],f=e[10],m=e[11],p=e[12],b=e[13],v=e[14],g=e[15],y=r[0],x=r[1],w=r[2],M=r[3];return t[0]=y*i+x*a+w*l+M*p,t[1]=y*n+x*u+w*d+M*b,t[2]=y*s+x*h+w*f+M*v,t[3]=y*o+x*c+w*m+M*g,y=r[4],x=r[5],w=r[6],M=r[7],t[4]=y*i+x*a+w*l+M*p,t[5]=y*n+x*u+w*d+M*b,t[6]=y*s+x*h+w*f+M*v,t[7]=y*o+x*c+w*m+M*g,y=r[8],x=r[9],w=r[10],M=r[11],t[8]=y*i+x*a+w*l+M*p,t[9]=y*n+x*u+w*d+M*b,t[10]=y*s+x*h+w*f+M*v,t[11]=y*o+x*c+w*m+M*g,y=r[12],x=r[13],w=r[14],M=r[15],t[12]=y*i+x*a+w*l+M*p,t[13]=y*n+x*u+w*d+M*b,t[14]=y*s+x*h+w*f+M*v,t[15]=y*o+x*c+w*m+M*g,t}function A(t,e,r){var i,n,s,o,a,u,h,c,l,d,f,m,p=r[0],b=r[1],v=r[2];return e===t?(t[12]=e[0]*p+e[4]*b+e[8]*v+e[12],t[13]=e[1]*p+e[5]*b+e[9]*v+e[13],t[14]=e[2]*p+e[6]*b+e[10]*v+e[14],t[15]=e[3]*p+e[7]*b+e[11]*v+e[15]):(i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],d=e[9],f=e[10],m=e[11],t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=d,t[10]=f,t[11]=m,t[12]=i*p+a*b+l*v+e[12],t[13]=n*p+u*b+d*v+e[13],t[14]=s*p+h*b+f*v+e[14],t[15]=o*p+c*b+m*v+e[15]),t}function E(t,e,r){var i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function S(t,e,r,i){var n,s,o,a,u,c,l,d,f,m,p,b,v,g,y,x,w,M,O,R,T,_,A,E,S=i[0],j=i[1],P=i[2],z=Math.hypot(S,j,P);return z<h?null:(S*=z=1/z,j*=z,P*=z,n=Math.sin(r),o=1-(s=Math.cos(r)),a=e[0],u=e[1],c=e[2],l=e[3],d=e[4],f=e[5],m=e[6],p=e[7],b=e[8],v=e[9],g=e[10],y=e[11],x=S*S*o+s,w=j*S*o+P*n,M=P*S*o-j*n,O=S*j*o-P*n,R=j*j*o+s,T=P*j*o+S*n,_=S*P*o+j*n,A=j*P*o-S*n,E=P*P*o+s,t[0]=a*x+d*w+b*M,t[1]=u*x+f*w+v*M,t[2]=c*x+m*w+g*M,t[3]=l*x+p*w+y*M,t[4]=a*O+d*R+b*T,t[5]=u*O+f*R+v*T,t[6]=c*O+m*R+g*T,t[7]=l*O+p*R+y*T,t[8]=a*_+d*A+b*E,t[9]=u*_+f*A+v*E,t[10]=c*_+m*A+g*E,t[11]=l*_+p*A+y*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function j(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],a=e[6],u=e[7],h=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+h*i,t[5]=o*n+c*i,t[6]=a*n+l*i,t[7]=u*n+d*i,t[8]=h*n-s*i,t[9]=c*n-o*i,t[10]=l*n-a*i,t[11]=d*n-u*i,t}function P(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],u=e[3],h=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-h*i,t[1]=o*n-c*i,t[2]=a*n-l*i,t[3]=u*n-d*i,t[8]=s*i+h*n,t[9]=o*i+c*n,t[10]=a*i+l*n,t[11]=u*i+d*n,t}function z(t,e,r){var i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],u=e[3],h=e[4],c=e[5],l=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+h*i,t[1]=o*n+c*i,t[2]=a*n+l*i,t[3]=u*n+d*i,t[4]=h*n-s*i,t[5]=c*n-o*i,t[6]=l*n-a*i,t[7]=d*n-u*i,t}function F(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function C(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,e,r){var i,n,s,o=r[0],a=r[1],u=r[2],c=Math.hypot(o,a,u);return c<h?null:(o*=c=1/c,a*=c,u*=c,i=Math.sin(e),s=1-(n=Math.cos(e)),t[0]=o*o*s+n,t[1]=a*o*s+u*i,t[2]=u*o*s-a*i,t[3]=0,t[4]=o*a*s-u*i,t[5]=a*a*s+n,t[6]=u*a*s+o*i,t[7]=0,t[8]=o*u*s+a*i,t[9]=a*u*s-o*i,t[10]=u*u*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function D(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function I(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function k(t,e,r){var i=e[0],n=e[1],s=e[2],o=e[3],a=i+i,u=n+n,h=s+s,c=i*a,l=i*u,d=i*h,f=n*u,m=n*h,p=s*h,b=o*a,v=o*u,g=o*h;return t[0]=1-(f+p),t[1]=l+g,t[2]=d-v,t[3]=0,t[4]=l-g,t[5]=1-(c+p),t[6]=m+b,t[7]=0,t[8]=d+v,t[9]=m-b,t[10]=1-(c+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function U(t,e){var r=new c(3),i=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],u=e[5],h=e[6],l=e[7],d=i*i+n*n+s*s+o*o;return d>0?(r[0]=2*(a*o+l*i+u*s-h*n)/d,r[1]=2*(u*o+l*n+h*i-a*s)/d,r[2]=2*(h*o+l*s+a*n-u*i)/d):(r[0]=2*(a*o+l*i+u*s-h*n),r[1]=2*(u*o+l*n+h*i-a*s),r[2]=2*(h*o+l*s+a*n-u*i)),k(t,e,r),t}function G(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function N(t,e){var r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],u=e[8],h=e[9],c=e[10];return t[0]=Math.hypot(r,i,n),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,h,c),t}function V(t,e){var r=new c(3);N(r,e);var i=1/r[0],n=1/r[1],s=1/r[2],o=e[0]*i,a=e[1]*n,u=e[2]*s,h=e[4]*i,l=e[5]*n,d=e[6]*s,f=e[8]*i,m=e[9]*n,p=e[10]*s,b=o+l+p,v=0;return b>0?(v=2*Math.sqrt(b+1),t[3]=.25*v,t[0]=(d-m)/v,t[1]=(f-u)/v,t[2]=(a-h)/v):o>l&&o>p?(v=2*Math.sqrt(1+o-l-p),t[3]=(d-m)/v,t[0]=.25*v,t[1]=(a+h)/v,t[2]=(f+u)/v):l>p?(v=2*Math.sqrt(1+l-o-p),t[3]=(f-u)/v,t[0]=(a+h)/v,t[1]=.25*v,t[2]=(d+m)/v):(v=2*Math.sqrt(1+p-o-l),t[3]=(a-h)/v,t[0]=(f+u)/v,t[1]=(d+m)/v,t[2]=.25*v),t}function W(t,e,r,i){var n=e[0],s=e[1],o=e[2],a=e[3],u=n+n,h=s+s,c=o+o,l=n*u,d=n*h,f=n*c,m=s*h,p=s*c,b=o*c,v=a*u,g=a*h,y=a*c,x=i[0],w=i[1],M=i[2];return t[0]=(1-(m+b))*x,t[1]=(d+y)*x,t[2]=(f-g)*x,t[3]=0,t[4]=(d-y)*w,t[5]=(1-(l+b))*w,t[6]=(p+v)*w,t[7]=0,t[8]=(f+g)*M,t[9]=(p-v)*M,t[10]=(1-(l+m))*M,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function q(t,e,r,i,n){var s=e[0],o=e[1],a=e[2],u=e[3],h=s+s,c=o+o,l=a+a,d=s*h,f=s*c,m=s*l,p=o*c,b=o*l,v=a*l,g=u*h,y=u*c,x=u*l,w=i[0],M=i[1],O=i[2],R=n[0],T=n[1],_=n[2],A=(1-(p+v))*w,E=(f+x)*w,S=(m-y)*w,j=(f-x)*M,P=(1-(d+v))*M,z=(b+g)*M,F=(m+y)*O,C=(b-g)*O,L=(1-(d+p))*O;return t[0]=A,t[1]=E,t[2]=S,t[3]=0,t[4]=j,t[5]=P,t[6]=z,t[7]=0,t[8]=F,t[9]=C,t[10]=L,t[11]=0,t[12]=r[0]+R-(A*R+j*T+F*_),t[13]=r[1]+T-(E*R+P*T+C*_),t[14]=r[2]+_-(S*R+z*T+L*_),t[15]=1,t}function H(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,u=n+n,h=r*o,c=i*o,l=i*a,d=n*o,f=n*a,m=n*u,p=s*o,b=s*a,v=s*u;return t[0]=1-l-m,t[1]=c+v,t[2]=d-b,t[3]=0,t[4]=c-v,t[5]=1-h-m,t[6]=f+p,t[7]=0,t[8]=d+b,t[9]=f-p,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function K(t,e,r,i,n,s,o){var a=1/(r-e),u=1/(n-i),h=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*u,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*u,t[10]=(o+s)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*h,t[15]=0,t}function Y(t,e,r,i,n){var s,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(s=1/(i-n),t[10]=(n+i)*s,t[14]=2*n*i*s):(t[10]=-1,t[14]=-2*i),t}function X(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+a),h=2/(n+s);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(o-a)*u*.5,t[9]=(n-s)*h*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function Q(t,e,r,i,n,s,o){var a=1/(e-r),u=1/(i-n),h=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*u,t[14]=(o+s)*h,t[15]=1,t}function Z(t,e,r,i){var n,s,o,a,u,c,l,d,f,m,p=e[0],b=e[1],v=e[2],g=i[0],y=i[1],x=i[2],M=r[0],O=r[1],R=r[2];return Math.abs(p-M)<h&&Math.abs(b-O)<h&&Math.abs(v-R)<h?w(t):(l=p-M,d=b-O,f=v-R,n=y*(f*=m=1/Math.hypot(l,d,f))-x*(d*=m),s=x*(l*=m)-g*f,o=g*d-y*l,(m=Math.hypot(n,s,o))?(n*=m=1/m,s*=m,o*=m):(n=0,s=0,o=0),a=d*o-f*s,u=f*n-l*o,c=l*s-d*n,(m=Math.hypot(a,u,c))?(a*=m=1/m,u*=m,c*=m):(a=0,u=0,c=0),t[0]=n,t[1]=a,t[2]=l,t[3]=0,t[4]=s,t[5]=u,t[6]=d,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(n*p+s*b+o*v),t[13]=-(a*p+u*b+c*v),t[14]=-(l*p+d*b+f*v),t[15]=1,t)}function $(t,e,r,i){var n=e[0],s=e[1],o=e[2],a=i[0],u=i[1],h=i[2],c=n-r[0],l=s-r[1],d=o-r[2],f=c*c+l*l+d*d;f>0&&(c*=f=1/Math.sqrt(f),l*=f,d*=f);var m=u*d-h*l,p=h*c-a*d,b=a*l-u*c;return(f=m*m+p*p+b*b)>0&&(m*=f=1/Math.sqrt(f),p*=f,b*=f),t[0]=m,t[1]=p,t[2]=b,t[3]=0,t[4]=l*b-d*p,t[5]=d*m-c*b,t[6]=c*p-l*m,t[7]=0,t[8]=c,t[9]=l,t[10]=d,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function J(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function tt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function et(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function rt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function it(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function nt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function st(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function ot(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],m=t[11],p=t[12],b=t[13],v=t[14],g=t[15],y=e[0],x=e[1],w=e[2],M=e[3],O=e[4],R=e[5],T=e[6],_=e[7],A=e[8],E=e[9],S=e[10],j=e[11],P=e[12],z=e[13],F=e[14],C=e[15];return Math.abs(r-y)<=h*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-x)<=h*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(n-w)<=h*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(s-M)<=h*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(o-O)<=h*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(a-R)<=h*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(u-T)<=h*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-_)<=h*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(l-A)<=h*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(d-E)<=h*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(f-S)<=h*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(m-j)<=h*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(p-P)<=h*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(b-z)<=h*Math.max(1,Math.abs(b),Math.abs(z))&&Math.abs(v-F)<=h*Math.max(1,Math.abs(v),Math.abs(F))&&Math.abs(g-C)<=h*Math.max(1,Math.abs(g),Math.abs(C))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var at=_,ut=rt;function ht(){var t=new c(3);return c!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ct(t){var e=new c(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function lt(t){var e=t[0],r=t[1],i=t[2];return Math.hypot(e,r,i)}function dt(t,e,r){var i=new c(3);return i[0]=t,i[1]=e,i[2]=r,i}function ft(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function mt(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function pt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function bt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function vt(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function gt(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function yt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function xt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function wt(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Mt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Ot(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Rt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Tt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function _t(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.hypot(r,i,n)}function At(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function Et(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function St(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function jt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Pt(t,e){var r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function zt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ft(t,e,r){var i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],u=r[2];return t[0]=n*u-s*a,t[1]=s*o-i*u,t[2]=i*a-n*o,t}function Ct(t,e,r,i){var n=e[0],s=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t}function Lt(t,e,r,i,n,s){var o=s*s,a=o*(2*s-3)+1,u=o*(s-2)+s,h=o*(s-1),c=o*(3-2*s);return t[0]=e[0]*a+r[0]*u+i[0]*h+n[0]*c,t[1]=e[1]*a+r[1]*u+i[1]*h+n[1]*c,t[2]=e[2]*a+r[2]*u+i[2]*h+n[2]*c,t}function Dt(t,e,r,i,n,s){var o=1-s,a=o*o,u=s*s,h=a*o,c=3*s*a,l=3*u*o,d=u*s;return t[0]=e[0]*h+r[0]*c+i[0]*l+n[0]*d,t[1]=e[1]*h+r[1]*c+i[1]*l+n[1]*d,t[2]=e[2]*h+r[2]*c+i[2]*l+n[2]*d,t}function Bt(t,e){e=e||1;var r=2*l()*Math.PI,i=2*l()-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t}function It(t,e,r){var i=e[0],n=e[1],s=e[2],o=r[3]*i+r[7]*n+r[11]*s+r[15];return o=o||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/o,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/o,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/o,t}function kt(t,e,r){var i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function Ut(t,e,r){var i=r[0],n=r[1],s=r[2],o=r[3],a=e[0],u=e[1],h=e[2],c=n*h-s*u,l=s*a-i*h,d=i*u-n*a,f=n*d-s*l,m=s*c-i*d,p=i*l-n*c,b=2*o;return c*=b,l*=b,d*=b,f*=2,m*=2,p*=2,t[0]=a+c+f,t[1]=u+l+m,t[2]=h+d+p,t}function Gt(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Nt(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Vt(t,e,r,i){var n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Wt(t,e){var r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2],u=Math.sqrt(r*r+i*i+n*n)*Math.sqrt(s*s+o*o+a*a),h=u&&zt(t,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}function qt(t){return t[0]=0,t[1]=0,t[2]=0,t}function Ht(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Kt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Yt(t,e){var r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2];return Math.abs(r-s)<=h*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=h*Math.max(1,Math.abs(n),Math.abs(a))}var Xt,Qt=bt,Zt=vt,$t=gt,Jt=_t,te=At,ee=lt,re=Et,ie=(Xt=ht(),function(t,e,r,i,n,s){var o,a;for(e||(e=3),r||(r=0),a=i?Math.min(i*e+r,t.length):t.length,o=r;o<a;o+=e)Xt[0]=t[o],Xt[1]=t[o+1],Xt[2]=t[o+2],n(Xt,Xt,s),t[o]=Xt[0],t[o+1]=Xt[1],t[o+2]=Xt[2];return t});function ne(){var t=new c(4);return c!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function se(t){var e=new c(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function oe(t,e,r,i){var n=new c(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function ae(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ue(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function he(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function ce(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function le(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function de(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function fe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function me(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function pe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function be(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function ve(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function ge(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function ye(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function xe(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.hypot(r,i,n,s)}function we(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function Me(t){var e=t[0],r=t[1],i=t[2],n=t[3];return Math.hypot(e,r,i,n)}function Oe(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function Re(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Te(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function _e(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=s*o,t}function Ae(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Ee(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],o=r[0]*i[3]-r[3]*i[0],a=r[1]*i[2]-r[2]*i[1],u=r[1]*i[3]-r[3]*i[1],h=r[2]*i[3]-r[3]*i[2],c=e[0],l=e[1],d=e[2],f=e[3];return t[0]=l*h-d*u+f*a,t[1]=-c*h+d*o-f*s,t[2]=c*u-l*o+f*n,t[3]=-c*a+l*s-d*n,t}function Se(t,e,r,i){var n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function je(t,e){var r,i,n,s,o,a;e=e||1;do{o=(r=2*l()-1)*r+(i=2*l()-1)*i}while(o>=1);do{a=(n=2*l()-1)*n+(s=2*l()-1)*s}while(a>=1);var u=Math.sqrt((1-o)/a);return t[0]=e*r,t[1]=e*i,t[2]=e*n*u,t[3]=e*s*u,t}function Pe(t,e,r){var i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}function ze(t,e,r){var i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],u=r[2],h=r[3],c=h*i+a*s-u*n,l=h*n+u*i-o*s,d=h*s+o*n-a*i,f=-o*i-a*n-u*s;return t[0]=c*h+f*-o+l*-u-d*-a,t[1]=l*h+f*-a+d*-o-c*-u,t[2]=d*h+f*-u+c*-a-l*-o,t[3]=e[3],t}function Fe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Ce(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Le(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function De(t,e){var r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],u=e[2],c=e[3];return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-u)<=h*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-c)<=h*Math.max(1,Math.abs(s),Math.abs(c))}var Be=ce,Ie=le,ke=de,Ue=xe,Ge=we,Ne=Me,Ve=Oe,We=function(){var t=ne();return function(e,r,i,n,s,o){var a,u;for(r||(r=4),i||(i=0),u=n?Math.min(n*r+i,e.length):e.length,a=i;a<u;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function qe(){var t=new c(4);return c!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function He(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ke(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function Ye(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>h?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function Xe(t,e){var r=Tr(t,e);return Math.acos(2*r*r-1)}function Qe(t,e,r){var i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],u=r[1],h=r[2],c=r[3];return t[0]=i*c+o*a+n*h-s*u,t[1]=n*c+o*u+s*a-i*h,t[2]=s*c+o*h+i*u-n*a,t[3]=o*c-i*a-n*u-s*h,t}function Ze(t,e,r){r*=.5;var i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),u=Math.cos(r);return t[0]=i*u+o*a,t[1]=n*u+s*a,t[2]=s*u-n*a,t[3]=o*u-i*a,t}function $e(t,e,r){r*=.5;var i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),u=Math.cos(r);return t[0]=i*u-s*a,t[1]=n*u+o*a,t[2]=s*u+i*a,t[3]=o*u-n*a,t}function Je(t,e,r){r*=.5;var i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),u=Math.cos(r);return t[0]=i*u+n*a,t[1]=n*u-i*a,t[2]=s*u+o*a,t[3]=o*u-s*a,t}function tr(t,e){var r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function er(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=Math.sqrt(r*r+i*i+n*n),a=Math.exp(s),u=o>0?a*Math.sin(o)/o:0;return t[0]=r*u,t[1]=i*u,t[2]=n*u,t[3]=a*Math.cos(o),t}function rr(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=Math.sqrt(r*r+i*i+n*n),a=o>0?Math.atan2(o,s)/o:0;return t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=.5*Math.log(r*r+i*i+n*n+s*s),t}function ir(t,e,r){return rr(t,e),Rr(t,t,r),er(t,t),t}function nr(t,e,r,i){var n,s,o,a,u,c=e[0],l=e[1],d=e[2],f=e[3],m=r[0],p=r[1],b=r[2],v=r[3];return(s=c*m+l*p+d*b+f*v)<0&&(s=-s,m=-m,p=-p,b=-b,v=-v),1-s>h?(n=Math.acos(s),o=Math.sin(n),a=Math.sin((1-i)*n)/o,u=Math.sin(i*n)/o):(a=1-i,u=i),t[0]=a*c+u*m,t[1]=a*l+u*p,t[2]=a*d+u*b,t[3]=a*f+u*v,t}function sr(t){var e=l(),r=l(),i=l(),n=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=s*Math.sin(2*Math.PI*i),t[3]=s*Math.cos(2*Math.PI*i),t}function or(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=s*a,t}function ar(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function ur(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+o]-e[3*o+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function hr(t,e,r,i){var n=.5*Math.PI/180;e*=n,r*=n,i*=n;var s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),u=Math.cos(r),h=Math.sin(i),c=Math.cos(i);return t[0]=s*u*c-o*a*h,t[1]=o*a*c+s*u*h,t[2]=o*u*h-s*a*c,t[3]=o*u*c+s*a*h,t}function cr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var lr,dr,fr,mr,pr,br,vr,gr=se,yr=oe,xr=ae,wr=ue,Mr=he,Or=Qe,Rr=ge,Tr=Ae,_r=Se,Ar=Me,Er=Ar,Sr=Oe,jr=Sr,Pr=_e,zr=Le,Fr=De,Cr=(lr=ht(),dr=dt(1,0,0),fr=dt(0,1,0),function(t,e,r){var i=zt(e,r);return i<-.999999?(Ft(lr,dr,e),ee(lr)<1e-6&&Ft(lr,fr,e),Pt(lr,lr),Ke(t,lr,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ft(lr,e,r),t[0]=lr[0],t[1]=lr[1],t[2]=lr[2],t[3]=1+i,Pr(t,t))}),Lr=(mr=qe(),pr=qe(),function(t,e,r,i,n,s){return nr(mr,e,n,s),nr(pr,r,i,s),nr(t,mr,pr,2*s*(1-s)),t}),Dr=(br=new c(9),c!=Float32Array&&(br[1]=0,br[2]=0,br[3]=0,br[5]=0,br[6]=0,br[7]=0),br[0]=1,br[4]=1,br[8]=1,vr=br,function(t,e,r,i){return vr[0]=r[0],vr[3]=r[1],vr[6]=r[2],vr[1]=i[0],vr[4]=i[1],vr[7]=i[2],vr[2]=-e[0],vr[5]=-e[1],vr[8]=-e[2],Pr(t,ur(t,vr))});function Br(){var t=new c(2);return c!=Float32Array&&(t[0]=0,t[1]=0),t}function Ir(t){var e=new c(2);return e[0]=t[0],e[1]=t[1],e}function kr(t,e){var r=new c(2);return r[0]=t,r[1]=e,r}function Ur(t,e){return t[0]=e[0],t[1]=e[1],t}function Gr(t,e,r){return t[0]=e,t[1]=r,t}function Nr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Vr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Wr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function qr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Hr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Kr(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Yr(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Xr(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Qr(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Zr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function $r(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function Jr(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.hypot(r,i)}function ti(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function ei(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function ri(t){var e=t[0],r=t[1];return e*e+r*r}function ii(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ni(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function si(t,e){var r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function oi(t,e){return t[0]*e[0]+t[1]*e[1]}function ai(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function ui(t,e,r,i){var n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function hi(t,e){e=e||1;var r=2*l()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function ci(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function li(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function di(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function fi(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function mi(t,e,r,i){var n=e[0]-r[0],s=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=n*a-s*o+r[0],t[1]=n*o+s*a+r[1],t}function pi(t,e){var r=t[0],i=t[1],n=e[0],s=e[1],o=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+s*s),a=o&&(r*n+i*s)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function bi(t){return t[0]=0,t[1]=0,t}function vi(t){return"vec2("+t[0]+", "+t[1]+")"}function gi(t,e){return t[0]===e[0]&&t[1]===e[1]}function yi(t,e){var r=t[0],i=t[1],n=e[0],s=e[1];return Math.abs(r-n)<=h*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=h*Math.max(1,Math.abs(i),Math.abs(s))}var xi=ei,wi=Vr,Mi=Wr,Oi=qr,Ri=Jr,Ti=ti,_i=ri,Ai=function(){var t=Br();return function(e,r,i,n,s,o){var a,u;for(r||(r=2),i||(i=0),u=n?Math.min(n*r+i,e.length):e.length,a=i;a<u;a+=r)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}}()},function(t,e,r){"use strict";r.r(e),r.d(e,"Vector2",(function(){return n.h})),r.d(e,"vec2",(function(){return n.y})),r.d(e,"Vector3",(function(){return n.i})),r.d(e,"vec3",(function(){return n.z})),r.d(e,"Vector4",(function(){return n.j})),r.d(e,"vec4",(function(){return n.A})),r.d(e,"Color",(function(){return n.a})),r.d(e,"rgba",(function(){return n.x})),r.d(e,"rgb",(function(){return n.w})),r.d(e,"hsl",(function(){return n.p})),r.d(e,"plus",(function(){return n.t})),r.d(e,"minus",(function(){return n.r})),r.d(e,"mul",(function(){return n.s})),r.d(e,"div",(function(){return n.n})),r.d(e,"dot",(function(){return n.o})),r.d(e,"cross",(function(){return n.l})),r.d(e,"distance",(function(){return n.m})),r.d(e,"boxRaycast",(function(){return n.k})),r.d(e,"Deg2Rad",(function(){return n.b})),r.d(e,"Rad2Deg",(function(){return n.f})),r.d(e,"Matrix4x4",(function(){return n.d})),r.d(e,"mat4",(function(){return n.q})),r.d(e,"Quaternion",(function(){return n.e})),r.d(e,"quat",(function(){return n.u})),r.d(e,"ray",(function(){return n.v})),r.d(e,"Rect",(function(){return n.g})),r.d(e,"MathUtils",(function(){return n.c})),r.d(e,"Material",(function(){return s.u})),r.d(e,"shaderProp",(function(){return s.K})),r.d(e,"MaterialFromShader",(function(){return s.v})),r.d(e,"SimpleTexturedMaterial",(function(){return s.B})),r.d(e,"materialDefine",(function(){return s.J})),r.d(e,"DefaultVertexData",(function(){return s.h})),r.d(e,"DefaultVertexStructInfo",(function(){return s.i})),r.d(e,"VertexStruct",(function(){return s.G})),r.d(e,"Mesh",(function(){return s.w})),r.d(e,"MeshLegacy",(function(){return s.x})),r.d(e,"ZograRenderer",(function(){return s.I})),r.d(e,"DepthTest",(function(){return s.k})),r.d(e,"Blending",(function(){return s.c})),r.d(e,"Culling",(function(){return s.e})),r.d(e,"DefaultShaderAttributeNames",(function(){return s.g})),r.d(e,"Shader",(function(){return s.A})),r.d(e,"FilterMode",(function(){return s.n})),r.d(e,"WrapMode",(function(){return s.H})),r.d(e,"Texture",(function(){return s.C})),r.d(e,"TextureResizing",(function(){return s.F})),r.d(e,"Texture2D",(function(){return s.D})),r.d(e,"DepthTexture",(function(){return s.l})),r.d(e,"RenderTexture",(function(){return s.z})),r.d(e,"Asset",(function(){return s.a})),r.d(e,"GPUAsset",(function(){return s.q})),r.d(e,"LazyInitAsset",(function(){return s.r})),r.d(e,"AssetManager",(function(){return s.b})),r.d(e,"Lines",(function(){return s.t})),r.d(e,"LineBuilder",(function(){return s.s})),r.d(e,"EventEmitter",(function(){return s.m})),r.d(e,"BufferStructureInfo",(function(){return s.d})),r.d(e,"GLArrayBuffer",(function(){return s.p})),r.d(e,"RenderBuffer",(function(){return s.y})),r.d(e,"DepthBuffer",(function(){return s.j})),r.d(e,"FrameBuffer",(function(){return s.o})),r.d(e,"DebugProvider",(function(){return s.f})),r.d(e,"TextureFormat",(function(){return s.E})),r.d(e,"AssetsPack",(function(){return o.b})),r.d(e,"AssetsImporter",(function(){return o.a})),r.d(e,"TextureImporter",(function(){return a.a})),r.d(e,"MeshBuilder",(function(){return u.a})),r.d(e,"MeshBuilderLegacy",(function(){return u.b})),r.d(e,"Utils",(function(){return i})),r.d(e,"GLContext",(function(){return c.c})),r.d(e,"GlobalContext",(function(){return c.d}));var i={};r.r(i),r.d(i,"ImageSizing",(function(){return h.a})),r.d(i,"imageResize",(function(){return h.b}));var n=r(55),s=r(63),o=r(51),a=r(73),u=r(24),h=r(41),c=r(3)},function(t,e,r){"use strict";r.d(e,"j",(function(){return u})),r.d(e,"h",(function(){return h})),r.d(e,"i",(function(){return c})),r.d(e,"f",(function(){return l})),r.d(e,"g",(function(){return d})),r.d(e,"d",(function(){return f})),r.d(e,"e",(function(){return m})),r.d(e,"c",(function(){return p})),r.d(e,"a",(function(){return b})),r.d(e,"b",(function(){return v}));var i=r(1),n=r(13),s=r(0),o=r(9);function a(t,e){let r=Math.max(t.length||0,e.length||0);switch(r){case 2:return"number"==typeof t?s.b.fill(t):s.b.set(t);case 3:return"number"==typeof t?s.b.fill(t):i.b.set(t);case 4:return"number"==typeof t?s.b.fill(t):n.b.set(t);case 16:return"number"==typeof t?s.b.fill(t):o.b.set(t)}return console.warn(`Unsupported vector length '${r}'`),new Array}function u(t,e,r){if("number"==typeof t&&"number"==typeof e)return t+e;let o=r||a(t,e);switch(o.length){case 2:return s.b.plus(o,o,e);case 3:return i.b.plus(o,o,e);case 4:return n.b.plus(o,o,e)}return console.warn(`Unsupported vector length '${o.length}'`),n.b.plus(o,o,e)}function h(t,e,r){if("number"==typeof t&&"number"==typeof e)return t+e;let o=r||a(t,e);switch(o.length){case 2:return s.b.minus(o,o,e);case 3:return i.b.minus(o,o,e);case 4:return n.b.minus(o,o,e)}return console.warn(`Unsupported vector length '${o.length}'`),n.b.minus(o,o,e)}function c(t,e,r){if("number"==typeof t&&"number"==typeof e)return t+e;let o=r||a(t,e);switch(o.length){case 2:return s.b.mul(o,o,e);case 3:return i.b.mul(o,o,e);case 4:return n.b.mul(o,o,e)}return console.warn(`Unsupported vector length '${o.length}'`),n.b.mul(o,o,e)}function l(t,e,r){if("number"==typeof t&&"number"==typeof e)return t+e;let o=r||a(t,e);switch(o.length){case 2:return s.b.div(o,o,e);case 3:return i.b.div(o,o,e);case 4:return n.b.div(o,o,e)}return console.warn(`Unsupported vector length '${o.length}'`),n.b.div(o,o,e)}function d(t,e){switch(t.length){case 2:return t[0]*e[0]+t[1]*e[1];case 3:return t[0]*e[0]+t[1]*e[1]+t[2]*e[2];case 4:return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}}function f(t,e,r=i.b.zero()){return r[0]=t[1]*e[2]-t[2]*e[1],r[1]=t[2]*e[0]-t[0]*e[2],r[2]=t[0]*e[1]-t[1]*e[0],r}function m(t,e){return Math.hypot(e[0]-t[0]||0,e[1]-t[1]||0,e[2]-t[2]||0,e[3]-t[3]||0)}function p(t,e,r){if(0==(r=r.normalized).x&&0==r.y)return[!1,0,s.b.zero()];let i=s.b.zero(),n=s.b.zero();if(0==r.x)return i.y=(t.yMin-e.y)/r.y,n.y=(t.yMax-e.y)/r.y,i.x=n.x=Number.NEGATIVE_INFINITY,t.xMin<=e.x&&e.x<=t.xMax?i.y<n.y?[!0,i.y,Object(s.b)(0,-1)]:[!0,n.y,Object(s.b)(0,1)]:[!1,0,s.b.zero()];if(0==r.y)return i.x=(t.xMin-e.x)/r.x,n.x=(t.xMax-e.x)/r.x,i.y=n.y=Number.NEGATIVE_INFINITY,t.yMin<=e.y&&e.y<=t.yMax?i.x<n.x?[!0,i.x,Object(s.b)(-1,0)]:[!0,n.x,Object(s.b)(1,0)]:[!1,0,s.b.zero()];i=h(t.min,e).div(r),n=h(t.max,e).div(r);var o=i.x,a=n.x,u=Object(s.b)(-1,0),c=i.y,l=n.y,d=Object(s.b)(0,-1);return i.x>n.x&&(o=n.x,a=i.x,u=Object(s.b)(1,0)),i.y>n.y&&(c=n.y,l=i.y,d=Object(s.b)(0,1)),c>a||o>l?[!1,0,s.b.zero()]:o>c?[!0,o,u]:[!0,c,d]}Number.prototype.__to=function(t){switch(t){case n.a:return Object(n.b)(this.valueOf(),this.valueOf(),this.valueOf(),this.valueOf());case i.a:return Object(i.b)(this.valueOf(),this.valueOf(),this.valueOf());case s.a:return Object(s.b)(this.valueOf(),this.valueOf())}return this.valueOf()};const b=Math.PI/180,v=180/Math.PI},function(t,e,r){"use strict";r.d(e,"d",(function(){return i})),r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return d})),r.d(e,"e",(function(){return f}));var i,n,s,o=r(10),a=r(3),u=r(18),h=r(15),c=r(23),l=r(16);!function(t){t[t.Disable=-1]="Disable",t[t.Always=WebGL2RenderingContext.ALWAYS]="Always",t[t.Never=WebGL2RenderingContext.NEVER]="Never",t[t.Less=WebGL2RenderingContext.LESS]="Less",t[t.Equal=WebGL2RenderingContext.EQUAL]="Equal",t[t.LEqual=WebGL2RenderingContext.LEQUAL]="LEqual",t[t.Greater=WebGL2RenderingContext.GREATER]="Greater",t[t.NotEqual=WebGL2RenderingContext.NOTEQUAL]="NotEqual",t[t.GEqual=WebGL2RenderingContext.GEQUAL]="GEqual"}(i||(i={})),function(t){t[t.Disable=-1]="Disable",t[t.Zero=WebGL2RenderingContext.ZERO]="Zero",t[t.One=WebGL2RenderingContext.ONE]="One",t[t.SrcColor=WebGL2RenderingContext.SRC_COLOR]="SrcColor",t[t.OneMinusSrcColor=WebGL2RenderingContext.ONE_MINUS_SRC_COLOR]="OneMinusSrcColor",t[t.DstColor=WebGL2RenderingContext.DST_COLOR]="DstColor",t[t.OneMinusDstColor=WebGL2RenderingContext.ONE_MINUS_DST_COLOR]="OneMinusDstColor",t[t.SrcAlpha=WebGL2RenderingContext.SRC_ALPHA]="SrcAlpha",t[t.OneMinusSrcAlpha=WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA]="OneMinusSrcAlpha",t[t.DstAlpha=WebGL2RenderingContext.DST_ALPHA]="DstAlpha",t[t.OneMinusDstAlpha=WebGL2RenderingContext.ONE_MINUS_DST_ALPHA]="OneMinusDstAlpha"}(n||(n={})),function(t){t[t.Disable=-1]="Disable",t[t.Back=WebGL2RenderingContext.BACK]="Back",t[t.Front=WebGL2RenderingContext.FRONT]="Front",t[t.Both=WebGL2RenderingContext.FRONT_AND_BACK]="Both"}(s||(s={}));const d={vert:"aPos",color:"aColor",uv:"aUV",uv2:"aUV2",normal:"aNormal"};class f extends h.a{constructor(t,e,r={},i=Object(a.b)()){super(r.name),this.attributes={},this.initialized=!1,this.gl=null,this.program=null,this.vertexShader=null,this.fragmentShader=null,this.pipelineStates={},this.builtinUniformLocations=null,this._compiled=!1,r.name||(this.name="Shader_"+this.assetID),this.vertexShaderSource=t,this.fragmentShaderSouce=e,this.options=r,this.gl=i,this.vertexStruct=c.a.from(this.options.vertexStructure||l.a),this.attributeNames=Object.assign(Object.assign({},d),r.attributes),this.setPipelineStateInternal(this.options),this.tryInit()}get compiled(){return this._compiled}uniformLocation(t){return this.tryInit(!0),this.gl.getUniformLocation(this.program,t)}use(){this.tryInit(!0),this.gl.useProgram(this.program)}setupBuiltinUniform(t){this.tryInit(!0);const e=this.gl;this.builtinUniformLocations.matM&&e.uniformMatrix4fv(this.builtinUniformLocations.matM,!1,t.matM.asMut()),this.builtinUniformLocations.matVP&&e.uniformMatrix4fv(this.builtinUniformLocations.matVP,!1,t.matVP.asMut()),this.builtinUniformLocations.matMVP&&e.uniformMatrix4fv(this.builtinUniformLocations.matMVP,!1,t.matMVP.asMut()),this.builtinUniformLocations.matM_IT&&e.uniformMatrix4fv(this.builtinUniformLocations.matM_IT,!1,t.matM_IT.asMut()),this.builtinUniformLocations.matMV_IT&&e.uniformMatrix4fv(this.builtinUniformLocations.matMV_IT,!1,t.matMV_IT.asMut())}setPipelineStateInternal(t){let e=!1,r=[n.One,n.Zero],o=[n.One,n.OneMinusSrcAlpha];"number"==typeof t.blend&&t.blend!==n.Disable?(e=!0,r=[t.blend,t.blend],o=[t.blend,t.blend]):t.blend instanceof Array&&(e=!0,r=t.blend),t.blendRGB&&(e=!1!==t.blend&&t.blend!==n.Disable,r=t.blendRGB),t.blendAlpha&&(e=!1!==t.blend&&t.blend!==n.Disable,o=t.blendAlpha),this.pipelineStates={depth:t.depth||i.Less,blend:e,blendRGB:r,blendAlpha:o,zWrite:!1!==t.zWrite,cull:t.cull||s.Back}}_internal(){return this.tryInit(!0),{options:this.options}}tryInit(t=!1){if(this.initialized)return!0;const e=this.gl||Object(a.b)();if(!e)return!!t&&Object(o.c)("Failed to init shader without a global GL context");this.gl=e,this.program=Object(o.d)(e.createProgram(),"Failed to create shader program"),this.vertexShader=Object(o.d)(e.createShader(e.VERTEX_SHADER),"Failed to create vertex shader"),this.fragmentShader=Object(o.d)(e.createShader(e.FRAGMENT_SHADER),"Failed to create fragment shader"),this.compile(),e.useProgram(this.program);const r=Object.assign(Object.assign({},d),this.options.attributes);this.attributes={};for(const t in r)this.attributes[t]=e.getAttribLocation(this.program,r[t]);return this.builtinUniformLocations=Object(o.b)(e,this.program,u.a),this.initialized=!0,!0}compile(){if(this.gl.shaderSource(this.vertexShader,this.vertexShaderSource),this.gl.compileShader(this.vertexShader),!this.gl.getShaderParameter(this.vertexShader,this.gl.COMPILE_STATUS))throw new Error("Failed to compile vertex shader:\r\n"+this.gl.getShaderInfoLog(this.vertexShader));if(this.gl.shaderSource(this.fragmentShader,this.fragmentShaderSouce),this.gl.compileShader(this.fragmentShader),!this.gl.getShaderParameter(this.fragmentShader,this.gl.COMPILE_STATUS))throw new Error("Failed to compile fragment shader:\r\n"+this.gl.getShaderInfoLog(this.fragmentShader));this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader);for(const t of this.vertexStruct.elements)this.attributeNames[t.key]&&this.gl.bindAttribLocation(this.program,t.location,this.attributeNames[t.key]);if(this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw new Error("Failed to link shader program:\r\n"+this.gl.getProgramInfoLog(this.program))}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return l})),r.d(e,"e",(function(){return f})),r.d(e,"b",(function(){return m})),r.d(e,"c",(function(){return p})),r.d(e,"d",(function(){return b}));var i,n=r(7),s=r(11),o=(r(42),r(3)),a=r(12),u=r(15),h=r(18),c=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};!function(t){t[t.Field=0]="Field",t[t.Dynamic=1]="Dynamic"}(i||(i={}));class l extends u.a{constructor(t,e=Object(o.b)()){super(),this.properties={},this.textureCount=0,this.boundTextures=[],this.initialized=!1,this.name="Material_"+this.assetID,this.gl=e,this._shader=t,this.pipelineStateOverride=Object.assign({},t.pipelineStates)}get shader(){return this._shader}upload(t){this.tryInit(!0),this.setupPipelineStateOverride();for(const t in this.properties){const e=this.properties[t],r=e.key?this[e.key]:e.value;void 0!==r&&this.uploadUniform(e,r)}}setProp(t,e,r){this.tryInit(!0);const i=this.getOrCreatePropInfo(t,e);e===i.type?i.key?this[i.key]=r:i.value=r:console.warn("Uniform type missmatch")}unbindRenderTextures(){this.tryInit(!0);this.gl;for(let t=0;t<this.boundTextures.length;t++){const e=this.boundTextures[t];e instanceof a.c&&e.unbind(t)}this.boundTextures.length=0}tryInit(t=!1){if(this.initialized)return!0;const e=this.gl||Object(o.b)();if(!e){if(t)throw new Error("Failed to intialize material without global GL context");return!1}this.gl=e;for(const t in this){const e=(r=this,i=t,Reflect.getMetadata(d,r,i));if(!e)continue;this.getOrCreatePropInfo(e.name,e.type).key=t}var r,i;return this.initialized=!0,!0}setUniformDirectly(t,e,r){if(void 0===r)throw new Error("");this.tryInit(!0);const i=this.getOrCreatePropInfo(t,e);i.location&&this.uploadUniform(i,r)}getOrCreatePropInfo(t,e){let r=this.properties[t];return r||(r="tex2d"===e?{type:e,value:void 0,uploaed:void 0,location:this.shader.uniformLocation(t)}:"tex2d[]"===e?{type:e,value:void 0,uploaded:void 0,location:this.shader.uniformLocation(t),buffer:new Array}:e.endsWith("[]")?{type:e,value:void 0,uploaded:void 0,location:this.shader.uniformLocation(t),buffer:new Float32Array}:{type:e,value:void 0,uploaded:void 0,location:this.shader.uniformLocation(t)},this.properties[t]=r,r)}setPipelineStateOverride(t){let e=!1,r=[n.a.One,n.a.Zero],i=[n.a.One,n.a.OneMinusSrcAlpha];"number"==typeof t.blend&&t.blend!==n.a.Disable?(e=!0,r=[t.blend,t.blend],i=[t.blend,t.blend]):t.blend instanceof Array&&(e=!0,r=t.blend),t.blendRGB&&(e=!1!==t.blend&&t.blend!==n.a.Disable,r=t.blendRGB),t.blendAlpha&&(e=!1!==t.blend&&t.blend!==n.a.Disable,i=t.blendAlpha),this.pipelineStateOverride={depth:t.depth||n.d.Less,blend:e,blendRGB:r,blendAlpha:i,zWrite:!1!==t.zWrite,cull:t.cull||n.b.Back}}setupPipelineStateOverride(){const t=this.gl;if(this.pipelineStateOverride.depth===n.d.Disable?t.disable(t.DEPTH_TEST):(t.enable(t.DEPTH_TEST),t.depthMask(this.pipelineStateOverride.zWrite),t.depthFunc(this.pipelineStateOverride.depth)),this.pipelineStateOverride.blend){const[e,r]=this.pipelineStateOverride.blendRGB,[i,n]=this.pipelineStateOverride.blendAlpha;t.enable(t.BLEND),t.blendFuncSeparate(e,r,i,n)}else t.disable(t.BLEND);this.pipelineStateOverride.cull===n.b.Disable?t.disable(t.CULL_FACE):(t.enable(t.CULL_FACE),t.cullFace(this.pipelineStateOverride.cull),t.frontFace(t.CCW))}uploadUniform(t,e){var r;const i=this.gl,n=Object(o.d)();if(!t.location)return!1;if(null===t.uploaded&&null===e&&"tex2d"!==t.type)return!1;let s=e;switch(t.type){case"int":i.uniform1i(t.location,e);break;case"float":i.uniform1f(t.location,e);break;case"vec2":i.uniform2fv(t.location,e);break;case"vec3":i.uniform3fv(t.location,e);break;case"vec4":case"color":i.uniform4fv(t.location,e);break;case"mat4":i.uniformMatrix4fv(t.location,!1,e);break;case"int[]":e.length&&i.uniform1iv(t.location,e);break;case"float[]":e.length&&i.uniform1fv(t.location,e);break;case"vec2[]":{const r=this.setVectorUniformBuffer(t,2,e);r&&i.uniform2fv(t.location,t.buffer,0,r);break}case"vec3[]":{const r=this.setVectorUniformBuffer(t,3,e);r&&i.uniform3fv(t.location,t.buffer,0,r);break}case"color[]":case"vec4[]":{const r=this.setVectorUniformBuffer(t,4,e);r&&i.uniform4fv(t.location,t.buffer,0,r);break}case"mat4[]":{const r=this.setVectorUniformBuffer(t,16,e);r&&i.uniform4fv(t.location,t.buffer,0,r);break}case"tex2d":{const r=t;e=e||n.renderer.assets.textures.default;let o=this.bindNextTexture(e);r.uploaded!==o&&(i.uniform1i(r.location,o),r.uploaded=o),s=o;break}case"tex2d[]":{const o=t,a=e;let u=!1;const h=o.uploaded||[];for(let t=0;t<a.length;t++){const e=a[t]||n.renderer.assets.textures.default;let i=this.bindNextTexture(e);(null===(r=o.uploaded)||void 0===r?void 0:r[t])!==i&&(u=!0),h[t]=i}u&&(i.uniform1iv(o.location,h,0,a.length),o.uploaded=h),s=h}}t.uploaded=s}bindNextTexture(t){return t.bind(this.boundTextures.length),this.boundTextures.push(t)-1}setVectorUniformBuffer(t,e,r){t.buffer.length<e*r.length&&(t.buffer=new Float32Array(e*r.length));for(let i=0;i<r.length;i++)t.buffer.set(r[i],i*e);return e*r.length}}const d=Symbol("shaderProp");function f(t,e){return Reflect.metadata(d,{name:t,type:e})}function m(t){return class extends l{constructor(e=Object(o.b)()){super(t,e)}}}function p(t){class e extends(m(t)){constructor(){super(...arguments),this.texture=null,this.color=new s.a(1,1,1,1)}}return c([f(h.a.mainTex,"tex2d")],e.prototype,"texture",void 0),c([f(h.a.color,"color")],e.prototype,"color",void 0),e}function b(t){return class extends t{constructor(...t){super(...t)}}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return l})),r.d(e,"b",(function(){return d}));var i=r(4),n=r(22),s=r(1),o=r(13),a=r(0),u=r(2);const h=Array,c=o.b.zero();class l extends h{constructor(t=0,e=0,r=0,i=0,n=0,s=0,o=0,a=0,u=0,h=0,c=0,l=0,d=0,f=0,m=0,p=0){super(t,e,r,i,n,s,o,a,u,h,c,l,d,f,m,p)}static create(){return new l}asMut(){return this}set(t){return i.b.set(this,...t)}fill(t){return d.fill(this,t)}clone(t=d.create()){return t.set(this)}equals(t){return d.equal(this,t)}}function d(t=0,e=0,r=0,i=0,n=0,s=0,o=0,a=0,u=0,h=0,c=0,d=0,f=0,m=0,p=0,b=0){return new l(t,e,r,i,n,s,o,a,u,h,c,d,f,m,p,b)}d.create=l.create,d.identity=Object(u.b)(i.b.identity,0,d.create),d.rts=Object(u.b)(i.b.fromRotationTranslationScale,3,d.create),d.translate=Object(u.b)(i.b.translate,2,l.create),d.invert=Object(u.b)(i.b.invert,1,l.create),d.getTranslation=Object(u.b)(i.b.getTranslation,1,s.b.zero),d.getRotation=Object(u.b)(i.b.getRotation,1,n.b.create),d.getScaling=Object(u.b)(i.b.getScaling,1,s.b.zero),d.mulVec4=Object(u.b)((t,e,r)=>i.f.transformMat4(t,r,e),2,o.b.zero),d.perspective=Object(u.b)(i.b.perspective,4,l.create),d.transpose=Object(u.b)(i.b.transpose,1,l.create),d.rotate=Object(u.b)((t,e,r,n)=>i.b.rotate(t,e,n,r),3,l.create),d.scale=Object(u.b)(i.b.scale,2,l.create),d.fromTranslation=Object(u.b)(i.b.fromTranslation,1,l.create),d.fromRotation=Object(u.b)(i.b.fromRotation,1,l.create),d.fromScaling=Object(u.b)(i.b.fromScaling,1,l.create),d.mul=Object(u.b)(i.b.mul,2,l.create),d.add=Object(u.b)(i.b.add,2,d.create),d.sub=Object(u.b)(i.b.sub,2,d.create),d.plus=d.add,d.minus=d.sub,d.mulVector=Object(u.b)((t,e,r)=>(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=0,i.f.transformMat4(c,c,e),t[0]=c[0],t[1]=c[1],t[2]=c[2],t),2,s.b.zero),d.mulPoint=Object(u.b)((t,e,r)=>(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=1,i.f.transformMat4(c,c,e),t[0]=c[0],t[1]=c[1],t[2]=c[2],t),2,s.b.zero),d.mulPoint2=Object(u.b)((t,e,r)=>(c[0]=r[0],c[1]=r[1],c[2]=0,c[3]=1,i.f.transformMat4(c,c,e),t[0]=c[0],t[1]=c[1],t),2,a.b.zero),d.mulVector2=Object(u.b)((t,e,r)=>(c[0]=r[0],c[1]=r[1],c[2]=0,c[3]=0,i.f.transformMat4(c,c,e),t[0]=c[0],t[1]=c[1],t),2,a.b.zero),d.ortho=function(...t){if(4===t.length)return function(t,e,r,n){const s=d.create();return i.b.ortho(s,-e*t,e*t,-t,t,r,n),s}(...t);const e=d.create();return i.b.ortho(e,...t),e},d.equal=(t,e)=>void 0!==t&&void 0!==e&&((t instanceof Array||t instanceof Float32Array)&&(e instanceof Array||e instanceof Float32Array)&&i.b.exactEquals(t,e)),d.set=Object(u.b)(i.b.set,1,d.create),d.fill=Object(u.b)((t,e)=>(t[0]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=e,t),1,d.create)},function(t,e,r){"use strict";r.d(e,"d",(function(){return i})),r.d(e,"c",(function(){return n})),r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return o}));r(42);function i(t,e){if(null===t)throw new Error(e);return t}function n(t){throw new Error(t)}function s(t,e,r){const i={};for(const n in r)i[n]=t.getUniformLocation(e,r[n]);return i}function o(t,e){const r=new Array(e);for(let i=0;i<e;i++)r[i]="function"==typeof t?t(i):t;return r}},function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"d",(function(){return s})),r.d(e,"c",(function(){return o})),r.d(e,"b",(function(){return a}));var i=r(13);class n extends i.a{get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get a(){return this[3]}set a(t){this[3]=t}constructor(t,e,r,i=1){super(t,e,r,i)}static get white(){return new n(1,1,1)}static get transparent(){return new n(1,1,1,0)}static get black(){return new n(0,0,0)}static get red(){return new n(1,0,0)}static get green(){return new n(0,1,0)}static get blue(){return new n(0,0,1)}static get cyan(){return new n(0,1,1)}static get yellow(){return new n(1,1,0)}static get magenta(){return new n(1,0,1)}static get gray(){return new n(.5,.5,.5)}transparent(){return new n(this.r,this.g,this.b,0)}setHSL(t,e,r){t=t<0?t+360:t;const i=(1-Math.abs(2*r-1))*e;if(isNaN(t))return this.r=this.g=this.b=0,this;t/=60;const n=i*(1-Math.abs(t%2-1));let s=[0,0,0];0<=t&&t<=1?s=[i,n,0]:t<=2?s=[n,i,0]:t<=3?s=[0,i,n]:t<=4?s=[0,n,i]:t<=5?s=[n,0,i]:t<=6&&(s=[i,0,n]);let o=r-i/2;return this.r=s[0]+o,this.g=s[1]+o,this.b=s[2]+o,this}get hue(){const t=this.r,e=this.g,r=this.b,i=Math.max(t,e,r),n=Math.min(t,e,r);let s=0;return i===n?s=0:i===t?s=60*(0+(e-r)/(i-n)):i===e?s=60*(2+(r-t)/(i-n)):i===r&&(s=60*(4+(t-e)/(i-n))),s<0?s+360:s}get saturation(){const t=Math.max(this.r,this.g,this.b),e=Math.min(this.r,this.g,this.b);return 0===t||1==e?0:(t-e)/(1-Math.abs(t+e-1))}get lightness(){return(Math.max(this.r,this.g,this.b)+Math.min(this.r,this.g,this.b))/2}toHSL(){return[this.hue,this.saturation,this.lightness]}static fromHSL(t,e,r,i=1){return new n(0,0,0,i).setHSL(t,e,r)}static fromString(t,e){t=t.replace(new RegExp(/\s/g),"");var r=new RegExp("#[0-9a-fA-F]{6}");if(r.test(t)){var i=(t=t.replace("#","")).charAt(0)+t.charAt(1),s=t.charAt(2)+t.charAt(3),o=t.charAt(4)+t.charAt(5),a=parseInt(i,16),u=parseInt(s,16),h=parseInt(o,16);return new n(a/255,u/255,h/255,e||1)}if((r=new RegExp("rgb\\(([0-9]+(\\.[0-9]+){0,1}),([0-9]+(\\.[0-9]+){0,1}),([0-9]+(\\.[0-9]+){0,1})\\)")).test(t)){var c=t.replace("rgb(","").replace(")","").split(",");a=parseInt(c[0]),u=parseInt(c[1]),h=parseInt(c[2]);return new n(a/255,u/255,h/255,(l=e||1)/255)}if((r=new RegExp("rgba\\(([0-9]+(\\.[0-9]+){0,1}),([0-9]+(\\.[0-9]+){0,1}),([0-9]+(\\.[0-9]+){0,1}),([0-9]+(\\.[0-9]+){0,1})\\)")).test(t)){c=t.replace("rgba(","").replace(")","").split(","),a=parseInt(c[0]),u=parseInt(c[1]),h=parseInt(c[2]);var l=e||parseFloat(c[3]);return new n(a/255,u/255,h/255,l)}throw new Error(`Invalid color string '${t}'`)}}const s=(t,e,r,i=1)=>new n(t,e,r,i),o=(t,e,r)=>new n(t,e,r,1),a=n.fromHSL},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"g",(function(){return n})),r.d(e,"d",(function(){return m})),r.d(e,"f",(function(){return s})),r.d(e,"e",(function(){return b})),r.d(e,"a",(function(){return v})),r.d(e,"c",(function(){return g}));var i,n,s,o=r(3),a=r(14),u=r(10),h=r(15),c=r(18),l=r(0),d=r(41),f=r(17);!function(t){t[t.Linear=WebGL2RenderingContext.LINEAR]="Linear",t[t.Nearest=WebGL2RenderingContext.NEAREST]="Nearest"}(i||(i={})),function(t){t[t.Repeat=WebGL2RenderingContext.REPEAT]="Repeat",t[t.Clamp=WebGL2RenderingContext.CLAMP_TO_EDGE]="Clamp",t[t.Mirror=WebGL2RenderingContext.MIRRORED_REPEAT]="Mirror"}(n||(n={}));class m extends h.a{}!function(t){t[t.Discard=0]="Discard",t[t.Stretch=1]="Stretch",t[t.Cover=2]="Cover",t[t.Contain=3]="Contain",t[t.KeepLower=4]="KeepLower",t[t.KeepHigher=5]="KeepHigher",t[t.Center=6]="Center"}(s||(s={}));class p extends h.a{constructor(t,e,r=a.a.RGBA,s=i.Linear,u=Object(o.d)()){super(),this.autoMipmap=!0,this.wrapMode=n.Repeat,this._glTex=null,this.initialized=!1,this.created=!1,this.name="Texture_"+this.assetID,this.ctx=u,this.format=r,this.width=t,this.height=e,this.filterMode=s,this.tryInit(!1)}get size(){return Object(l.b)(this.width,this.height)}glTex(){return this.create(),this._glTex}bind(t){this.create();const e=this.ctx.gl;e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._glTex)}unbind(t){this.create();const e=this.ctx.gl;e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null)}destroy(){if(!this.initialized||this.destroyed)return;this.ctx.gl.deleteTexture(this._glTex),super.destroy()}resize(t,e,r=s.Discard){this.tryInit(!0);const i=this.ctx.gl;let n=p.wrapGlTex(this._glTex,this.width,this.height,this.format,this.filterMode,this.ctx),o=new g(t,e,!1,this.format,this.filterMode,this.ctx);o.wrapMode=this.wrapMode,o.autoMipmap=this.autoMipmap,o.create(),o.updateParameters();const a=this.size;switch(this.width=t,this.height=e,r){case s.Discard:break;default:const[t,e]=Object(d.b)(a,o.size,r);this.ctx.renderer.blit(n,o,this.ctx.assets.materials.blitCopy,t,e)}return this.autoMipmap&&o.generateMipmap(),this._glTex=o._glTex,i.deleteTexture(n._glTex),this}generateMipmap(){this.create();const t=this.ctx.gl;t.bindTexture(t.TEXTURE_2D,this._glTex),t.generateMipmap(t.TEXTURE_2D)}updateParameters(){this.create();const t=this.ctx.gl;t.bindTexture(t.TEXTURE_2D,this._glTex),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.filterMode),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.filterMode),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrapMode),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrapMode)}create(){if(this.created)return;this.tryInit(!0);const t=this.ctx.gl;t.bindTexture(t.TEXTURE_2D,this._glTex);const[e,r,i]=Object(a.b)(t,this.format);t.texImage2D(t.TEXTURE_2D,0,e,this.width,this.height,0,r,i,null),this.created=!0,this.updateParameters(),t.bindTexture(t.TEXTURE_2D,null)}setData(t){this.create();const e=this.ctx.gl;e.bindTexture(e.TEXTURE_2D,this._glTex),function(t,e,r,i,n,s,o,h,l){var d,f;const m=t.gl,p=(t.renderer,null!==(d=m.createTexture())&&void 0!==d?d:Object(u.c)("Failed to create texture.")),[b,v,g]=Object(a.b)(m,s);m.bindTexture(m.TEXTURE_2D,p),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,h),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),void 0!==r.width&&void 0!==r.height?(r=r,m.texImage2D(m.TEXTURE_2D,l,b,v,g,r)):(r=r,m.texImage2D(m.TEXTURE_2D,l,b,i,n,0,v,g,r));const y=null!==(f=m.createFramebuffer())&&void 0!==f?f:Object(u.c)("Failed to create frame buffer");m.bindFramebuffer(m.FRAMEBUFFER,y),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,e,0),m.viewport(0,0,i,n),m.drawBuffers([m.COLOR_ATTACHMENT0]),m.disable(m.CULL_FACE);const x=t.assets.shaders.FlipTexture;x.use(),m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,p),m.uniform1i(x.uniformLocation(c.a.mainTex),0);const w=t.assets.meshes.screenQuad;w.bind(),m.drawElements(m.TRIANGLE_STRIP,w.indices.length,m.UNSIGNED_INT,0),m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,null),m.deleteFramebuffer(y),m.bindFramebuffer(m.FRAMEBUFFER,null),m.deleteTexture(p)}(this.ctx,this._glTex,t,this.width,this.height,this.format,this.filterMode,this.wrapMode,0)}tryInit(t=!1){var e;if(this.initialized)return!0;const r=this.ctx||Object(o.d)();if(!r){if(t)throw new Error("Failed to initialize texture without a global GL context");return!1}const i=r.gl;return this._glTex=null!==(e=i.createTexture())&&void 0!==e?e:Object(u.c)("Failed to create texture."),this.initialized=!0,!0}static wrapGlTex(t,e,r,n=a.a.RGBA,s=i.Linear,u=Object(o.d)()){var h=new p(e,r,n,s,u);return h._glTex=t,h.initialized=!0,h.created=!0,h}}class b extends p{constructor(t=0,e=0,r=a.a.RGBA,n=i.Linear,s=Object(o.d)()){super(t,e,r,n,s)}setData(t){void 0!==t.width&&void 0!==t.height&&(t=t,this.width=t.width,this.height=t.height),super.setData(t)}clone(){this.created||this.create();let t=new g(this.width,this.height,!1,this.format,this.filterMode,this.ctx);this.ctx.renderer.blit(this,t);let e=new b(this.width,this.height,this.format,this.filterMode,this.ctx);return e._glTex=t.glTex(),e.initialized=!0,e.created=!0,e}}class v extends p{constructor(t,e,r=Object(o.d)()){super(t,e,a.a.DEPTH_COMPONENT,i.Nearest,r)}bindFramebuffer(){this.create();const t=this.ctx.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this._glTex,0)}}class g extends p{constructor(t,e,r=!1,n=a.a.RGBA,s=i.Linear,u=Object(o.d)()){super(t,e,n,s,u),this.depthTexture=null,r&&(this.depthTexture=new v(t,e,u))}setData(t){super.setData(t)}destroy(){var t;this.initialized&&!this.destroyed&&(null===(t=this.depthTexture)||void 0===t||t.destroy(),super.destroy())}bindFramebuffer(t){this.create();const e=this.ctx.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,this._glTex,0)}createFramebuffer(){this.create();const t=new f.a(this.width,this.height);return t.addColorAttachment(this,0),t}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return u})),r.d(e,"b",(function(){return h}));var i=r(1),n=r(0),s=r(4),o=r(2);const a=Array;class u extends a{get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}get magnitude(){return Math.hypot(...this)}get normalized(){const t=this.magnitude;return 0==t?h.zero():this.clone().div(h(t,t,t,t))}get negative(){return this.clone().negate()}get inversed(){return this.clone().inverse()}constructor(t,e,r=0,i=0){super(t,e,r||0,i||0)}static zero(){return new u(0,0,0,0)}static one(){return new u(1,1,1,1)}asMut(){return this}plus(t){return h.plus(this,this,t)}minus(t){return h.minus(this,this,t)}mul(t){return h.mul(this,this,t)}div(t){return h.div(this,this,t)}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}normalize(){return h.normalize(this,this)}inverse(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this[3]=1/this[3],this}negate(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this[3]=-this[3],this}clone(t=h.zero()){return t.set(this)}equals(t){return void 0!==t&&(t[0]===this[0]&&t[1]===this[1]&&t[2]===this[2]&&t[3]===this[3])}set(t){return this[0]=t[0]||0,this[1]=t[1]||0,this[2]=t[2]||0,this[3]=t[3]||0,this}fill(t){return this[0]=this[1]=this[2]=this[3]=t,this}static math(t){return(...e)=>h(t(...e.map(t=>t.x)),t(...e.map(t=>t.y)),t(...e.map(t=>t.z)),t(...e.map(t=>t.w)))}static mathNonAlloc(t){return(e,...r)=>(e[0]=t(...r.map(t=>t[0])),e[1]=t(...r.map(t=>t[1])),e[2]=t(...r.map(t=>t[2])),e[3]=t(...r.map(t=>t[3])),e)}__to(t){switch(t){case u:return this.clone();case i.a:return Object(i.b)(this[0],this[1],this[2]);case n.a:return Object(n.b)(this[0],this[1])}return this.clone()}}function h(t,e=t,r=t,i=t){return new u(t,e,r,i)}h.from=t=>{const[e=0,r=0,i=0,n=0]=t;return h(e,r,i,n)},h.floor=t=>h(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z),Math.floor(t.w)),h.zero=u.zero,h.one=u.one,h.math=u.math,h.mathNonAlloc=u.mathNonAlloc,h.normalize=Object(o.b)(s.f.normalize,1,h.zero),h.plus=Object(o.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]+r,t[1]=e[1]+r,t[2]=e[2]+r,t[3]=e[3]+r):(t[0]=e[0]+r[0],t[1]=e[1]+(r[1]||0),t[2]=e[2]+(r[2]||0),t[3]=e[3]+(r[3]||0)),t),2,h.zero),h.minus=Object(o.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]-r,t[1]=e[1]-r,t[2]=e[2]-r,t[3]=e[3]-r):(t[0]=e[0]-r[0],t[1]=e[1]-(r[1]||0),t[2]=e[2]-(r[2]||0),t[3]=e[3]-(r[3]||0)),t),2,h.zero),h.mul=Object(o.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r):(t[0]=e[0]*r[0],t[1]=e[1]*(void 0===r[1]?1:r[1]),t[2]=e[2]*(void 0===r[2]?1:r[2]),t[3]=e[3]*(void 0===r[3]?1:r[3])),t),2,h.zero),h.div=Object(o.b)((t,e,r)=>("number"==typeof r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r,t[3]=e[3]/r):(t[0]=e[0]/r[0],t[1]=e[1]/(void 0===r[1]?1:r[1]),t[2]=e[2]/(void 0===r[2]?1:r[2]),t[3]=e[3]/(void 0===r[3]?1:r[3])),t),2,h.zero),h.set=Object(o.b)((t,e)=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t),1,h.zero),h.fill=Object(o.b)((t,e)=>(t[0]=t[1]=t[2]=t[3]=e,t),1,h.zero)},function(t,e,r){"use strict";var i;function n(t,e){return{[i.RGB]:[t.RGB,t.RGB,t.UNSIGNED_BYTE],[i.RGBA]:[t.RGBA,t.RGBA,t.UNSIGNED_BYTE],[i.LUMINANCE_ALPHA]:[t.LUMINANCE_ALPHA,t.LUMINANCE_ALPHA,t.UNSIGNED_BYTE],[i.LUMINANCE]:[t.LUMINANCE,t.LUMINANCE,t.UNSIGNED_BYTE],[i.ALPHA]:[t.ALPHA,t.ALPHA,t.UNSIGNED_BYTE],[i.R8]:[t.R8,t.RED,t.UNSIGNED_BYTE],[i.R16F]:[t.R16F,t.RED,t.HALF_FLOAT],[i.R32F]:[t.R32F,t.RED,t.FLOAT],[i.R8UI]:[t.R8UI,t.RED_INTEGER,t.UNSIGNED_BYTE],[i.RG8]:[t.RG8,t.RG,t.UNSIGNED_BYTE],[i.RG16F]:[t.RG16F,t.RG,t.HALF_FLOAT],[i.RG32F]:[t.RG32F,t.RG,t.FLOAT],[i.RG8UI]:[t.RG8UI,t.RG_INTEGER,t.UNSIGNED_BYTE],[i.RGB8]:[t.RGB8,t.RGB,t.UNSIGNED_BYTE],[i.SRGB8]:[t.SRGB8,t.RGB,t.UNSIGNED_BYTE],[i.RGB565]:[t.RGB565,t.RGB,t.UNSIGNED_BYTE],[i.R11F_G11F_B10F]:[t.R11F_G11F_B10F,t.RGB,t.UNSIGNED_INT_10F_11F_11F_REV],[i.RGB9_E5]:[t.RGB9_E5,t.RGB,t.HALF_FLOAT],[i.RGB16F]:[t.RGB16F,t.RGB,t.HALF_FLOAT],[i.RGB32F]:[t.RGB32F,t.RGB,t.FLOAT],[i.RGB8UI]:[t.RGB8UI,t.RGB_INTEGER,t.UNSIGNED_BYTE],[i.RGBA8]:[t.RGBA8,t.RGBA,t.UNSIGNED_BYTE],[i.SRGB8_ALPHA8]:[t.SRGB8_ALPHA8,t.RGBA,t.UNSIGNED_BYTE],[i.RGB5_A1]:[t.RGB5_A1,t.RGBA,t.UNSIGNED_BYTE],[i.RGB10_A2]:[t.RGB10_A2,t.RGBA,t.UNSIGNED_INT_2_10_10_10_REV],[i.RGBA4]:[t.RGBA4,t.RGBA,t.UNSIGNED_BYTE],[i.RGBA16F]:[t.RGBA16F,t.RGBA,t.HALF_FLOAT],[i.RGBA32F]:[t.RGBA32F,t.RGBA,t.FLOAT],[i.RGBA8UI]:[t.RGBA8UI,t.RGBA_INTEGER,t.UNSIGNED_BYTE],[i.DEPTH_COMPONENT]:[t.DEPTH_COMPONENT,t.DEPTH_COMPONENT,t.UNSIGNED_INT],[i.DEPTH_STENCIL]:[t.DEPTH_STENCIL,t.DEPTH_COMPONENT,t.UNSIGNED_INT]}[e]}r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return n})),function(t){t[t.RGB=WebGL2RenderingContext.RGB]="RGB",t[t.RGBA=WebGL2RenderingContext.RGBA]="RGBA",t[t.LUMINANCE_ALPHA=WebGL2RenderingContext.LUMINANCE_ALPHA]="LUMINANCE_ALPHA",t[t.LUMINANCE=WebGL2RenderingContext.LUMINANCE]="LUMINANCE",t[t.ALPHA=WebGL2RenderingContext.ALPHA]="ALPHA",t[t.R8=WebGL2RenderingContext.R8]="R8",t[t.R16F=WebGL2RenderingContext.R16F]="R16F",t[t.R32F=WebGL2RenderingContext.R32F]="R32F",t[t.R8UI=WebGL2RenderingContext.R8UI]="R8UI",t[t.RG8=WebGL2RenderingContext.RG8]="RG8",t[t.RG16F=WebGL2RenderingContext.RG16F]="RG16F",t[t.RG32F=WebGL2RenderingContext.RG32F]="RG32F",t[t.RG8UI=WebGL2RenderingContext.RG8UI]="RG8UI",t[t.RGB8=WebGL2RenderingContext.RGB8]="RGB8",t[t.SRGB8=WebGL2RenderingContext.SRGB8]="SRGB8",t[t.RGB565=WebGL2RenderingContext.RGB565]="RGB565",t[t.R11F_G11F_B10F=WebGL2RenderingContext.R11F_G11F_B10F]="R11F_G11F_B10F",t[t.RGB9_E5=WebGL2RenderingContext.RGB9_E5]="RGB9_E5",t[t.RGB16F=WebGL2RenderingContext.RGB16F]="RGB16F",t[t.RGB32F=WebGL2RenderingContext.RGB32F]="RGB32F",t[t.RGB8UI=WebGL2RenderingContext.RGB8UI]="RGB8UI",t[t.RGBA8=WebGL2RenderingContext.RGBA8]="RGBA8",t[t.SRGB8_ALPHA8=WebGL2RenderingContext.SRGB8_ALPHA8]="SRGB8_ALPHA8",t[t.RGB5_A1=WebGL2RenderingContext.RGB5_A1]="RGB5_A1",t[t.RGB10_A2=WebGL2RenderingContext.RGB10_A2]="RGB10_A2",t[t.RGBA4=WebGL2RenderingContext.RGBA4]="RGBA4",t[t.RGBA16F=WebGL2RenderingContext.RGBA16F]="RGBA16F",t[t.RGBA32F=WebGL2RenderingContext.RGBA32F]="RGBA32F",t[t.RGBA8UI=WebGL2RenderingContext.RGBA8UI]="RGBA8UI",t[t.DEPTH_COMPONENT=WebGL2RenderingContext.DEPTH_COMPONENT]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=WebGL2RenderingContext.DEPTH_STENCIL]="DEPTH_STENCIL"}(i||(i={}))},function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"c",(function(){return o})),r.d(e,"d",(function(){return a})),r.d(e,"b",(function(){return u}));var i=r(28),n=r(3);class s{constructor(t){this.destroyed=!1,this.assetID=u.newAssetID(this),this.name=t||"Asset_"+this.assetID}destroy(){this.destroyed=!0,u.destroy(this.assetID)}}class o extends s{constructor(t=Object(n.d)(),e){super(e),this.initialized=!1,this.ctx=t}tryInit(t=!1){if(this.initialized)return!0;this.ctx||(this.ctx=Object(n.d)());const e=this.ctx&&this.init();if(!e&&t)throw new Error(`Failed to init GPU Asset '${this.name}' without global gl context.`);return this.initialized=e,e}}class a extends s{constructor(t=Object(n.d)()){super(),this.initialzed=!1,this.ctx=t}tryInit(t=!1){if(this.initialzed)return!0;const e=this.ctx||Object(n.d)();if(!e){if(t)throw new Error("Failed to initialize GPU resource withou a global GL context.");return!1}if(this.ctx=e,this.init())return this.initialzed=!0,!0;if(t)throw new Error("Failed to initialize required GPU resource.");return!1}}const u=new class{constructor(){this.assetsMap=new Map,this.id=1,this.eventEmitter=new i.a}newAssetID(t){const e=++this.id;return this.assetsMap.set(e,t),t.assetID=e}find(t){if("number"==typeof t)return this.assetsMap.get(t);if("string"==typeof t)for(const e of this.assetsMap.values())if(e.name===t)return e}destroy(t){this.assetsMap.get(t)&&this.assetsMap.delete(t)}findAssetsOfType(t){return Array.from(this.assetsMap.values()).filter(e=>e instanceof t)}on(t,e){return this.eventEmitter.on(t,e)}off(t,e){return this.eventEmitter.off(t,e)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return l})),r.d(e,"b",(function(){return d})),r.d(e,"e",(function(){return f})),r.d(e,"c",(function(){return m})),r.d(e,"d",(function(){return p}));var i=r(1),n=r(0),s=r(11),o=r(3),a=r(10),u=r(6),h=r(15),c=r(23);const l={vert:"vec3",color:"vec4",normal:"vec3",uv:"vec2",uv2:"vec2"},d=c.a.from(l);function f(t){return t}class m extends h.a{constructor(...t){super("Mesh"),this.ctx=null,this.initialized=!1,this.vertexArray=null,this.elementBuffer=null,this.dirty=!0,this.indices=new Uint32Array,0===t.length?(this.ctx=Object(o.d)(),this.vertices=new c.b(l,0,this.ctx)):1===t.length?t[0]instanceof o.c?(this.ctx=t[0],this.vertices=new c.b(l,0,this.ctx)):(this.ctx=Object(o.d)(),this.vertices=new c.b(t[0],0,this.ctx)):(this.ctx=t[1]||Object(o.d)(),this.vertices=new c.b(t[0],0,this.ctx)),this.tryInit(!1)}get verts(){return this.getVertexDataArray("vert",i.b.zero)}set verts(t){this.setVertexDataArray("vert",t)}get uvs(){return this.getVertexDataArray("uv",n.b.zero)}set uvs(t){this.setVertexDataArray("uv",t)}get colors(){return this.getVertexDataArray("color",()=>s.a.black)}set colors(t){this.setVertexDataArray("color",t)}get normals(){return this.getVertexDataArray("uv2",i.b.zero)}set normals(t){this.setVertexDataArray("normal",t)}get uv2(){return this.getVertexDataArray("uv2",n.b.zero)}set uv2(t){this.setVertexDataArray("uv2",t)}get triangles(){return Array.from(this.indices)}set triangles(t){t.length>this.indices.length&&(this.indices=new Uint32Array(t.length)),this.indices.set(t)}getVertexDataArray(t,e){return this.vertices.map(r=>e().set(r[t]))}setVertexDataArray(t,e){this.vertices;e.length>=this.vertices.length&&this.vertices.resize(e.length),e.forEach((e,r)=>this.vertices[r][t].set(e))}resize(t,e,r=!1){this.vertices.resize(t,r);let i=this.indices;this.indices=new Uint32Array(e),r&&(e<i.length&&(i=new Uint32Array(i.buffer,0,e)),this.indices.set(i,0)),this.dirty=!0}update(t=!1){this.dirty=!0,this.vertices.markDirty(),t&&this.upload()}upload(){if(this.tryInit(!0),!this.dirty)return!1;const t=this.ctx.gl;return this.vertices.upload(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.dirty=!1,!0}bind(){this.upload();const t=this.ctx.gl;return t.bindVertexArray(this.vertexArray),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.elementBuffer),this.indices.length}unbind(){this.tryInit(!0);const t=this.ctx.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindVertexArray(null)}calculateNormals(t=0){if(this.triangles.length%3!=0)throw new Error("Invalid triangles.");for(let t=0;t<this.triangles.length;t+=3){const e=this.vertices[this.triangles[t+0]].vert,r=this.vertices[this.triangles[t+1]].vert,n=this.vertices[this.triangles[t+2]].vert,s=Object(u.h)(r,e),o=Object(u.h)(n,e),a=Object(u.d)(s,o).normalize();i.b.plus(this.vertices[this.triangles[t+0]].normal,this.vertices[this.triangles[t+0]].normal,a),i.b.plus(this.vertices[this.triangles[t+1]].normal,this.vertices[this.triangles[t+1]].normal,a),i.b.plus(this.vertices[this.triangles[t+2]].normal,this.vertices[this.triangles[t+2]].normal,a)}for(let t=0;t<this.vertices.length;t++)i.b.normalize(this.vertices[t].normal,this.vertices[t].normal)}tryInit(t=!1){var e,r;if(this.initialized)return!0;if(this.ctx=this.ctx||Object(o.d)(),!this.ctx){if(t)throw new Error("Failed to init mesh without global GL context");return!1}const i=this.ctx.gl;return this.elementBuffer=null!==(e=i.createBuffer())&&void 0!==e?e:Object(a.c)("Failed to create element buffer object."),this.vertexArray=null!==(r=i.createVertexArray())&&void 0!==r?r:Object(a.c)("Failed to create vertex array object."),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.elementBuffer),i.bindVertexArray(this.vertexArray),this.vertices.bindVertexArray(),i.bindVertexArray(null),this.initialized=!0,!0}}class p extends h.a{constructor(t=Object(o.b)()){super(),this._verts=[],this._triangles=[],this._uvs=[],this._uv2=[],this._colors=[],this._normals=[],this.dirty=!0,this.uploaded=!1,this.vertices=new Float32Array(0),this.indices=new Uint32Array(0),this.VAO=null,this.VBO=null,this.EBO=null,this.initialized=!1,this.name="Mesh_"+this.assetID,this.vertexStruct=d,this.gl=t,this.tryInit(!1)}get verts(){return this._verts}set verts(t){this._verts=t,this.dirty=!0}get triangles(){return this._triangles}set triangles(t){this._triangles=t,this.dirty=!0}get uvs(){return this._uvs}set uvs(t){this._uvs=t,this.dirty=!0}get uv2(){return this._uv2}set uv2(t){this._uv2=t,this.dirty=!0}get colors(){return this._colors}set colors(t){this._colors=t,this.dirty=!0}get normals(){return this._normals}set normals(t){this._normals=t,this.dirty=!0}clear(){this.verts=[],this.uvs=[],this.triangles=[],this.colors=[],this.normals=[]}calculateNormals(t=0){if(this.triangles.length%3!=0)throw new Error("Invalid triangles.");this.normals=Object(a.a)(()=>Object(i.b)(0,0,0),this.verts.length);for(let t=0;t<this.triangles.length;t+=3){const e=this.verts[this.triangles[t]],r=this.verts[this.triangles[t+1]],i=this.verts[this.triangles[t+2]],n=Object(u.h)(r,e),s=Object(u.h)(i,e),o=Object(u.d)(n,s).normalize();this.normals[this.triangles[t+0]].plus(o),this.normals[this.triangles[t+1]].plus(o),this.normals[this.triangles[t+2]].plus(o)}for(let t=0;t<this.normals.length;t++)this.normals[t]=this.normals[t].normalize()}update(){if(this.dirty){if(this.triangles.length%3!=0)throw new Error("Invalid triangles.");if(this.colors.length!==this.verts.length&&(this.colors=[...this.colors,...Object(a.a)(s.a.white,this.verts.length-this.colors.length)]),this.uvs.length!==this.verts.length&&(this.uvs=[...this.uvs,...Object(a.a)(Object(n.b)(0,0),this.verts.length-this.uvs.length)]),this.uv2.length!==this.verts.length&&(this.uv2=[...this.uv2,...Object(a.a)(Object(n.b)(0,0),this.verts.length-this.uv2.length)]),this.normals.length!==this.verts.length&&(this.normals=[...this.normals,...Object(a.a)(Object(i.b)(0,0,0),this.verts.length-this.normals.length)]),this.vertices=new Float32Array(this.verts.flatMap((t,e)=>[...t,...this.colors[e],...this.normals[e],...this.uvs[e],...this.uv2[e]])),this.vertices.length!=14*this.verts.length)throw new Error("Buffer with invalid length.");this.indices=new Uint32Array(this.triangles.flat()),this.dirty=!1,this.uploaded=!1}}setup(){this.update(),this.tryInit(!0);const t=this.gl;return this.uploaded||(t.bindBuffer(t.ARRAY_BUFFER,this.VBO),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.EBO),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.uploaded=!0),[this.VBO,this.EBO]}bind(t){this.setup();const e=this.gl;e.bindVertexArray(this.VAO),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.EBO)}unbind(){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindVertexArray(null)}destroy(){this.initialized&&(this.destroyed||(this.gl.deleteBuffer(this.VBO),this.gl.deleteBuffer(this.EBO),super.destroy()))}tryInit(t=!1){var e,r;if(this.initialized)return!0;const i=this.gl||Object(o.b)();if(!i){if(t)throw new Error("Failed to init mesh without global GL context");return!1}return this.gl=i,this.VBO=null!==(e=i.createBuffer())&&void 0!==e?e:Object(a.c)("Failed to create vertex buffer."),this.EBO=null!==(r=i.createBuffer())&&void 0!==r?r:Object(a.c)("Failed to create element buffer."),this.initVAO(),this.initialized=!0,!0}initVAO(){var t;const e=this.gl;this.VAO=null!==(t=e.createVertexArray())&&void 0!==t?t:Object(a.c)("Failed to create vertex array object."),e.bindVertexArray(this.VAO),e.bindBuffer(e.ARRAY_BUFFER,this.VBO);for(const t of this.vertexStruct.elements)e.enableVertexAttribArray(t.location),e.vertexAttribPointer(t.location,t.length,e.FLOAT,!1,this.vertexStruct.byteSize,t.byteOffset);e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var i=r(3),n=r(10),s=r(0),o=r(15);WebGL2RenderingContext.BACK;class a extends o.c{constructor(t=0,e=0,r=Object(i.d)()){super(r),this.frameBuffer=null,this._colorAttachments=[],this._depthAttachment=null,this.activeBuffers=[],this.dirty=!0,this.size=Object(s.b)(Math.floor(t),Math.floor(e)),this.tryInit(!1)}get width(){return this.size.x}get height(){return this.size.y}get colorAttachments(){return this._colorAttachments}get depthAttachment(){return this._depthAttachment}glFBO(){return this.tryInit(!0),this.frameBuffer}addColorAttachment(t,e=this._colorAttachments.length){t.width===this.size.x&&t.height===this.size.y||console.warn(`Color attachment size [${t.width}, ${t.height}] missmatch with framebuffer.`),this._colorAttachments[e]=t,this.dirty=!0}setDepthAttachment(t){t.width===this.size.x&&t.height===this.size.y||console.warn(`Depth attachment size [${t.width}, ${t.height}] missmatch with framebuffer.`),this._depthAttachment=t,this.dirty=!0}reset(t=this.width,e=this.height){this.size.x=t,this.size.y=e,this._colorAttachments=[],this._depthAttachment=null,this.dirty=!0}init(){var t;const e=this.ctx.gl;return this.frameBuffer=null!==(t=e.createFramebuffer())&&void 0!==t?t:Object(n.c)("Failed to create frame buffer object"),!0}bind(){this.tryInit(!0);const t=this.ctx.gl;this.activeBuffers=[],t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);for(let e=0;e<this._colorAttachments.length;e++)this._colorAttachments[e]?(this._colorAttachments[e].bindFramebuffer(e),this.activeBuffers.push(t.COLOR_ATTACHMENT0+e)):t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null);this._depthAttachment?(this._depthAttachment.bindFramebuffer(),this.activeBuffers.push(t.DEPTH_ATTACHMENT)):t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,null),t.viewport(0,0,this.width,this.height),t.drawBuffers(this.activeBuffers)}destroy(){super.destroy();this.ctx.gl.deleteFramebuffer(this.frameBuffer)}}a.CanvasBuffer=Object.freeze(new class{get name(){return""}get assetID(){return-1}get width(){return Object(i.d)().width}get height(){return Object(i.d)().height}get size(){return Object(i.d)().renderer.canvasSize}bind(){const t=Object(i.d)().gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.width,this.height)}destroy(){}})},function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return o}));var i=r(7),n=r(20);const s={matM:"uTransformM",matM_IT:"uTransformM_IT",matMInv:"uTransformMInv",matVP:"uTransformVP",matMVP:"uTransformMVP",matMV_IT:"uTransformMV_IT",flipUV:"uFlipUV",mainTex:"uMainTex",color:"uColor"};function o(t){return{DefaultShader:new i.e(n.BuiltinShaderSources.defaultVert,n.BuiltinShaderSources.defaultFrag,{name:"DefaultShader"},t),BlitCopy:new i.e(n.BuiltinShaderSources.defaultVert,n.BuiltinShaderSources.blitCopy,{name:"BlitCopy",depth:i.d.Always,blend:i.a.Disable,zWrite:!1},t),FlipTexture:new i.e(n.BuiltinShaderSources.flipVert,n.BuiltinShaderSources.blitCopy,{},t),ColoredLine:new i.e(n.BuiltinShaderSources.colorVert,n.BuiltinShaderSources.colorFrag,{blend:[i.a.SrcAlpha,i.a.OneMinusSrcAlpha],depth:i.d.Disable,zWrite:!1},t),ErrorShader:new i.e(n.BuiltinShaderSources.defaultVert,n.BuiltinShaderSources.texFrag,{name:"Error"},t)}}},function(t,e,r){"use strict";var i=Object.defineProperty;i(e,"__esModule",{value:!0}),((t,e)=>{for(var r in e)i(t,r,{get:e[r],enumerable:!0})})(e,{ShaderSource:()=>o});var n="#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec4 aColor;\r\nin vec2 aUV;\r\nin vec3 aNormal;\r\n\r\nuniform mat4 uTransformM;\r\nuniform mat4 uTransformVP;\r\nuniform mat4 uTransformMVP;\r\nuniform mat4 uTransformM_IT;\r\n\r\nout vec4 vColor;\r\nout vec4 vPos;\r\nout vec2 vUV;\r\nout vec3 vNormal;\r\nout vec3 vWorldPos;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = uTransformMVP * vec4(aPos, 1);\r\n    vPos = gl_Position;\r\n    vColor = aColor;\r\n    vUV = aUV;\r\n    vNormal = (uTransformM_IT *  vec4(aNormal, 0)).xyz;\r\n    vWorldPos = (uTransformM * vec4(aPos, 1)).xyz;\r\n    \r\n}",s="#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\nin vec2 vUV;\r\n\r\nuniform sampler2D uMainTex;\r\nuniform vec4 uColor;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    vec4 color = texture(uMainTex, vUV.xy).rgba;\r\n    // color = color * vec3(uColor);\r\n    fragColor = color.rgba * vColor.rgba * uColor.rgba;\r\n    // fragColor = vec4(vUV.xy, 0, 1);\r\n}",o={default2D:[n,s],particle2D:["#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec4 aColor;\r\nin vec2 aUV;\r\nin vec3 aNormal;\r\n\r\nin vec3 particlePos;\r\nin vec3 particleRotation;\r\nin float particleSize;\r\n\r\nuniform mat4 uTransformM;\r\nuniform mat4 uTransformVP;\r\nuniform mat4 uTransformMVP;\r\nuniform mat4 uTransformM_IT;\r\n\r\nout vec4 vColor;\r\nout vec4 vPos;\r\nout vec2 vUV;\r\nout vec3 vNormal;\r\nout vec3 vWorldPos;\r\n\r\n#define PI (3.14159265358979323846264338327950288419716939937510)\r\n\r\nvec4 from_euler(float x, float y, float z)\r\n{\r\n    float halfToRad = PI / 360.0;\r\n    x *= halfToRad;\r\n    z *= halfToRad;\r\n    y *= halfToRad;\r\n\r\n    float sx = sin(x);\r\n    float cx = cos(x);\r\n    float sy = sin(y);\r\n    float cy = cos(y);\r\n    float sz = sin(z);\r\n    float cz = cos(z);\r\n\r\n    vec4 q;\r\n    q[0] = sx * cy * cz - cx * sy * sz;\r\n    q[1] = cx * sy * cz + sx * cy * sz;\r\n    q[2] = cx * cy * sz - sx * sy * cz;\r\n    q[3] = cx * cy * cz + sx * sy * sz;\r\n    return q;\r\n}\r\n\r\nmat4 from_rts(vec4 q, vec3 v, vec3 s)\r\n{\r\n    mat4 m;\r\n    float x = q[0];\r\n    float y = q[1];\r\n    float z = q[2];\r\n    float w = q[3];\r\n    float x2 = x + x;\r\n    float y2 = y + y;\r\n    float z2 = z + z;\r\n\r\n    float xx = x * x2;\r\n    float xy = x * y2;\r\n    float xz = x * z2;\r\n    float yy = y * y2;\r\n    float yz = y * z2;\r\n    float zz = z * z2;\r\n    float wx = w * x2;\r\n    float wy = w * y2;\r\n    float wz = w * z2;\r\n    float sx = s[0];\r\n    float sy = s[1];\r\n    float sz = s[2];\r\n\r\n    m[0][0] = (1.0 - (yy + zz)) * sx;\r\n    m[0][1] = (xy + wz) * sx;\r\n    m[0][2] = (xz - wy) * sx;\r\n    m[0][3] = 0.0;\r\n    m[1][0] = (xy - wz) * sy;\r\n    m[1][1] = (1.0 - (xx + zz)) * sy;\r\n    m[1][2] = (yz + wx) * sy;\r\n    m[1][3] = 0.0;\r\n    m[2][0] = (xz + wy) * sz;\r\n    m[2][1] = (yz - wx) * sz;\r\n    m[2][2] = (1.0 - (xx + yy)) * sz;\r\n    m[2][3] = 0.0;\r\n    m[3][0] = v[0];\r\n    m[3][1] = v[1];\r\n    m[3][2] = v[2];\r\n    m[3][3] = 1.0;\r\n\r\n    return m;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec4 rotation = from_euler(particleRotation.x, particleRotation.y, particleRotation.z);\r\n    mat4 rts = from_rts(rotation, particlePos, vec3(particleSize));\r\n    mat4 mvp = uTransformMVP * rts;\r\n    gl_Position = mvp * vec4(aPos, 1);\r\n    vPos = gl_Position;\r\n    vColor = aColor;\r\n    vUV = aUV;\r\n    vNormal = (uTransformM_IT *  vec4(aNormal, 0)).xyz;\r\n    vWorldPos = (uTransformM * vec4(aPos, 1)).xyz;\r\n    \r\n}",s],shadow2D:["#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec4 aColor;\r\nin vec2 aUV;\r\nin vec3 aNormal;\r\nin vec2 aP0;\r\nin vec2 aP1;\r\n\r\nuniform mat4 uTransformM;\r\nuniform mat4 uTransformVP;\r\nuniform mat4 uTransformMVP;\r\nuniform mat4 uTransformM_IT;\r\n\r\nout vec4 vColor;\r\nout vec4 vPos;\r\nout vec2 vUV;\r\nout vec3 vNormal;\r\nout vec3 vP;\r\nout vec2 vP0;\r\nout vec2 vP1;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = uTransformMVP * vec4(aPos, 1);\r\n    vPos = gl_Position;\r\n    vColor = aColor;\r\n    vUV = aUV;\r\n    vNormal = (uTransformM_IT *  vec4(aNormal, 0)).xyz;\r\n    vP = aPos;\r\n    vP0 = aP0;\r\n    vP1 = aP1;\r\n    \r\n}","#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vPos;\r\nin vec2 vP0;\r\nin vec2 vP1;\r\nin vec3 vP;\r\n\r\nuniform vec2 uLightPos;\r\nuniform float uVolumnSize;\r\nuniform float uLightRange;\r\n\r\nout float fragColor;\r\n\r\n#define PI (3.14)\r\n\r\n// See: https://www.geogebra.org/geometry/ysvegxsz\r\n\r\nbool circleTangent(vec2 p, vec2 center, float radius, out vec2 p1, out vec2 p2)\r\n{\r\n    float r2 = radius * radius;\r\n    float d2 = (p.x - center.x) * (p.x - center.x) + (p.y - center.y) * (p.y - center.y);\r\n    if (d2 < r2)\r\n        return false;\r\n\r\n    vec2 p0 = p - center;\r\n    p1 = vec2(r2 / d2) * p0 + vec2(radius / d2 * sqrt(d2 - r2)) * vec2(-p0.y, p0.x);\r\n    p2 = vec2(r2 / d2) * p0 - vec2(radius / d2 * sqrt(d2 - r2)) * vec2(-p0.y, p0.x);\r\n    p1 += center;\r\n    p2 += center;\r\n    return true;\r\n}\r\n\r\nfloat cross2(vec2 u, vec2 v)\r\n{\r\n\treturn cross(vec3(u, 0.0), vec3(v, 0.0)).z;\r\n}\r\nfloat saturate(float x)\r\n{\r\n    return clamp(x, 0.0, 1.0);\r\n    // return min(max(x, 0.0), 1.0);\r\n    if (x <= 0.0)\r\n        return 0.0;\r\n    else if (x >= 1.0)\r\n        return 1.0;\r\n    return x;\r\n}\r\n// Fix undefined result when x > 1\r\nfloat fixacos(float x) {\r\n    if (x >= 1.0)\r\n        return 0.0;\r\n    return acos(x);\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 p = vP.xy;\r\n    vec2 p1, p2;\r\n    // p1 = uLightPos.xy;\r\n    // p2 = uLightPos.xy;\r\n    circleTangent(p, vec2(0), uVolumnSize, p1, p2);\r\n    vec2 right = normalize(p1 - p);\r\n    vec2 left = normalize(p2 - p);\r\n    vec2 u = normalize(vP1 - p);\r\n    vec2 v = normalize(vP0 - p);\r\n    if(cross2(v, u) < 0.0)\r\n    {\r\n        vec2 t = v;\r\n        v = u;\r\n        u = t;\r\n    }\r\n    \r\n\tfloat leftLeak = saturate(sign(cross2(u, left))) * fixacos(dot(u, left));\r\n\tfloat rightLeak = saturate(sign(cross2(right, v))) * fixacos(dot(right, v));\r\n    float total = acos(dot(right, left));\r\n\r\n\r\n    fragColor = 1.0 - (leftLeak + rightLeak) / total;\r\n}"],light2D:["// #version 300 es\r\nprecision mediump float;\r\n\r\nattribute vec3 aPos;\r\nattribute vec4 aColor;\r\nattribute vec2 aUV;\r\nattribute vec3 aNormal;\r\n\r\nuniform mat4 uTransformM;\r\nuniform mat4 uTransformVP;\r\nuniform mat4 uTransformMVP;\r\nuniform mat4 uTransformM_IT;\r\n\r\nvarying vec4 vColor;\r\nvarying vec4 vPos;\r\nvarying vec2 vUV;\r\nvarying vec3 vNormal;\r\nvarying vec3 vWorldPos;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = uTransformMVP * vec4(aPos, 1);\r\n    vPos = gl_Position;\r\n    vColor = aColor;\r\n    vUV = aUV;\r\n    vNormal = (uTransformM_IT *  vec4(aNormal, 0)).xyz;\r\n    vWorldPos = (uTransformM * vec4(aPos, 1)).xyz;\r\n    \r\n}","// #version 300 es\r\nprecision mediump float;\r\n\r\n#define MAX_LIGHT 4\r\n\r\nvarying vec2 vUV;\r\n\r\nuniform vec4 uLightPosList[MAX_LIGHT];\r\nuniform vec4 uLightColorList[MAX_LIGHT];\r\nuniform vec4 uLightParamsList[MAX_LIGHT]; // (volumn, range, attenuation, intensity)\r\nuniform sampler2D uShadowMapList[MAX_LIGHT];\r\nuniform int uLightCount;\r\nuniform vec4 uCameraParams; // (pos.x, pos.y, viewWidth, viewHgith)\r\nuniform vec4 uAmbientLightColor;\r\n\r\n// out vec4 fragColor;\r\n\r\nfloat lightAttenuation(float r, float attenuation)\r\n{\r\n    if(attenuation <= -1.0)\r\n        return 0.0;\r\n    else if (attenuation <= 0.0)\r\n    {\r\n        float t = 1.0 / (attenuation + 1.0) - 1.0;\r\n        return exp(-r * t) - exp(-t) * r;\r\n    }\r\n    else if (attenuation < 1.0)\r\n    {\r\n        float t = 1.0 / (1.0 - attenuation) - 1.0;\r\n        r = 1.0 - r;\r\n        return 1.0 - (exp(-r * t) - exp(-t) * r);\r\n    }\r\n    else {\r\n        return r >= 1.0 ? 0.0 : 1.0;\r\n    }\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec2 worldPos = (vUV - vec2(0.5)) * uCameraParams.zw + uCameraParams.xy;\r\n    for (int i = 0; i < MAX_LIGHT; i++)\r\n    {\r\n        float r = distance(uLightPosList[i].xy, worldPos);\r\n        r -= uLightParamsList[i].x;\r\n        r = r / (uLightParamsList[i].y -  uLightParamsList[i].x);\r\n        float light = lightAttenuation(clamp(r, 0.0, 1.0), uLightParamsList[i].z);\r\n        light *= uLightParamsList[i].w;\r\n        float shadow = texture2D(uShadowMapList[i], vUV.xy).r;\r\n        light *= 1.0 - shadow;\r\n        \r\n        gl_FragColor += vec4(light) * uLightColorList[i].rgba;\r\n    }\r\n    gl_FragColor += uAmbientLightColor;\r\n    \r\n}"],light2DSimple:["#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec2 aUV;\r\nin vec4 aLightColor;\r\nin vec4 aLightParams; // (volumn, range, attenuation, intensity)\r\nin vec3 aLightPos;\r\n\r\nuniform mat4 uTransformMVP;\r\n\r\nout vec4 vLightColor;\r\nout vec4 vLightParams; \r\nout vec3 vLightPos;\r\nout vec4 vPos;\r\nout vec2 vUV;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = uTransformMVP * vec4(aPos.xy * vec2(aLightParams.y) + aLightPos.xy, 0, 1);\r\n    vPos = gl_Position;\r\n    vUV = aUV;\r\n    vLightParams = aLightParams;\r\n    vLightColor = aLightColor;\r\n    vLightPos = aLightPos;\r\n}","#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vLightColor;\r\nin vec4 vLightParams; // (volumn, range, attenuation, intensity)\r\nin vec4 vPos;\r\nin vec2 vUV;\r\n\r\nout vec4 fragColor;\r\n\r\nfloat lightAttenuation(float r, float range, float volumn, float attenuation)\r\n{\r\n    r -= volumn;\r\n    r /= range - volumn;\r\n    if(attenuation <= -1.0)\r\n        return 0.0;\r\n    else if (attenuation <= 0.0)\r\n    {\r\n        float t = 1.0 / (attenuation + 1.0) - 1.0;\r\n        return exp(-r * t) - exp(-t) * r;\r\n    }\r\n    else if (attenuation < 1.0)\r\n    {\r\n        float t = 1.0 / (1.0 - attenuation) - 1.0;\r\n        r = 1.0 - r;\r\n        return 1.0 - (exp(-r * t) - exp(-t) * r);\r\n    }\r\n    else {\r\n        return r >= 1.0 ? 0.0 : 1.0;\r\n    }\r\n}\r\n\r\nvoid main()\r\n{\r\n    float r = length(vUV * vec2(2) - vec2(1)) * vLightParams.y;\r\n    float attenuation = lightAttenuation(r, vLightParams.y, vLightParams.x, vLightParams.z);\r\n    attenuation = max(attenuation, 0.0);\r\n    attenuation *= vLightParams.w;\r\n    vec3 color = vLightColor.rgb * vec3(attenuation);\r\n\r\n    fragColor = vec4(color, 1);\r\n    // fragColor = vec4(1);\r\n}"],boxBlur:[n,"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\nin vec2 vUV;\r\n\r\nuniform sampler2D uMainTex;\r\nuniform vec4 uTexSize; // (w, h, 1/w, 1/h)\r\nuniform float uSampleOffset;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    vec2 delta = vec2(-uSampleOffset, uSampleOffset);\r\n    vec4 color = \r\n      texture(uMainTex, clamp(vUV.xy + uTexSize.zw * delta.xx, vec2(0), vec2(1)))\r\n    + texture(uMainTex, clamp(vUV.xy + uTexSize.zw * delta.yx, vec2(0), vec2(1)))\r\n    + texture(uMainTex, clamp(vUV.xy + uTexSize.zw * delta.yy, vec2(0), vec2(1)))\r\n    + texture(uMainTex, clamp(vUV.xy + uTexSize.zw * delta.xy, vec2(0), vec2(1)));\r\n\r\n    color /= vec4(4.0);\r\n\r\n    fragColor = color.rgba;\r\n}"],bloomFilter:[n,"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec2 vUV;\r\nuniform sampler2D uMainTex;\r\nuniform float uThreshold;\r\nuniform float uSoftThreshold;\r\n\r\nout vec4 fragColor;\r\n\r\n// Ref: https://catlikecoding.com/unity/tutorials/advanced-rendering/bloom/\r\nvoid main()\r\n{\r\n    vec3 color =  texture(uMainTex, vUV).rgb;\r\n    float brightness = max(color.r, max(color.g, color.b));\r\n    float knee = uThreshold * uSoftThreshold;\r\n    float soft = brightness - uThreshold + knee;\r\n    soft = clamp(soft, 0.0, 2.0 * knee);\r\n    soft = soft * soft / (4.0 * knee + 0.00001);\r\n\r\n    float contribution = max(soft, brightness - uThreshold);\r\n\tcontribution /= max(brightness, 0.00001);\r\n\r\n    color = contribution * color;\r\n\r\n\r\n\r\n    fragColor = vec4(color.rgb, 1.0);\r\n}"],bloomCompose:[n,"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec2 vUV;\r\n\r\nuniform sampler2D uMainTex;\r\nuniform float uIntensity;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    fragColor = vec4(texture(uMainTex, vUV).rgb * vec3(uIntensity), 1.0);\r\n}"],blitCopy:[n,"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec2 vUV;\r\nuniform sampler2D uMainTex;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    fragColor = texture(uMainTex, vUV).rgba;\r\n}"]}},function(t,e,r){"use strict";var i=Object.defineProperty;i(e,"__esModule",{value:!0}),((t,e)=>{for(var r in e)i(t,r,{get:e[r],enumerable:!0})})(e,{BuiltinShaderSources:()=>n});var n={defaultVert:"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec4 aColor;\r\nin vec2 aUV;\r\nin vec3 aNormal;\r\n\r\nuniform mat4 uTransformM;\r\nuniform mat4 uTransformVP;\r\nuniform mat4 uTransformMVP;\r\n\r\nout vec4 vColor;\r\nout vec4 vPos;\r\nout vec2 vUV;\r\nout vec3 vNormal;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = uTransformMVP * vec4(aPos, 1);\r\n    vColor = aColor;\r\n    vUV = aUV;\r\n    vNormal = aNormal;\r\n}",defaultFrag:"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\nin vec2 vUV;\r\n\r\nuniform sampler2D uMainTex;\r\nuniform vec4 uColor;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    vec4 color = texture(uMainTex, vUV.xy).rgba;\r\n    color = color * vColor * uColor;\r\n    fragColor = color;\r\n}",blitCopy:"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\nin vec2 vUV;\r\nin vec3 vNormal;\r\n\r\nuniform sampler2D uMainTex;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    fragColor = texture(uMainTex, vUV).rgba;\r\n}",colorFrag:"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vColor;\r\nin vec4 vPos;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    fragColor = vColor;\r\n}",colorVert:"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec4 aColor;\r\n\r\nuniform mat4 uTransformM;\r\nuniform mat4 uTransformVP;\r\nuniform mat4 uTransformMVP;\r\n\r\nout vec4 vColor;\r\nout vec4 vPos;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = uTransformMVP * vec4(aPos, 1);\r\n    vColor = aColor;\r\n}",flipVert:"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec3 aPos;\r\nin vec2 aUV;\r\n\r\nout vec2 vUV;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = vec4(aPos, 1);\r\n    vUV = vec2(aUV.x, vec2(1) - aUV.y);\r\n}",texFrag:"#version 300 es\r\nprecision mediump float;\r\n\r\nin vec4 vPos;\r\nin vec2 vUV;\r\n\r\nuniform sampler2D uMainTex;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n    fragColor = texture(uMainTex, vUV).rgba;\r\n}"}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(6),n=r(0);class s{constructor(t,e){this.min=t,this.max=Object(i.j)(t,e)}get xMin(){return this.min.x}get yMin(){return this.min.y}get xMax(){return this.max.x}get yMax(){return this.max.y}get size(){return Object(i.h)(this.max,this.min)}get center(){return Object(i.j)(this.min,this.max).mul(Object(n.b)(.5))}shrink(t){let e=Object(i.j)(this.min,Object(n.b)(t)),r=Object(i.h)(this.max,Object(n.b)(t));return e.x>r.x&&(e.x=r.x=(e.x+r.x)/2),e.y>r.y&&(e.y=r.y=(e.y+r.y)/2),new s(e,r.minus(e))}expand(t){return new s(Object(i.h)(this.min,Object(n.b)(t)),Object(i.j)(this.size,Object(n.b)(2*t)))}static box01(){return new s(n.b.zero(),n.b.one())}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return u})),r.d(e,"b",(function(){return h}));var i=r(4),n=r(1),s=r(6),o=r(2);const a=Array;class u extends a{static create(){return new u(0,0,0,0)}asMut(){return this}equals(t){return!!(t&&t instanceof Array)&&i.c.exactEquals(this,t)}clone(t=u.create()){return t.set(this)}set(t){return this[0]=t[0]||0,this[1]=t[1]||0,this[2]=t[2]||0,this[3]=t[3]||0,this}fill(t){return this[0]=t,this[1]=t,this[2]=t,this[3]=t,this}}function h(t=0,e=t,r=t,i=t){return new u(t,e,r,i)}h.create=()=>h(0),h.identity=Object(o.b)(i.c.identity,0,h.create),h.axisAngle=Object(o.b)((t,e,r)=>i.c.setAxisAngle(t,e,r),2,h.create),h.mul=Object(o.b)(i.c.mul,2,h.create),h.invert=Object(o.b)(i.c.invert,1,h.create),h.normalize=Object(o.b)(i.c.normalize,1,h.create),h.euler=Object(o.b)((t,e)=>(t[0]=Math.atan2(2*(e[3]*e[0]+e[1]*e[2]),1-2*(e[0]**2+e[1]**2))*s.b,t[1]=Math.asin(2*(e[3]*e[1]-e[2]*e[0]))*s.b,t[2]=Math.atan2(2*(e[3]*e[2]+e[0]*e[1]),1-2*(e[1],e[2]**2))*s.b,t),1,n.b.zero),h.fromEuler=Object(o.b)((t,e)=>i.c.fromEuler(t,e[0],e[1],e[2]),1,h.create),h.rotate=Object(o.b)((t,e,r)=>i.e.transformQuat(t,r,e),2,n.b.zero),h.equals=(t,e)=>i.c.exactEquals(t,e)},function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return o}));var i=r(10),n=r(3);const s={from(t){const e={float:1,vec2:2,vec3:3,vec4:4,mat4:16},r={elements:[],byteSize:0,totalSize:0};let i=0;for(const n in t){const s={key:n,type:t[n],location:i,length:e[t[n]]};s.byteLength=4*s.length,s.offset=r.totalSize,s.byteOffset=r.byteSize,r.totalSize+=s.length,r.byteSize+=s.byteLength,r.elements.push(s),i+="mat4"===t[n]?4:1}return r}};class o extends Array{constructor(t,e,r=Object(n.d)()){super(e),this.static=!0,this.Data=null,this.dirty=!1,this.initialized=!1,this.glBuf=null,this.swapBuffer=null,this.structure=s.from(t),this.ctx=r,this.buffer=null,this.resize(e),this.tryInit(!1)}get byteLength(){return this.length*this.structure.byteSize}resize(t,e=!0){const r=this.buffer;this.buffer=new Float32Array(this.structure.totalSize*t),e&&r&&(r.length>this.buffer.length?this.buffer.set(new Float32Array(r.buffer,0,this.buffer.length)):this.buffer.set(r,0)),this.length=t;for(let t=0;t<this.length;t++){const e={};for(const r of this.structure.elements){const i=t*this.structure.byteSize+r.byteOffset;switch(r.type){case"float":e[r.key]=new Float32Array(this.buffer.buffer,i,1);break;case"vec2":e[r.key]=new Float32Array(this.buffer.buffer,i,2);break;case"vec3":e[r.key]=new Float32Array(this.buffer.buffer,i,3);break;case"vec4":e[r.key]=new Float32Array(this.buffer.buffer,i,4);break;case"mat4":e[r.key]=new Float32Array(this.buffer.buffer,i,16)}}this[t]=e}this.dirty=!0}swapVertices(t,e){this.swapBuffer||(this.swapBuffer=new Float32Array(this.structure.totalSize));const r=t*this.structure.byteSize,i=e*this.structure.byteSize;let n=this.swapBuffer,s=new Float32Array(this.buffer.buffer,r,this.structure.totalSize);n.set(s);const o=new Float32Array(this.buffer.buffer,i,this.structure.totalSize);this.buffer.set(o,t*this.structure.totalSize),this.buffer.set(n,e*this.structure.totalSize)}markDirty(){this.dirty=!0}upload(t=!1){if(this.tryInit(!0),!this.dirty&&!t&&this.static)return!1;const e=this.ctx.gl;return e.bindBuffer(e.ARRAY_BUFFER,this.glBuf),e.bufferData(e.ARRAY_BUFFER,this.buffer,this.static?e.STATIC_DRAW:e.DYNAMIC_DRAW),this.dirty=!1,!0}bind(){this.tryInit(!0);const t=this.ctx.gl;this.upload(),t.bindBuffer(t.ARRAY_BUFFER,this.glBuf)}bindVertexArray(t=!1,e){this.tryInit(!0);const r=this.ctx.gl;this.upload(),r.bindBuffer(r.ARRAY_BUFFER,this.glBuf);for(const i of this.structure.elements){const n=e?e[i.key]||-1:i.location;n<0||("mat4"===i.type?(r.enableVertexAttribArray(n+0),r.enableVertexAttribArray(n+1),r.enableVertexAttribArray(n+2),r.enableVertexAttribArray(n+3),r.vertexAttribPointer(n+0,4,r.FLOAT,!1,this.structure.byteSize,i.byteOffset+0),r.vertexAttribPointer(n+1,4,r.FLOAT,!1,this.structure.byteSize,i.byteOffset+1),r.vertexAttribPointer(n+2,4,r.FLOAT,!1,this.structure.byteSize,i.byteOffset+2),r.vertexAttribPointer(n+3,4,r.FLOAT,!1,this.structure.byteSize,i.byteOffset+3),t&&(r.vertexAttribDivisor(n+0,1),r.vertexAttribDivisor(n+1,1),r.vertexAttribDivisor(n+2,1),r.vertexAttribDivisor(n+3,1))):(r.enableVertexAttribArray(n),r.vertexAttribPointer(n,i.length,r.FLOAT,!1,this.structure.byteSize,i.byteOffset),t&&r.vertexAttribDivisor(n,1)))}}unbindVertexArray(t=!1,e){this.tryInit(!0);const r=this.ctx.gl;for(const i of this.structure.elements){const n=e?e[i.key]||-1:i.location;n<0||("mat4"===i.type?(r.disableVertexAttribArray(n+0),r.disableVertexAttribArray(n+1),r.disableVertexAttribArray(n+2),r.disableVertexAttribArray(n+3),t&&(r.vertexAttribDivisor(n+0,0),r.vertexAttribDivisor(n+1,0),r.vertexAttribDivisor(n+2,0),r.vertexAttribDivisor(n+3,0))):(r.disableVertexAttribArray(n),t&&r.vertexAttribDivisor(n,0)))}}unbind(){this.tryInit(!0);const t=this.ctx.gl;t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null)}tryInit(t=!1){var e;if(this.initialized)return!0;const r=this.ctx||Object(n.d)();if(!r){if(t)throw new Error("Failed to init render buffer without a global GL context.");return!1}this.ctx=r;const s=r.gl;return this.glBuf=null!==(e=s.createBuffer())&&void 0!==e?e:Object(i.c)("Failed to create render buffer"),s.bindBuffer(s.ARRAY_BUFFER,this.glBuf),s.bufferData(s.ARRAY_BUFFER,this.byteLength,this.static?s.STATIC_DRAW:s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,null),this.initialized=!0,!0}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return h})),r.d(e,"b",(function(){return c}));var i=r(0),n=r(1),s=r(11),o=r(6),a=r(3),u=r(16);class h{constructor(t=16,e=3*t,r=u.a,i=Object(a.d)()){this.verticesCount=0,this.indicesCount=0,this.mesh=new u.c(r,i),this.mesh.resize(t,e)}addPolygon(...t){if(t.length<=0)return;this.verticesCount+t.length>this.mesh.vertices.length&&this.mesh.resize(2*this.mesh.vertices.length,2*this.mesh.indices.length,!0);const e=this.verticesCount;for(const r in t[0])for(let i=0;i<t.length;i++)this.mesh.vertices[e+i][r].set(t[i][r]);for(let r=0;r<t.length-2;r++)this.mesh.indices[this.indicesCount+3*r+0]=e+0,this.mesh.indices[this.indicesCount+3*r+1]=e+r+1,this.mesh.indices[this.indicesCount+3*r+2]=e+r+2;this.verticesCount+=t.length,this.indicesCount+=3*(t.length-2)}toMesh(){return this.mesh.indices.length!=this.indicesCount?this.mesh.resize(this.verticesCount,this.indicesCount,!0):this.mesh.vertices.length!=this.verticesCount&&this.mesh.vertices.resize(this.verticesCount,!0),this.mesh}static quad(t=i.b.zero(),e=i.b.one(),r=Object(a.d)()){const n=i.b.mul(e,.5),s=new u.c(r);return s.resize(4,6),s.vertices[0].vert.set([t.x-n.x,t.y-n.y,0]),s.vertices[1].vert.set([t.x+n.x,t.y-n.y,0]),s.vertices[2].vert.set([t.x+n.x,t.y+n.y,0]),s.vertices[3].vert.set([t.x-n.x,t.y+n.y,0]),s.vertices[0].uv.set([0,0]),s.vertices[1].uv.set([1,0]),s.vertices[2].uv.set([1,1]),s.vertices[3].uv.set([0,1]),s.vertices[0].normal.set([0,0,1]),s.vertices[1].normal.set([0,0,1]),s.vertices[2].normal.set([0,0,1]),s.vertices[3].normal.set([0,0,1]),s.vertices[0].color.fill(1),s.vertices[1].color.fill(1),s.vertices[2].color.fill(1),s.vertices[3].color.fill(1),s.indices.set([0,1,2,0,2,3]),s}static ndcQuad(t=Object(a.d)()){return this.quad(i.b.zero(),Object(i.b)(2,2),t)}static ndcTriangle(t=Object(a.d)()){const e=new u.c(t);return e.resize(3,3),e.vertices[0].vert.set([-1,-1,0]),e.vertices[1].vert.set([3,-1,0]),e.vertices[2].vert.set([-1,3,0]),e.vertices[0].uv.set([0,0]),e.vertices[1].uv.set([2,0]),e.vertices[2].uv.set([0,2]),e.vertices[0].normal.set([0,0,1]),e.vertices[1].normal.set([0,0,1]),e.vertices[2].normal.set([0,0,1]),e.vertices[0].color.fill(1),e.vertices[1].color.fill(1),e.vertices[2].color.fill(1),e.indices.set([0,1,2]),e.name="mesh_ndc_triangle",e}static cube(t=n.b.zero(),e=n.b.one(),r){const s=[Object(n.b)(-.5,-.5,-.5).mul(e).plus(t),Object(n.b)(.5,-.5,-.5).mul(e).plus(t),Object(n.b)(.5,.5,-.5).mul(e).plus(t),Object(n.b)(-.5,.5,-.5).mul(e).plus(t),Object(n.b)(-.5,-.5,.5).mul(e).plus(t),Object(n.b)(.5,-.5,.5).mul(e).plus(t),Object(n.b)(.5,.5,.5).mul(e).plus(t),Object(n.b)(-.5,.5,.5).mul(e).plus(t)],o=[Object(i.b)(0,0),Object(i.b)(1,0),Object(i.b)(1,1),Object(i.b)(0,1)],a=new h(24,36,u.a,r);a.addPolygon({vert:s[1],uv:o[0],normal:Object(n.b)(0,0,-1)},{vert:s[0],uv:o[1],normal:Object(n.b)(0,0,-1)},{vert:s[3],uv:o[2],normal:Object(n.b)(0,0,-1)},{vert:s[2],uv:o[3],normal:Object(n.b)(0,0,-1)}),a.addPolygon({vert:s[5],uv:o[0],normal:Object(n.b)(1,0,0)},{vert:s[1],uv:o[1],normal:Object(n.b)(1,0,0)},{vert:s[2],uv:o[2],normal:Object(n.b)(1,0,0)},{vert:s[6],uv:o[3],normal:Object(n.b)(1,0,0)}),a.addPolygon({vert:s[4],uv:o[0],normal:Object(n.b)(0,0,1)},{vert:s[5],uv:o[1],normal:Object(n.b)(0,0,1)},{vert:s[6],uv:o[2],normal:Object(n.b)(0,0,1)},{vert:s[7],uv:o[3],normal:Object(n.b)(0,0,1)}),a.addPolygon({vert:s[0],uv:o[0],normal:Object(n.b)(-1,0,0)},{vert:s[4],uv:o[1],normal:Object(n.b)(-1,0,0)},{vert:s[7],uv:o[2],normal:Object(n.b)(-1,0,0)},{vert:s[3],uv:o[3],normal:Object(n.b)(-1,0,0)}),a.addPolygon({vert:s[7],uv:o[0],normal:Object(n.b)(0,1,0)},{vert:s[6],uv:o[1],normal:Object(n.b)(0,1,0)},{vert:s[2],uv:o[2],normal:Object(n.b)(0,1,0)},{vert:s[3],uv:o[3],normal:Object(n.b)(0,1,0)}),a.addPolygon({vert:s[0],uv:o[0],normal:Object(n.b)(0,-1,0)},{vert:s[1],uv:o[1],normal:Object(n.b)(0,-1,0)},{vert:s[5],uv:o[2],normal:Object(n.b)(0,-1,0)},{vert:s[4],uv:o[3],normal:Object(n.b)(0,-1,0)});const c=a.toMesh();return c.vertices.forEach(t=>t.color.fill(1)),c.name="mesh_cube",c}}class c{constructor(t=0,e=Object(a.d)()){this.verts=[],this.triangles=[],this.uvs=[],this.colors=[],this.ctx=e}addPolygon(t,e){const r=this.verts.length;for(let r=0;r<t.length;r++)this.verts.push(t[r]),this.uvs.push(e[r]),this.colors.push(s.a.white);for(let e=2;e<t.length;e++)this.triangles.push(r+0,r+e-1,r+e)}addSubMesh(t,e,r=[s.a.white],n=[Object(i.b)(0,0)]){const o=this.verts.length;if(e.length%3!=0)throw new Error("Invalid number of triangles.");for(let e=0;e<t.length;e++)this.verts.push(t[e]),this.uvs.push(e>=n.length?n[n.length-1]:n[e]),this.colors.push(e>=r.length?r[r.length-1]:r[e]);for(let t=0;t<e.length;t++)this.triangles.push(o+e[t])}toMesh(){const t=new u.c(this.ctx);return t.verts=this.verts,t.triangles=this.triangles,t.colors=this.colors,t.uvs=this.uvs,t.calculateNormals(),t}static quad(t=i.b.zero(),e=i.b.one()){const r=Object(o.i)(e,Object(i.b)(.5)),s=new u.c;return s.verts=[Object(n.b)(t.x-r.x,t.y-r.y,0),Object(n.b)(t.x+r.x,t.y-r.y,0),Object(n.b)(t.x+r.x,t.y+r.y,0),Object(n.b)(t.x-r.x,t.y+r.y,0)],s.triangles=[0,1,3,1,2,3],s.uvs=[Object(i.b)(0,0),Object(i.b)(1,0),Object(i.b)(1,1),Object(i.b)(0,1)],s.normals=[Object(n.b)(0,0,1),Object(n.b)(0,0,1),Object(n.b)(0,0,1),Object(n.b)(0,0,1)],s.name="mesh_quad",s}static ndcQuad(){return this.quad(i.b.zero(),Object(i.b)(2,2))}static ndcTriangle(){const t=new u.c;return t.verts=[Object(n.b)(-1,-1,0),Object(n.b)(3,-1,0),Object(n.b)(-1,3,0)],t.triangles=[0,1,2],t.uvs=[Object(i.b)(0,0),Object(i.b)(2,0),Object(i.b)(0,2)],t.normals=[Object(n.b)(0,0,1),Object(n.b)(0,0,1),Object(n.b)(0,0,1)],t.name="mesh_ndc_triangle",t}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return a}));var i=r(47),n=r(15),s=r(28);class o extends i.a{constructor(){super(...arguments),this.assetID=n.b.newAssetID(this),this.name="Entity_"+this.assetID,this.eventEmitter=new s.a,this._destroyed=!1,this._collider=null}get collider(){return this._collider}set collider(t){this.scene&&t&&t.__bind(this,this.scene),this._collider&&this._collider!==t&&this._collider.__unbind(),this._collider=t}get destroyed(){return this._destroyed}on(t,e){return this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}destroy(){this._destroyed=!0,this.scene?this.scene.remove(this):n.b.destroy(this.assetID)}start(t){}update(t){}exit(t){}__updateRecursive(t){this.update(t),this.eventEmitter.emit("update",this,t);for(const e of this.children)e.__updateRecursive(t)}__addToScene(t){var e;super.__addToScene(t),null===(e=this._collider)||void 0===e||e.__bind(this,t)}__removeFromScene(t){var e;super.__removeFromScene(t),null===(e=this._collider)||void 0===e||e.__unbindPhysics()}__start(t){this.start(t),this.eventEmitter.with().emit("start",this,t)}__exit(t){this.exit(t),this.eventEmitter.with().emit("exit",this,t),this._destroyed&&n.b.destroy(this.assetID)}}class a{constructor(){this.entityMap=new Map,this._entities=[]}get entities(){return this._entities}add(t){this.entityMap.set(t.assetID,t),this._entities=Array.from(this.entityMap.values())}removeRecursive(t){this.entityMap.delete(t.assetID);for(const e of t.children)this.removeRecursive(e)}remove(t){this.removeRecursive(t),t.parent&&t.parent.children.delete(t),this._entities=Array.from(this.entityMap.values())}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));class i{setup(t,e){}cleanup(t,e){}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(3),n=r(25);class s extends n.a{constructor(t=Object(i.d)()){super(),this.meshes=[],this.materials=[],this.materials=[t.assets.materials.default]}on(t,e){this.eventEmitter.with().on(t,e)}off(t,e){this.eventEmitter.with().off(t,e)}render(t,e){this.eventEmitter.with().emit("render",this,t,e);for(let e=0;e<this.meshes.length;e++)t.renderer.drawMesh(this.meshes[e],this.localToWorldMatrix,this.materials[e])}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));class i{constructor(){this.listeners=new Map}on(t,e){var r;this.listeners.has(t)||this.listeners.set(t,[]),null===(r=this.listeners.get(t))||void 0===r||r.push(e)}off(t,e){var r,i;this.listeners.has(t)&&this.listeners.set(t,null!==(i=null===(r=this.listeners.get(t))||void 0===r?void 0:r.filter(t=>t!==e))&&void 0!==i?i:[])}emit(t,...e){var r;null===(r=this.listeners.get(t))||void 0===r||r.forEach(t=>t(...e))}with(){return this}}},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return o}));var i,n=r(27),s=r(9);!function(t){t[t.NearToFar=0]="NearToFar",t[t.FarToNear=1]="FarToNear"}(i||(i={}));const o={create:(t,e,r)=>({camera:t,scene:e,cameraOutput:r,visibleObjects:e.getEntitiesOfType(n.a),getVisibleObjects(t=i.NearToFar,e){const r=this.camera.worldToLocalMatrix;let n=this.visibleObjects;e&&(n=n.filter(e));let o=n.map(t=>({pos:s.b.mulPoint(r,t.position),obj:t}));return o=t===i.NearToFar?o.sort((t,e)=>e.pos.z-t.pos.z):o.sort((t,e)=>t.pos.z-e.pos.z),o.map(t=>t.obj)}})}},function(t,e,r){"use strict";r.d(e,"a",(function(){return u}));var i=r(0),n=r(44),s=r(40),o=r(35),a=r(32);class u extends o.a{constructor(){super(...arguments),this._tilemap=null}get tilemap(){return this._tilemap}__bind(t,e){super.__bind(t,e),t instanceof n.b&&(this._tilemap=t)}checkCollision(t,e){return t instanceof s.a?Object(a.a)(this,t,e):(console.warn("Unimplemented collision check"),null)}checkContact(t){return t instanceof s.a?Object(a.b)(this,t):(console.warn("Unimplemented contact check"),!1)}getPolygons(t,e){if(!this.tilemap)return null;const r=i.b.zero(),n=[];for(let i=t.y;i<e.y+this.tilemap.chunkSize;i+=this.tilemap.chunkSize)for(let s=t.x;s<e.x+this.tilemap.chunkSize;s+=this.tilemap.chunkSize){r.x=s,r.y=i;const t=this.tilemap.getChunkAt(r);n.push(...t.getPolygons())}return n}}},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return c})),r.d(e,"c",(function(){return l}));var i,n=r(0),s=r(3),o=r(6);class a{constructor(t){this.currentIdx=0,this.buffers=[t(),t()]}get current(){return this.buffers[this.currentIdx%2]}set current(t){this.buffers[this.currentIdx%2]=t}get back(){return this.buffers[(this.currentIdx+1)%2]}set back(t){this.buffers[(this.currentIdx+1)%2]=t}update(){this.currentIdx++}}!function(t){t[t.Pressed=1]="Pressed",t[t.Released=0]="Released"}(i||(i={}));const u={getBoundingClientRect:()=>({x:0,y:0,left:0,top:0,right:document.documentElement.clientWidth||window.innerWidth,bottom:document.documentElement.clientHeight||window.innerHeight,width:document.documentElement.clientWidth||window.innerWidth,height:document.documentElement.clientHeight||window.innerHeight})};class h{constructor(){this.keyStates=new Map,this.keyStatesThisFrame=new Map,this.mousePos=n.b.zero(),this.mouseDelta=n.b.zero(),this.wheelDelta=0}}class c{constructor(t={}){var e,r,c;this.preventBrowserShortcut=!0,this.bound=null,this.states=new a(()=>new h),this.renderer=null,this.eventTarget=t.target||window,this.pointerLockElement=null!==(e=t.pointerLockElement)&&void 0!==e?e:document.body,this.renderer=t.renderer||Object(s.d)().renderer,t.bound?this.bound=t.bound:(null===(r=t.target)||void 0===r?void 0:r.getBoundingClientRect)?this.bound=t.target:this.bound=null===(c=this.renderer)||void 0===c?void 0:c.canvas,this.eventTarget.addEventListener("keydown",t=>{this.states.back.keyStates.set(t.keyCode,i.Pressed),this.states.current.keyStates.get(t.keyCode)!==i.Pressed&&this.states.back.keyStatesThisFrame.set(t.keyCode,i.Pressed),this.preventBrowserShortcut&&t.ctrlKey&&(t.keyCode==l.S||t.keyCode==l.W)&&(t.preventDefault(),t.stopPropagation())}),this.eventTarget.addEventListener("keyup",t=>{this.states.back.keyStates.set(t.keyCode,i.Released),this.states.back.keyStatesThisFrame.set(t.keyCode,i.Released)}),this.eventTarget.addEventListener("mousedown",t=>{var e;const r=null===(e=this.bound)||void 0===e?void 0:e.getBoundingClientRect();if(r){const e=Object(n.b)(r.left,null==r?void 0:r.top),i=Object(o.h)(Object(n.b)(t.clientX,t.clientY),e);if(i.x<0||i.y<0||i.x>r.width||i.y>r.height)return}this.states.back.keyStates.set(l.Mouse0+t.button,i.Pressed),this.states.current.keyStates.get(l.Mouse0+t.button)!==i.Pressed&&this.states.back.keyStatesThisFrame.set(l.Mouse0+t.button,i.Pressed)}),this.eventTarget.addEventListener("mouseup",t=>{var e;const r=null===(e=this.bound)||void 0===e?void 0:e.getBoundingClientRect();if(r){const e=Object(n.b)(r.left,null==r?void 0:r.top),i=Object(o.h)(Object(n.b)(t.clientX,t.clientY),e);if(i.x<0||i.y<0||i.x>r.width||i.y>r.height)return}this.states.back.keyStates.set(l.Mouse0+t.button,i.Released),this.states.back.keyStatesThisFrame.set(l.Mouse0+t.button,i.Released)}),this.eventTarget.addEventListener("mousemove",t=>{var e;this.renderer||(this.renderer=Object(s.d)().renderer);const r=(this.bound||(null===(e=this.renderer)||void 0===e?void 0:e.canvas)||u).getBoundingClientRect(),i=Object(o.h)(Object(n.b)(t.clientX,t.clientY),Object(n.b)(r.left,r.top));this.renderer&&i.mul(this.renderer.canvasSize).div(Object(n.b)(r.width,r.height)),this.states.back.mouseDelta.plus(Object(n.b)(t.movementX,t.movementY)),this.states.back.mousePos=i}),this.eventTarget.addEventListener("wheel",t=>{this.states.back.wheelDelta=t.deltaY});for(const t in l)isNaN(t)&&l.hasOwnProperty(t)&&this.states.back.keyStates.set(l[t],i.Released);window.addEventListener("beforeunload",t=>{!this.preventBrowserShortcut||this.states.back.keyStates.get(l.W)!==i.Pressed&&this.states.back.keyStates.get(l.Control)!==i.Pressed||(t.preventDefault(),t.returnValue="Really want to quit?")})}get pointerPosition(){return this.states.current.mousePos}get pointerDelta(){return this.states.current.mouseDelta}get wheelDelta(){return this.states.current.wheelDelta}getKey(t){return this.states.current.keyStates.get(t)===i.Pressed}getKeyDown(t){return this.states.current.keyStatesThisFrame.get(t)===i.Pressed}getKeyUp(t){return this.states.current.keyStatesThisFrame.get(t)===i.Released}update(){this.states.update(),this.states.back.keyStatesThisFrame.clear(),this.states.back.mouseDelta=n.b.zero(),this.states.back.wheelDelta=0;for(const[t,e]of this.states.current.keyStates)this.states.back.keyStates.set(t,e);this.states.back.mousePos=this.states.current.mousePos}lockPointer(){this.pointerLockElement.requestPointerLock()}releasePointer(){document.exitPointerLock()}}var l;!function(t){t[t.BackSpace=8]="BackSpace",t[t.Tab=9]="Tab",t[t.Clear=12]="Clear",t[t.Enter=13]="Enter",t[t.Shift=16]="Shift",t[t.Control=17]="Control",t[t.Alt=18]="Alt",t[t.Pause=19]="Pause",t[t.CapsLock=20]="CapsLock",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.Prior=33]="Prior",t[t.Next=34]="Next",t[t.End=35]="End",t[t.Home=36]="Home",t[t.Left=37]="Left",t[t.Up=38]="Up",t[t.Right=39]="Right",t[t.Down=40]="Down",t[t.Select=41]="Select",t[t.Print=42]="Print",t[t.Execute=43]="Execute",t[t.Insert=45]="Insert",t[t.Delete=46]="Delete",t[t.Help=47]="Help",t[t.Num0=48]="Num0",t[t.Num1=49]="Num1",t[t.Num2=50]="Num2",t[t.Num3=51]="Num3",t[t.Num4=52]="Num4",t[t.Num5=53]="Num5",t[t.Num6=54]="Num6",t[t.Num7=55]="Num7",t[t.Num8=56]="Num8",t[t.Num9=57]="Num9",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.KP0=96]="KP0",t[t.KP1=97]="KP1",t[t.KP2=98]="KP2",t[t.KP3=99]="KP3",t[t.KP4=100]="KP4",t[t.KP5=101]="KP5",t[t.KP6=102]="KP6",t[t.KP7=103]="KP7",t[t.KP8=104]="KP8",t[t.KP9=105]="KP9",t[t.KPMultiply=106]="KPMultiply",t[t.KPAdd=107]="KPAdd",t[t.KPSeparator=108]="KPSeparator",t[t.KPSubtract=109]="KPSubtract",t[t.KPDecimal=110]="KPDecimal",t[t.KPDivide=111]="KPDivide",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.F13=124]="F13",t[t.F14=125]="F14",t[t.F15=126]="F15",t[t.F16=127]="F16",t[t.F17=128]="F17",t[t.F18=129]="F18",t[t.F19=130]="F19",t[t.F20=131]="F20",t[t.F21=132]="F21",t[t.F22=133]="F22",t[t.F23=134]="F23",t[t.F24=135]="F24",t[t.NumLock=136]="NumLock",t[t.ScrollLock=137]="ScrollLock",t[t.Mouse0=256]="Mouse0",t[t.Mouse1=257]="Mouse1",t[t.Mouse2=258]="Mouse2",t[t.Mouse3=259]="Mouse3",t[t.Mouse4=260]="Mouse4",t[t.Mouse5=261]="Mouse5",t[t.Mouse6=262]="Mouse6"}(l||(l={}))},function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return u}));var i=r(0),n=r(6),s=r(21),o=r(3);function a(t,e){var r;if(!t.entity||!e.entity)return!1;const n=e.entity.position.toVec2().plus(e.offset),s=i.b.math(Math.floor)(n).plus(.5),o=i.b.math(Math.ceil)(i.b.mul(e.size,.5));for(var a=-o.y;a<=o.y;a++)for(var u=-o.x;u<=o.x;u++){const o=Object(i.b)(u,a).plus(s),h=null===(r=t.tilemap)||void 0===r?void 0:r.getTile(o);if((null==h?void 0:h.collide)&&Math.abs(n.x-o.x)<=e.size.x/2+.5&&Math.abs(n.y-o.y)<=e.size.y/2+.5)return!0}return!1}function u(t,e,r){if(!e.entity||!t.tilemap)return null;const a=Object(n.f)(e.size,2),u=e.entity.position.toVec2().plus(e.offset),h=Object(n.h)(u,r),c=i.b.math(Math.ceil)(a),l=i.b.math(Math.floor)(h),d=r.magnitude;let f=!1,m=i.b.zero(),p=Number.MAX_VALUE;for(var b=-c.y;b<=c.y;b++)for(var v=-c.x;v<=c.x;v++){const t=new s.a(Object(i.b)(v,b).plus(l),Object(n.j)(e.size,1));Object(o.a)().drawRect(t);const[a,u,c]=Object(n.c)(t,h,r);a&&u>0&&u<=d&&Object(n.g)(c,r)<0&&u<p&&(f=!0,m=c)}if(f){const i=r.normalized.mul(p).plus(h);return{self:t,other:e,point:i,seperation:Object(n.h)(i,u)}}return null}},function(t,e,r){"use strict";r.d(e,"d",(function(){return i})),r.d(e,"c",(function(){return b})),r.d(e,"a",(function(){return v})),r.d(e,"b",(function(){return w}));var i,n=r(16),s=r(11),o=r(0),a=r(12),u=r(14),h=r(9),c=r(8),l=r(7),d=r(19),f=r(25),m=r(30),p=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};!function(t){t.Soft="soft",t.Hard="hard"}(i||(i={}));const b=Object(n.e)(Object.assign(Object.assign({},n.a),{p0:"vec2",p1:"vec2"}));class v extends f.a{constructor(t=!1){super(),this.shadowType=!1,this.volumnRadius=1,this.lightRange=10,this.lightColor=s.a.white,this.intensity=1,this.attenuation=0,this.shadowMesh=null,this.shadowMat=new w,this.__tempVectors=Array.from(new Array(32)).map(()=>o.b.zero()),this.shadowType=t,t===i.Soft&&(this.shadowMesh=new n.c(b)),this.shadowMesh&&this.shadowMesh.resize(5e3,9e3)}getShadowMap(t,e){return this.shadowMesh||(this.shadowMesh=new n.c(b)),this.shadowMesh.vertices.length<=0&&this.shadowMesh.resize(50,90),this.shadowMap||(this.shadowMap=new a.c(t.renderer.canvasSize.x,t.renderer.canvasSize.y,!1,u.a.R8,a.b.Linear)),this.shadowMap.size.equals(e.cameraOutput.size)||this.shadowMap.resize(e.cameraOutput.width,e.cameraOutput.height,a.f.Discard),this.updateShadowMesh(t,e),t.renderer.setFramebuffer(this.shadowMap),t.renderer.clear(s.a.black),this.shadowMat.lightPos.set(this.position),this.shadowMat.lightRange=this.lightRange,this.shadowMat.volumnSize=this.volumnRadius,t.renderer.drawMesh(this.shadowMesh,this.localToWorldMatrix,this.shadowMat),this.shadowMap}updateShadowMesh(t,e){this.shadowMesh.indices.fill(0);const r=[Object(o.b)(-this.lightRange).plus(this.position.toVec2()),Object(o.b)(this.lightRange).plus(this.position.toVec2())],i=h.b.identity();let n=0,s=0;for(const t of e.scene.physics.__getColliders())if(t instanceof m.a){const e=t.getPolygons(...r);if(!e)continue;i.set(t.tilemap.localToWorldMatrix),h.b.mul(i,i,this.worldToLocalMatrix);for(const t of e)for(let e=0;e<t.points.length;e++){const[r,o]=this.appendLineShadow(t.points[e],t.points[(e+1)%t.points.length],i,n,s);n+=r,s+=o}}this.shadowMesh.update()}appendLineShadow(t,e,r,i,n){let s=0;(this.shadowMesh.vertices.length<=i+5||this.shadowMesh.indices.length<=n+9)&&this.shadowMesh.resize(2*this.shadowMesh.vertices.length,2*this.shadowMesh.indices.length,!0);const a=this.volumnRadius*this.volumnRadius,u=this.lightRange*this.lightRange,c=h.b.mulPoint2(this.__tempVectors[s++],r,t),l=h.b.mulPoint2(this.__tempVectors[s++],r,e);o.b.set(this.shadowMesh.vertices[i+0].vert,c),o.b.set(this.shadowMesh.vertices[i+1].vert,l);const d=o.b.minus(this.__tempVectors[s++],l,c).normalize();let f=x(c,this.volumnRadius,[this.__tempVectors[s++],this.__tempVectors[s++]]),m=x(l,this.volumnRadius,[this.__tempVectors[s++],this.__tempVectors[s++]]);f=[f[1],f[0]];const p=this.shadowMesh.vertices[i+4].vert,b=this.shadowMesh.vertices[i+2].vert,v=[o.b.minus(this.__tempVectors[s++],c,f[0]).normalize(),o.b.minus(this.__tempVectors[s++],c,f[1]).normalize()],g=[o.b.minus(this.__tempVectors[s++],l,m[0]).normalize(),o.b.minus(this.__tempVectors[s++],l,m[1]).normalize()];let y=0;o.b.cross(d,v[0])<=0?(y|=1,p.set(g[1].mul(Math.sqrt(u-a)).plus(m[1]))):p.set(v[0].mul(Math.sqrt(u-a)).plus(f[0])),o.b.cross(d,g[0])<=0?(y|=2,b.set(v[1].mul(Math.sqrt(u-a)).plus(f[1]))):b.set(g[0].mul(Math.sqrt(u-a)).plus(m[0]));const w=o.b.plus(this.__tempVectors[s++],p,b).mul(.5);o.b.mul(this.shadowMesh.vertices[i+3].vert,w,u/w.magnitudeSqr);switch(o.b.set(this.shadowMesh.vertices[i+0].p0,c),o.b.set(this.shadowMesh.vertices[i+0].p1,l),o.b.set(this.shadowMesh.vertices[i+1].p0,c),o.b.set(this.shadowMesh.vertices[i+1].p1,l),o.b.set(this.shadowMesh.vertices[i+2].p0,c),o.b.set(this.shadowMesh.vertices[i+2].p1,l),o.b.set(this.shadowMesh.vertices[i+3].p0,c),o.b.set(this.shadowMesh.vertices[i+3].p1,l),o.b.set(this.shadowMesh.vertices[i+4].p0,c),o.b.set(this.shadowMesh.vertices[i+4].p1,l),y){case 0:this.shadowMesh.indices.set([i+0,i+3,i+4,i+0,i+1,i+3,i+1,i+2,i+3],n);break;case 1:this.shadowMesh.indices.set([i+1,i+2,i+3,i+1,i+3,i+4,i+1,i+1,i+1],n);break;case 2:this.shadowMesh.indices.set([i+0,i+2,i+3,i+0,i+3,i+4,i+1,i+1,i+1],n);break;case 3:this.shadowMesh.indices.set([i+1,i+3,i+4,i+1,i+0,i+3,i+0,i+2,i+3],n)}return[5,9]}appendVerts(){}destroy(){var t,e;this.destroyed||(super.destroy(),null===(t=this.shadowMesh)||void 0===t||t.destroy(),null===(e=this.shadowMap)||void 0===e||e.destroy())}}const g=o.b.zero(),y=o.b.zero();function x(t,e,r=[o.b.zero(),o.b.zero()]){const i=e*e,n=t.magnitudeSqr,s=g;return s.x=-t.y,s.y=t.x,s.mul(e/n*Math.sqrt(n-i)),o.b.mul(y,t,i/n),r[0].set(y).plus(s),r[1].set(y).minus(s),r}class w extends(Object(c.b)(new l.e(...d.ShaderSource.shadow2D,{vertexStructure:b,attributes:{p0:"aP0",p1:"aP1"},cull:l.b.Back,blend:[l.a.One,l.a.One]}))){constructor(){super(...arguments),this.lightPos=o.b.zero(),this.volumnSize=1,this.lightRange=10}}p([Object(c.e)("uLightPos","vec2")],w.prototype,"lightPos",void 0),p([Object(c.e)("uVolumnSize","float")],w.prototype,"volumnSize",void 0),p([Object(c.e)("uLightRange","float")],w.prototype,"lightRange",void 0)},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return m}));var i,n=r(12),s=r(3),o=r(0),a=r(25),u=r(9),h=r(6),c=r(11),l=r(1),d=r(56),f=r(13);!function(t){t[t.Perspective=0]="Perspective",t[t.Orthographic=1]="Orthographic"}(i||(i={}));class m extends a.a{constructor(t=Object(s.d)()){super(),this.output=null,this.FOV=30,this.near=.3,this.far=1e3,this.viewHeight=1,this.projection=i.Perspective,this.clearColor=c.a.black,this.clearDepth=!0,this.postprocess=[],this.ctx=t}get pixelSize(){return this.output instanceof n.c?Object(o.b)(this.output.width,this.output.height):Object(o.b)(this.ctx.width,this.ctx.height)}get aspectRatio(){return this.pixelSize.x/this.pixelSize.y}get viewProjectionMatrix(){const t=this.worldToLocalMatrix,e=this.projectionMatrix;return u.b.mul(e,t)}get projectionMatrix(){return this.projection===i.Perspective?u.b.perspective(this.FOV*h.a,this.aspectRatio,this.near,this.far):u.b.ortho(this.viewHeight,this.aspectRatio,this.near,this.far)}on(t,e){this.eventEmitter.with().on(t,e)}off(t,e){this.eventEmitter.with().on(t,e)}__preRender(t){this.eventEmitter.with().emit("prerender",this,t)}__postRender(t){this.eventEmitter.with().emit("postrender",this,t)}screenToRay(t){const e=this.screenToWorld(t);return Object(d.a)(this.position.clone(),Object(h.h)(Object(l.b)(e.x,e.y,e.z),this.position))}screenToWorld(t){const e=this.projection==i.Perspective?this.near:1,r=this.screenToViewport(t).mul(Object(o.b)(2,-2)).minus(Object(o.b)(1,-1)),n=Object(h.i)(Object(f.b)(r.x,r.y,-1,1),e),s=u.b.invert(this.viewProjectionMatrix),a=u.b.mulVec4(s,n);return Object(l.b)(a[0],a[1],a[2])}screenToViewport(t){return null===this.output?Object(h.f)(t,Object(o.b)(this.ctx.width,this.ctx.height)):this.output instanceof n.c?Object(h.f)(t,Object(o.b)(this.output.width,this.output.height)):o.b.zero()}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(28),n=r(46);class s extends n.a{constructor(){super(...arguments),this.rigidbody=null,this.enabled=!0,this.__eventEmitter=new i.a,this.__colliderIdx=-1}on(t,e){this.__eventEmitter.on(t,e)}off(t,e){this.__eventEmitter.on(t,e)}checkCollision(t,e){return null}checkContact(t){return!1}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return u}));var i=r(11),n=r(6),s=r(21),o=r(0),a=r(1);class u{drawRay(t,e,r=1,s=i.a.red){this.drawLine(t,Object(n.i)(e,r).plus(t),s)}drawRect(...t){let e,r,n;t[0]instanceof s.a?(e=t[0].min,r=t[0].max,n=t[1]||i.a.red):(e=t[0],r=t[1],n=t[2]||i.a.red),this.drawLine(Object(o.b)(e.x,e.y).toVec3(),Object(o.b)(r.x,e.y).toVec3(),n),this.drawLine(Object(o.b)(r.x,e.y).toVec3(),Object(o.b)(r.x,r.y).toVec3(),n),this.drawLine(Object(o.b)(r.x,r.y).toVec3(),Object(o.b)(e.x,r.y).toVec3(),n),this.drawLine(Object(o.b)(e.x,r.y).toVec3(),Object(o.b)(e.x,e.y).toVec3(),n)}drawLines(t,e=i.a.red){for(let r=0;r<t.length;r++)this.drawLine(t[r],t[(r+1)%t.length],e)}drawCircle(t,e,r=i.a.red){for(let i=0;i<24;i++){const n=Object(a.b)(Math.cos(2*i*Math.PI/24),Math.sin(2*i*Math.PI/24),0),s=Object(a.b)(Math.cos((i+1)%24*2*Math.PI/24),Math.sin((i+1)%24*2*Math.PI/24),0);this.drawLine(n.mul(e).plus(t),s.mul(e).plus(t),r)}}}},function(t,e,r){"use strict";r.r(e),r.d(e,"Vector2",(function(){return i.Vector2})),r.d(e,"vec2",(function(){return i.vec2})),r.d(e,"Vector3",(function(){return i.Vector3})),r.d(e,"vec3",(function(){return i.vec3})),r.d(e,"Vector4",(function(){return i.Vector4})),r.d(e,"vec4",(function(){return i.vec4})),r.d(e,"Color",(function(){return i.Color})),r.d(e,"rgba",(function(){return i.rgba})),r.d(e,"rgb",(function(){return i.rgb})),r.d(e,"hsl",(function(){return i.hsl})),r.d(e,"plus",(function(){return i.plus})),r.d(e,"minus",(function(){return i.minus})),r.d(e,"mul",(function(){return i.mul})),r.d(e,"div",(function(){return i.div})),r.d(e,"dot",(function(){return i.dot})),r.d(e,"cross",(function(){return i.cross})),r.d(e,"distance",(function(){return i.distance})),r.d(e,"boxRaycast",(function(){return i.boxRaycast})),r.d(e,"Deg2Rad",(function(){return i.Deg2Rad})),r.d(e,"Rad2Deg",(function(){return i.Rad2Deg})),r.d(e,"Matrix4x4",(function(){return i.Matrix4x4})),r.d(e,"mat4",(function(){return i.mat4})),r.d(e,"Quaternion",(function(){return i.Quaternion})),r.d(e,"quat",(function(){return i.quat})),r.d(e,"ray",(function(){return i.ray})),r.d(e,"Rect",(function(){return i.Rect})),r.d(e,"MathUtils",(function(){return i.MathUtils})),r.d(e,"Material",(function(){return i.Material})),r.d(e,"shaderProp",(function(){return i.shaderProp})),r.d(e,"MaterialFromShader",(function(){return i.MaterialFromShader})),r.d(e,"SimpleTexturedMaterial",(function(){return i.SimpleTexturedMaterial})),r.d(e,"materialDefine",(function(){return i.materialDefine})),r.d(e,"DefaultVertexData",(function(){return i.DefaultVertexData})),r.d(e,"DefaultVertexStructInfo",(function(){return i.DefaultVertexStructInfo})),r.d(e,"VertexStruct",(function(){return i.VertexStruct})),r.d(e,"Mesh",(function(){return i.Mesh})),r.d(e,"MeshLegacy",(function(){return i.MeshLegacy})),r.d(e,"ZograRenderer",(function(){return i.ZograRenderer})),r.d(e,"DepthTest",(function(){return i.DepthTest})),r.d(e,"Blending",(function(){return i.Blending})),r.d(e,"Culling",(function(){return i.Culling})),r.d(e,"DefaultShaderAttributeNames",(function(){return i.DefaultShaderAttributeNames})),r.d(e,"Shader",(function(){return i.Shader})),r.d(e,"FilterMode",(function(){return i.FilterMode})),r.d(e,"WrapMode",(function(){return i.WrapMode})),r.d(e,"Texture",(function(){return i.Texture})),r.d(e,"TextureResizing",(function(){return i.TextureResizing})),r.d(e,"Texture2D",(function(){return i.Texture2D})),r.d(e,"DepthTexture",(function(){return i.DepthTexture})),r.d(e,"RenderTexture",(function(){return i.RenderTexture})),r.d(e,"Asset",(function(){return i.Asset})),r.d(e,"GPUAsset",(function(){return i.GPUAsset})),r.d(e,"LazyInitAsset",(function(){return i.LazyInitAsset})),r.d(e,"AssetManager",(function(){return i.AssetManager})),r.d(e,"Lines",(function(){return i.Lines})),r.d(e,"LineBuilder",(function(){return i.LineBuilder})),r.d(e,"EventEmitter",(function(){return i.EventEmitter})),r.d(e,"BufferStructureInfo",(function(){return i.BufferStructureInfo})),r.d(e,"GLArrayBuffer",(function(){return i.GLArrayBuffer})),r.d(e,"RenderBuffer",(function(){return i.RenderBuffer})),r.d(e,"DepthBuffer",(function(){return i.DepthBuffer})),r.d(e,"FrameBuffer",(function(){return i.FrameBuffer})),r.d(e,"DebugProvider",(function(){return i.DebugProvider})),r.d(e,"TextureFormat",(function(){return i.TextureFormat})),r.d(e,"AssetsPack",(function(){return i.AssetsPack})),r.d(e,"AssetsImporter",(function(){return i.AssetsImporter})),r.d(e,"TextureImporter",(function(){return i.TextureImporter})),r.d(e,"MeshBuilder",(function(){return i.MeshBuilder})),r.d(e,"MeshBuilderLegacy",(function(){return i.MeshBuilderLegacy})),r.d(e,"Utils",(function(){return i.Utils})),r.d(e,"GLContext",(function(){return i.GLContext})),r.d(e,"GlobalContext",(function(){return i.GlobalContext})),r.d(e,"Projection",(function(){return n.m})),r.d(e,"Camera",(function(){return n.c})),r.d(e,"RenderObject",(function(){return n.n})),r.d(e,"LightType",(function(){return n.j})),r.d(e,"Light",(function(){return n.i})),r.d(e,"Entity",(function(){return n.d})),r.d(e,"EntityManager",(function(){return n.e})),r.d(e,"Scene",(function(){return n.o})),r.d(e,"Transform",(function(){return n.q})),r.d(e,"ZograEngine",(function(){return n.r})),r.d(e,"KeyState",(function(){return n.g})),r.d(e,"InputManager",(function(){return n.f})),r.d(e,"Keys",(function(){return n.h})),r.d(e,"Timeline",(function(){return n.p})),r.d(e,"AnimationPlayback",(function(){return n.a})),r.d(e,"Animator",(function(){return n.b})),r.d(e,"ParticleMaterial",(function(){return n.k})),r.d(e,"ParticleSystem",(function(){return n.l})),r.d(e,"PreviewRenderer",(function(){return s.g})),r.d(e,"RenderOrder",(function(){return s.j})),r.d(e,"RenderData",(function(){return s.i})),r.d(e,"RenderContext",(function(){return s.h})),r.d(e,"Default2DRenderPipeline",(function(){return s.d})),r.d(e,"PostProcess",(function(){return s.e})),r.d(e,"PostprocessPass",(function(){return s.f})),r.d(e,"Bloom",(function(){return s.a})),r.d(e,"BlurMethod",(function(){return s.c})),r.d(e,"Blur",(function(){return s.b})),r.d(e,"RenderPass",(function(){return s.k})),r.d(e,"BoxCollider",(function(){return o.a})),r.d(e,"Collider2D",(function(){return a.a})),r.d(e,"Physics2D",(function(){return u.a})),r.d(e,"Rigidbody2D",(function(){return c})),r.d(e,"TilemapCollider",(function(){return l.a})),r.d(e,"Sprite",(function(){return d.a})),r.d(e,"SpriteObject",(function(){return f.a})),r.d(e,"Tilemap",(function(){return m.b})),r.d(e,"Chunk",(function(){return m.a})),r.d(e,"Default2DMaterial",(function(){return p.a})),r.d(e,"LineRenderer",(function(){return b.a})),r.d(e,"ShadowType",(function(){return v.d})),r.d(e,"Shadow2DVertStruct",(function(){return v.c})),r.d(e,"Light2D",(function(){return v.a})),r.d(e,"Shadow2DMaterial",(function(){return v.b})),r.d(e,"BuiltinShaders",(function(){return g}));var i=r(5),n=r(59),s=r(60),o=r(40),a=r(35),u=r(72),h=r(0);class c{constructor(t){this.mass=1,this._velocity=h.b.zero(),this._acceleration=h.b.zero(),this._motion=h.b.zero(),this.collider=t}get velocity(){return this._velocity}set velocity(t){this._velocity.set(t)}get acceleration(){return this._acceleration}addForce(t){this._acceleration.x+=t.x/this.mass,this._acceleration.y+=t.y/this.mass}addAcceleration(t){this._acceleration.plus(t)}setAcceleration(t){this._acceleration.set(t)}setForce(t){this._acceleration.x=t.x/this.mass,this._acceleration.y=t.y/this.mass}clearForce(){this._acceleration.x=0,this._acceleration.y=0}}var l=r(30),d=r(66),f=r(77),m=r(44),p=r(39),b=r(75),v=r(33);const g=r(19).ShaderSource},function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return o}));var i=r(12),n=r(26);class s{constructor(){this.__intialized=!1}create(t){}}class o extends n.a{constructor(t,e){super(),this.format=e,this.buffers=[new i.c(t.screen.width,t.screen.height,!1,this.format,i.b.Nearest).createFramebuffer(),new i.c(t.screen.width,t.screen.height,!1,this.format,i.b.Nearest).createFramebuffer()]}render(t,e){if(!e.cameraOutput.size.equals(this.buffers[0].size)){const t=this.buffers[0].colorAttachments[0].resize(e.cameraOutput.width,e.cameraOutput.height,i.f.Discard),r=this.buffers[1].colorAttachments[0].resize(e.cameraOutput.width,e.cameraOutput.height,i.f.Discard);this.buffers[0].reset(e.cameraOutput.width,e.cameraOutput.height),this.buffers[1].reset(e.cameraOutput.width,e.cameraOutput.height),this.buffers[0].addColorAttachment(t,0),this.buffers[1].addColorAttachment(r,0)}const r=e.camera;let[n,s]=this.buffers;const o=e.cameraOutput.colorAttachments[0];t.renderer.blitCopy(o,n.colorAttachments[0]);for(const e of r.postprocess)e.__intialized||(e.create(t),e.__intialized=!0),e.render(t,n.colorAttachments[0],s),[n,s]=[s,n];e.postprocessOutput=n.colorAttachments[0]}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return u}));var i=r(8),n=r(7),s=r(11),o=r(19),a=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};class u extends(Object(i.b)(new n.e(...o.ShaderSource.default2D,{cull:n.b.Disable,depth:n.d.Disable,zWrite:!1,blend:[n.a.SrcAlpha,n.a.OneMinusSrcAlpha]}))){constructor(){super(...arguments),this.texture=null,this.color=s.a.white}}a([Object(i.e)("uMainTex","tex2d")],u.prototype,"texture",void 0),a([Object(i.e)("uColor","color")],u.prototype,"color",void 0)},function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var i=r(0),n=r(35);var s=r(32),o=r(30);class a extends n.a{constructor(){super(...arguments),this.offset=i.b.zero(),this.size=i.b.one()}checkCollision(t,e){return t instanceof o.a?Object(s.a)(t,this,e.negative):(console.warn("Unimplemented collision check"),null)}checkContact(t){return t instanceof o.a?Object(s.b)(t,this):t instanceof a?function(t,e){if(!t.entity||!e.entity)return!1;const r=t.entity.position.toVec2().plus(t.offset),n=e.entity.position.toVec2().plus(e.offset),s=i.b.math(Math.abs)(i.b.minus(n,r));return s.x<=(t.size.x+e.size.x)/2&&s.y<=(t.size.y+e.size.y)/2}(this,t):(console.warn("Unimplemented collision check"),!1)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return o}));var i,n=r(21),s=r(0);function o(t,e,r){let o=new n.a(s.b.zero(),t),a=new n.a(s.b.zero(),e);if(r===i.Contain){if(t.x/t.y>e.x/e.y){const r=e.y-t.y*(e.x/t.x);a.min.y+=r/2,a.max.y-=r/2}else{const r=e.x-t.x*(e.y/t.y);a.min.x+=r/2,a.max.x-=r/2}}else if(r===i.Cover){if(t.x/t.y>e.x/e.y){const r=t.x-e.x*(t.y/e.y);o.min.x+=r/2,o.max.x-=r/2}else{const r=t.y-e.y*(t.x/e.x);o.min.y+=r/2,o.max.y-=r/2}}else{if(t.x<e.x)switch(r){case i.Center:const r=e.x-t.x;a.min.x+=r/2,a.max.x-=r/2;break;case i.KeepHigher:a.min.x=e.x-t.x;break;case i.KeepLower:a.max.x=t.x}else if(t.x>e.x)switch(r){case i.Center:const r=t.x-e.x;o.min.x+=r/2,o.max.x-=r/2;break;case i.KeepHigher:o.min.x=t.x-e.x;break;case i.KeepLower:o.max.x=e.x}if(t.y<e.y)switch(r){case i.Center:const r=e.y-t.y;a.min.y+=r/2,a.max.y-=r/2;break;case i.KeepHigher:a.min.y=e.y-t.y;break;case i.KeepLower:a.max.y=t.y}else if(t.y>e.y)switch(r){case i.Center:const r=t.y-e.y;o.min.y+=r/2,o.max.y-=r/2;break;case i.KeepHigher:o.min.y=t.y-e.y;break;case i.KeepLower:o.max.y=e.y}}return[o,a]}!function(t){t[t.Stretch=1]="Stretch",t[t.Cover=2]="Cover",t[t.Contain=3]="Contain",t[t.KeepLower=4]="KeepLower",t[t.KeepHigher=5]="KeepHigher",t[t.Center=6]="Center"}(i||(i={}))},function(t,e,r){(function(t,e){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r;!function(r){!function(i){var n="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),s=o(r);function o(t,e){return function(r,i){"function"!=typeof t[r]&&Object.defineProperty(t,r,{configurable:!0,writable:!0,value:i}),e&&e(r,i)}}void 0===n.Reflect?n.Reflect=r:s=o(n.Reflect,s),function(e){var r=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,n=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,u=!o&&!a,h={create:o?function(){return F(Object.create(null))}:a?function(){return F({__proto__:null})}:function(){return F({})},has:u?function(t,e){return r.call(t,e)}:function(t,e){return e in t},get:u?function(t,e){return r.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},c=Object.getPrototypeOf(Function),l="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],r=function(){function t(t,e,r){this._index=0,this._keys=t,this._values=e,this._selector=r}return t.prototype["@@iterator"]=function(){return this},t.prototype[s]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var r=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var r=this._find(t,!0);return this._values[r]=e,this},e.prototype.delete=function(e){var r=this._find(e,!1);if(r>=0){for(var i=this._keys.length,n=r+1;n<i;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new r(this._keys,this._values,i)},e.prototype.values=function(){return new r(this._keys,this._values,n)},e.prototype.entries=function(){return new r(this._keys,this._values,o)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[s]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function i(t,e){return t}function n(t,e){return e}function o(t,e){return[t,e]}}():Map,f=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[s]=function(){return this.keys()},t}():Set,m=new(l||"function"!=typeof WeakMap?function(){var t=h.create(),e=i();return function(){function t(){this._key=i()}return t.prototype.has=function(t){var e=n(t,!1);return void 0!==e&&h.has(e,this._key)},t.prototype.get=function(t){var e=n(t,!1);return void 0!==e?h.get(e,this._key):void 0},t.prototype.set=function(t,e){return n(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=n(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=i()},t}();function i(){var e;do{e="@@WeakMap@@"+o()}while(h.has(t,e));return t[e]=!0,e}function n(t,i){if(!r.call(t,e)){if(!i)return;Object.defineProperty(t,e,{value:h.create()})}return t[e]}function s(t,e){for(var r=0;r<e;++r)t[r]=255*Math.random()|0;return t}function o(){var t,e=(t=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t):s(new Array(t),t));e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var r="",i=0;i<16;++i){var n=e[i];4!==i&&6!==i&&8!==i||(r+="-"),n<16&&(r+="0"),r+=n.toString(16).toLowerCase()}return r}}():WeakMap);function p(t,e,r){var i=m.get(t);if(w(i)){if(!r)return;i=new d,m.set(t,i)}var n=i.get(e);if(w(n)){if(!r)return;n=new d,i.set(e,n)}return n}function b(t,e,r){var i=p(e,r,!1);return!w(i)&&!!i.has(t)}function v(t,e,r){var i=p(e,r,!1);if(!w(i))return i.get(t)}function g(t,e,r,i){p(r,i,!0).set(t,e)}function y(t,e){var r=[],i=p(t,e,!1);if(w(i))return r;for(var n=function(t){var e=S(t,s);if(!A(e))throw new TypeError;var r=e.call(t);if(!O(r))throw new TypeError;return r}(i.keys()),o=0;;){var a=j(n);if(!a)return r.length=o,r;var u=a.value;try{r[o]=u}catch(t){try{P(n)}finally{throw t}}o++}}function x(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function w(t){return void 0===t}function M(t){return null===t}function O(t){return"object"==typeof t?null!==t:"function"==typeof t}function R(t,e){switch(x(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var r=3===e?"string":5===e?"number":"default",i=S(t,n);if(void 0!==i){var s=i.call(t,r);if(O(s))throw new TypeError;return s}return function(t,e){if("string"===e){var r=t.toString;if(A(r))if(!O(n=r.call(t)))return n;if(A(i=t.valueOf))if(!O(n=i.call(t)))return n}else{var i;if(A(i=t.valueOf))if(!O(n=i.call(t)))return n;var n,s=t.toString;if(A(s))if(!O(n=s.call(t)))return n}throw new TypeError}(t,"default"===r?"number":r)}function T(t){var e=R(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function _(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function A(t){return"function"==typeof t}function E(t){return"function"==typeof t}function S(t,e){var r=t[e];if(null!=r){if(!A(r))throw new TypeError;return r}}function j(t){var e=t.next();return!e.done&&e}function P(t){var e=t.return;e&&e.call(t)}function z(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===c)return e;if(e!==c)return e;var r=t.prototype,i=r&&Object.getPrototypeOf(r);if(null==i||i===Object.prototype)return e;var n=i.constructor;return"function"!=typeof n||n===t?e:n}function F(t){return t.__=void 0,delete t.__,t}e("decorate",(function(t,e,r,i){if(w(r)){if(!_(t))throw new TypeError;if(!E(e))throw new TypeError;return function(t,e){for(var r=t.length-1;r>=0;--r){var i=(0,t[r])(e);if(!w(i)&&!M(i)){if(!E(i))throw new TypeError;e=i}}return e}(t,e)}if(!_(t))throw new TypeError;if(!O(e))throw new TypeError;if(!O(i)&&!w(i)&&!M(i))throw new TypeError;return M(i)&&(i=void 0),function(t,e,r,i){for(var n=t.length-1;n>=0;--n){var s=(0,t[n])(e,r,i);if(!w(s)&&!M(s)){if(!O(s))throw new TypeError;i=s}}return i}(t,e,r=T(r),i)})),e("metadata",(function(t,e){return function(r,i){if(!O(r))throw new TypeError;if(!w(i)&&!function(t){switch(x(t)){case 3:case 4:return!0;default:return!1}}(i))throw new TypeError;g(t,e,r,i)}})),e("defineMetadata",(function(t,e,r,i){if(!O(r))throw new TypeError;return w(i)||(i=T(i)),g(t,e,r,i)})),e("hasMetadata",(function(t,e,r){if(!O(e))throw new TypeError;return w(r)||(r=T(r)),function t(e,r,i){if(b(e,r,i))return!0;var n=z(r);return!M(n)&&t(e,n,i)}(t,e,r)})),e("hasOwnMetadata",(function(t,e,r){if(!O(e))throw new TypeError;return w(r)||(r=T(r)),b(t,e,r)})),e("getMetadata",(function(t,e,r){if(!O(e))throw new TypeError;return w(r)||(r=T(r)),function t(e,r,i){if(b(e,r,i))return v(e,r,i);var n=z(r);return M(n)?void 0:t(e,n,i)}(t,e,r)})),e("getOwnMetadata",(function(t,e,r){if(!O(e))throw new TypeError;return w(r)||(r=T(r)),v(t,e,r)})),e("getMetadataKeys",(function(t,e){if(!O(t))throw new TypeError;return w(e)||(e=T(e)),function t(e,r){var i=y(e,r),n=z(e);if(null===n)return i;var s=t(n,r);if(s.length<=0)return i;if(i.length<=0)return s;for(var o=new f,a=[],u=0,h=i;u<h.length;u++){var c=h[u];o.has(c)||(o.add(c),a.push(c))}for(var l=0,d=s;l<d.length;l++){c=d[l];o.has(c)||(o.add(c),a.push(c))}return a}(t,e)})),e("getOwnMetadataKeys",(function(t,e){if(!O(t))throw new TypeError;return w(e)||(e=T(e)),y(t,e)})),e("deleteMetadata",(function(t,e,r){if(!O(e))throw new TypeError;w(r)||(r=T(r));var i=p(e,r,!1);if(w(i))return!1;if(!i.delete(t))return!1;if(i.size>0)return!0;var n=m.get(e);return n.delete(r),n.size>0||m.delete(e),!0}))}(s)}()}(r||(r={}))}).call(this,r(70),r(71))},function(t,e,r){"use strict";r.d(e,"a",(function(){return v})),r.d(e,"b",(function(){return g}));var i=r(16),n=r(7),s=r(8),o=r(11),a=r(24),u=r(0),h=r(23),c=r(1),l=r(2),d=r(19),f=r(27),m=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const p=Object(i.e)({vert:"vec3",color:"vec4",normal:"vec3",uv:"vec2",uv2:"vec2",pos:"vec3",rotation:"vec3",size:"float"}),b=Object.assign(Object.assign({},n.c),{pos:"particlePos",rotation:"particleRotation",size:"particleSize"});class v extends(Object(s.b)(new n.e(...d.ShaderSource.particle2D,{vertexStructure:p,attributes:b}))){constructor(){super(...arguments),this.color=o.a.white,this.texture=null}}m([Object(s.e)("uColor","color")],v.prototype,"color",void 0),m([Object(s.e)("uMainTex","tex2d")],v.prototype,"texture",void 0);class g extends f.a{constructor(){super(),this.mesh=a.a.quad(),this.material=new v,this.duration=1,this.lifetime=1,this.spawnRate=30,this.startSize=[.2,.4],this.startColor={r:1,g:1,b:1,a:1},this.startRotation={x:0,y:0,z:0},this.startSpeed=[5,10],this.startAcceleration={x:0,y:-20,z:0},this.emitter=g.boxEmitter(u.b.one()),this.lifeSize=null,this.lifeColor={r:null,g:null,b:null,a:null},this.lifeRotation={x:null,y:null,z:null},this.lifeSpeed=null,this.lifeAcceleration={x:null,y:null,z:null},this.particlesBuffer=new h.b({pos:"vec3",color:"vec4",rotation:"vec3",size:"float",velocity:"vec4",lifetime:"vec2",acceleration:"vec3"},0),this.particleCount=0,this.spawnedTime=0,this.state="stopped",this.particlesBuffer.static=!1}get maxCount(){return this.particlesBuffer.length}set maxCount(t){this.particlesBuffer.resize(t)}play(){this.state="pending"}update(t){switch(this.state){case"stopped":break;case"pending":this.state="running",this.spawnedTime=t.time;case"running":const e=1/this.getScalarValue(this.spawnRate);for(;this.spawnedTime+e<=t.time;)this.spawnedTime+=e,this.emitOne(this.position)}this.updateParticles(t)}render(t,e){t.renderer.drawMeshInstance(this.mesh,this.particlesBuffer,this.material,this.particleCount)}emit(t,e=this.position){for(let r=0;r<t;r++)this.emitOne(e)}updateParticles(t){for(let e=0;e<this.particleCount;e++){const r=this.particlesBuffer[e],i=r.lifetime[0]/r.lifetime[1];if(i>=1){e<this.particleCount-1&&(this.particlesBuffer.swapVertices(e,this.particleCount-1),e--),this.particleCount--;continue}r.lifetime[0]+=t.deltaTime,this.lifeColor&&("function"==typeof this.lifeColor?r.color.set(this.lifeColor(i,this)):(r.color[0]=this.updateScalarValue(this.lifeColor.r,i,r.color[0]),r.color[1]=this.updateScalarValue(this.lifeColor.g,i,r.color[1]),r.color[2]=this.updateScalarValue(this.lifeColor.b,i,r.color[2]),r.color[3]=this.updateScalarValue(this.lifeColor.a,i,r.color[3]))),this.lifeSize&&("function"==typeof this.lifeSize?r.size[0]=this.lifeSize(i):r.size[0]=this.updateScalarValue(this.lifeSize,i,r.size[0])),this.lifeAcceleration&&("function"==typeof this.lifeAcceleration?r.acceleration.set(this.lifeAcceleration(i,this)):(r.acceleration[0]=this.updateScalarValue(this.lifeAcceleration.x,i,r.acceleration[0]),r.acceleration[1]=this.updateScalarValue(this.lifeAcceleration.y,i,r.acceleration[1]),r.acceleration[2]=this.updateScalarValue(this.lifeAcceleration.z,i,r.acceleration[2])));let n=r.velocity[0],s=r.velocity[1],o=r.velocity[2];n*=r.velocity[3],s*=r.velocity[3],o*=r.velocity[3],n+=r.acceleration[0]*t.deltaTime,s+=r.acceleration[1]*t.deltaTime,o+=r.acceleration[2]*t.deltaTime,r.velocity[3]=Math.sqrt(n*n+s*s+o*o),r.velocity[0]=n/r.velocity[3],r.velocity[1]=s/r.velocity[3],r.velocity[2]=o/r.velocity[3],this.lifeSpeed&&("function"==typeof this.lifeSpeed?r.velocity[3]=this.lifeSpeed(i):r.velocity[3]=this.updateScalarValue(this.lifeSpeed,i,r.velocity[3])),r.pos[0]+=r.velocity[0]*r.velocity[3]*t.deltaTime,r.pos[1]+=r.velocity[1]*r.velocity[3]*t.deltaTime,r.pos[2]+=r.velocity[2]*r.velocity[3]*t.deltaTime,this.lifeRotation&&("function"==typeof this.lifeRotation?r.rotation.set(this.lifeRotation(i,this)):(r.rotation[0]=this.updateScalarValue(this.lifeRotation.x,i,r.rotation[0]),r.rotation[1]=this.updateScalarValue(this.lifeRotation.y,i,r.rotation[1]),r.rotation[2]=this.updateScalarValue(this.lifeRotation.z,i,r.rotation[2])))}}updateParticleProperty(t,e,r){}emitOne(t){if(this.particleCount>=this.maxCount)return;let e=this.particlesBuffer[this.particleCount++],r=c.b.zero(),i=c.b.zero();this.emitter(this,t,r,i);const n=this.getScalarValue(this.lifetime);let s=this.getScalarValue(this.startSpeed);if(e.velocity.set(r),s<0&&c.b.negate(e.velocity,r),e.velocity[3]=Math.abs(s),e.pos.set(i),e.size[0]=this.getScalarValue(this.startSize),e.lifetime[0]=0,e.lifetime[1]=n,"function"==typeof this.startColor){let t=this.startColor(0,this);e.color.set(t)}else e.color[0]=this.getScalarValue(this.startColor.r),e.color[1]=this.getScalarValue(this.startColor.g),e.color[2]=this.getScalarValue(this.startColor.b),e.color[3]=this.getScalarValue(this.startColor.a);"function"==typeof this.startRotation?e.rotation.set(this.startRotation(0,this)):(e.rotation[0]=this.getScalarValue(this.startRotation.x),e.rotation[1]=this.getScalarValue(this.startRotation.y),e.rotation[2]=this.getScalarValue(this.startRotation.z)),"function"==typeof this.startAcceleration?e.acceleration.set(this.startAcceleration(0,this)):(e.acceleration[0]=this.getScalarValue(this.startAcceleration.x),e.acceleration[1]=this.getScalarValue(this.startAcceleration.y),e.acceleration[2]=this.getScalarValue(this.startAcceleration.z))}getScalarValue(t){return"number"==typeof t?t:"function"==typeof t?t(this):t instanceof Array?l.a.lerp(...t,Math.random()):(console.warn("Unknown property generator: ",t),0)}updateScalarValue(t,e,r){return null===t?r:"number"==typeof t?t:"function"==typeof t?t(e):t instanceof Array?l.a.lerp(...t,e):(console.log("Unknown property modifier:",t),r)}static boxEmitter(t){return(e,r,i,n)=>{n[0]=(Math.random()-.5)*t.x,n[1]=(Math.random()-.5)*t.y,n[2]=0,n.plus(r),c.b.minus(i,n,r).normalize()}}static circleEmitter(t){return(e,r,i,n)=>{const s=Math.sqrt(Math.random())*t,o=Math.random()*Math.PI*2;n.x=Math.cos(o)*s,n.y=Math.sin(o)*s,n.z=0,n.plus(r),c.b.minus(i,n,r).normalize()}}}g.VertexStructure=p,g.AttributeNames=b},function(t,e,r){"use strict";r.d(e,"b",(function(){return l})),r.d(e,"a",(function(){return d}));var i=r(0),n=r(6),s=r(24),o=r(1),a=r(27),u=r(49),h=r(21);class c{constructor(t=0){this.bound=new h.a(i.b.zero(),i.b.zero()),this.points=new Array}append(t){this.points.push(t),this.bound.min.x=Math.min(t.x,this.bound.min.x),this.bound.min.y=Math.min(t.y,this.bound.min.y),this.bound.max.x=Math.max(t.x,this.bound.max.x),this.bound.max.y=Math.max(t.y,this.bound.max.y)}}class l extends a.a{constructor(...t){super(),this.chunks=new Map,this.materials[0]=u.a.tilemapDefault,0===t.length?(this.chunkSize=16,this.ChunkType=d):1===t.length?"number"==typeof t[0]?(this.chunkSize=t[0],this.ChunkType=d):(this.chunkSize=16,this.ChunkType=t[0]):[this.chunkSize,this.ChunkType]=t}render(t,e){this.eventEmitter.with().emit("render",this,t,e);let r=Object(i.b)(e.camera.viewHeight*e.camera.aspectRatio,e.camera.viewHeight),[s]=this.chunkPos(Object(n.h)(e.camera.position.toVec2(),r)),[o]=this.chunkPos(Object(n.j)(e.camera.position.toVec2(),r));for(let e=s.y;e<=o.y;e++)for(let r=s.x;r<=o.x;r++){const n=this.getOrCreateChunk(Object(i.b)(r,e));t.renderer.drawMesh(n.mesh,this.localToWorldMatrix,this.materials[0])}}getTile(t){let[e,r]=this.chunkPos(i.b.math(Math.floor)(t));return this.getOrCreateChunk(e).getTile(r)}setTile(t,e){let[r,n]=this.chunkPos(i.b.math(Math.floor)(t));return this.getOrCreateChunk(r).setTile(n,e)}getChunkAt(t){let[e,r]=this.chunkPos(i.b.math(Math.floor)(t));return this.getOrCreateChunk(e)}visibleChunkRange(t){let e=Object(i.b)(t.viewHeight*t.aspectRatio,t.viewHeight),[r]=this.chunkPos(Object(n.h)(t.position.toVec2(),e)),[s]=this.chunkPos(Object(n.j)(t.position.toVec2(),e));return[r,Object(n.j)(s,1)]}getOrCreateChunk(t){const e=this.calcChunkID(t);let r=this.chunks.get(e);return r||(r=new this.ChunkType(t.mul(this.chunkSize),this.chunkSize),this.chunks.set(e,r),r)}getChunk(t){const e=this.calcChunkID(t);return this.chunks.get(e)}calcChunkID(t){let e=t.x,r=t.y;-0==t.x&&(e=0),-0==t.y&&(r=0);const i=r>=0?0:1;return(e>=0?0:1)<<31|Math.abs(Math.floor(e))<<16|i<<15|Math.abs(Math.floor(r))}destroy(){if(!this.destroyed){super.destroy();for(const t of this.chunks.values())t.destroy();this.chunks.clear()}}chunkPos(t){let e=i.b.math(Math.floor)(t);return[i.b.math(Math.floor)(Object(n.f)(e,this.chunkSize)),i.b.math(f)(e,Object(i.b)(this.chunkSize))]}}class d{constructor(t,e){this.polygons=[],this.dirty=!1,this.chunkSize=e,this.basePos=t,this.tiles=new Array(e*e),this.mesh=function(t,e){const r=new s.a(e*e*4,e*e*6),n=[{vert:Object(o.b)(0),uv:Object(i.b)(0,0)},{vert:Object(o.b)(0),uv:Object(i.b)(1,0)},{vert:Object(o.b)(0),uv:Object(i.b)(1,1)},{vert:Object(o.b)(0),uv:Object(i.b)(0,1)}];for(let i=0;i<e;i++)for(let s=0;s<e;s++)n[0].vert.set([s+t.x,i+t.y,0]),n[1].vert.set([s+1+t.x,i+t.y,0]),n[2].vert.set([s+1+t.x,i+1+t.y,0]),n[3].vert.set([s+t.x,i+1+t.y,0]),r.addPolygon(...n);return r.toMesh()}(t,e)}getTile(t){const e=t.y*this.chunkSize+t.x;return this.tiles[e]}setTile(t,e){var r;let i=t.y*this.chunkSize+t.x;(null===(r=this.tiles[i])||void 0===r?void 0:r.collide)!==(null==e?void 0:e.collide)&&(this.dirty=!0),this.tiles[i]=e,i*=4,(null==e?void 0:e.sprite)&&(this.mesh.vertices[i+0].uv.set([e.sprite.uvRect.xMin,e.sprite.uvRect.yMin]),this.mesh.vertices[i+1].uv.set([e.sprite.uvRect.xMax,e.sprite.uvRect.yMin]),this.mesh.vertices[i+2].uv.set([e.sprite.uvRect.xMax,e.sprite.uvRect.yMax]),this.mesh.vertices[i+3].uv.set([e.sprite.uvRect.xMin,e.sprite.uvRect.yMax]),this.mesh.vertices[i+0].color.set(e.sprite.color),this.mesh.vertices[i+1].color.set(e.sprite.color),this.mesh.vertices[i+2].color.set(e.sprite.color),this.mesh.vertices[i+3].color.set(e.sprite.color),this.mesh.update())}destroy(){this.mesh.destroy()}getPolygons(){return this.dirty&&(this.polygons=Array.from(this.enumPolygons())),this.dirty=!1,this.polygons}*enumPolygons(){const t=(t,e)=>0<=t&&t<this.chunkSize&&0<=e&&e<this.chunkSize,e=new Array((this.chunkSize+1)*(this.chunkSize+1)*(this.chunkSize+1)*(this.chunkSize+1)),r=(e,r)=>t(e,r)?this.tiles[r*this.chunkSize+e]:null,n=(t,e)=>{var i,n,s,o,a;return(null===(i=r(t,e))||void 0===i?void 0:i.collide)?(null===(n=r(t-1,e))||void 0===n?void 0:n.collide)?(null===(s=r(t+1,e))||void 0===s?void 0:s.collide)?(null===(o=r(t,e-1))||void 0===o?void 0:o.collide)?(null===(a=r(t,e+1))||void 0===a?void 0:a.collide)?0:l:d:h:u:0},s=(t,e)=>e*this.chunkSize+t,o=(t,e)=>s(t.x,t.y)*(this.chunkSize+1)*(this.chunkSize+1)+s(e.x,e.y),a=(t,n,s)=>{var a,c,f,m,p,b,v,g,y,x,w,M;const O=[t,n];let R=t.clone();for(;;){let t=O[O.length-1];if(e[o(R,t)]){O.length-=1,O[0].equals(O[O.length-1])&&(O.length-=1);break}switch(e[o(R,t)]=!0,R.set(t),s){case l:if(null===(a=r(t.x,t.y))||void 0===a?void 0:a.collide)O.push(Object(i.b)(t.x+1,t.y)),s=h;else if(null===(c=r(t.x-1,t.y))||void 0===c?void 0:c.collide)t.y+=1;else{if(!(null===(f=r(t.x-1,t.y-1))||void 0===f?void 0:f.collide))throw new Error("Invalid tilemap");O.push(Object(i.b)(t.x-1,t.y)),s=u}break;case u:if(null===(m=r(t.x-1,t.y))||void 0===m?void 0:m.collide)O.push(Object(i.b)(t.x,t.y+1)),s=l;else if(null===(p=r(t.x-1,t.y-1))||void 0===p?void 0:p.collide)t.x-=1;else{if(!(null===(b=r(t.x,t.y-1))||void 0===b?void 0:b.collide))throw new Error("Invalid tilemap");O.push(Object(i.b)(t.x,t.y-1)),s=d}break;case d:if(null===(v=r(t.x-1,t.y-1))||void 0===v?void 0:v.collide)O.push(Object(i.b)(t.x-1,t.y)),s=u;else if(null===(g=r(t.x,t.y-1))||void 0===g?void 0:g.collide)t.y-=1;else{if(!(null===(y=r(t.x,t.y))||void 0===y?void 0:y.collide))throw new Error("Invalid tilemap");O.push(Object(i.b)(t.x+1,t.y)),s=h}break;case h:if(null===(x=r(t.x,t.y-1))||void 0===x?void 0:x.collide)O.push(Object(i.b)(t.x,t.y-1)),s=d;else if(null===(w=r(t.x,t.y))||void 0===w?void 0:w.collide)t.x+=1;else{if(!(null===(M=r(t.x-1,t.y))||void 0===M?void 0:M.collide))throw new Error("Invalid tilemap");O.push(Object(i.b)(t.x,t.y+1)),s=l}}}return O},u=1,h=2,l=3,d=4;for(let t=0;t<this.chunkSize;t++)for(let r=0;r<this.chunkSize;r++){const s=n(r,t);if(!s)continue;let f,m,p;switch(s){case u:f=Object(i.b)(r,t+1),m=Object(i.b)(r,t),p=d;break;case d:f=Object(i.b)(r,t),m=Object(i.b)(r+1,t),p=h;break;case h:f=Object(i.b)(r+1,t),m=Object(i.b)(r+1,t+1),p=l;break;case l:f=Object(i.b)(r+1,t+1),m=Object(i.b)(r,t+1),p=d}if(!e[o(f,m)]){const t=a(f,m,p),e=new c(t.length);for(const r of t)e.append(r.plus(this.basePos));yield e}}}}function f(t,e){return t>=0?t%e:(e+t%e)%e}},function(t,e,r){"use strict";r.d(e,"a",(function(){return u}));var i=r(36),n=r(50),s=r(17),o=r(11),a=r(9);class u extends i.a{constructor(){super(...arguments),this.lines=new n.b}drawLine(t,e,r=o.a.white){const i=this.lines.verts,n=this.lines.lines,s=this.lines.colors,a=i.length;i.push(t,e),s.push(r,r),n.push(a,a+1),this.lines.verts=i,this.lines.colors=s,this.lines.lines=n}render(t,e){t.renderer.setFramebuffer(s.a.CanvasBuffer),t.renderer.drawLines(this.lines,a.b.identity(),t.renderer.assets.materials.ColoredLine),this.lines.clear()}}},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return n}));class i{__addCollider(){}__removeCollider(){}__getColliders(){return[]}update(){}}class n{constructor(){this._physicsSystem=null,this._entity=null}get physics(){return this._physicsSystem}get entity(){return this._entity}__bind(t,e){if(this.entity&&this.entity!==t)throw new Error("Collider should only be bound to single entity.");this._entity=t,this._physicsSystem=e.physics,this._physicsSystem.__addCollider(this)}__unbind(){this._entity=null,this.__unbindPhysics()}__unbindPhysics(){var t;null===(t=this._physicsSystem)||void 0===t||t.__removeCollider(this),this._physicsSystem=null}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var i=r(9),n=r(1),s=r(22);class o{constructor(){this._parent=null,this.children=new Set,this._localPosition=n.b.zero(),this._localRotation=s.b.identity(),this._localScaling=n.b.one(),this._rotation=s.b.identity(),this._inv_rotation=s.b.identity(),this._localToWorld=i.b.identity(),this._worldToLocal=i.b.identity(),this._scene=null}get localPosition(){return this._localPosition}get localRotation(){return this._localRotation}get localScaling(){return this._localScaling}set localPosition(t){this._localPosition.set(t),this.updateTransformRecursive()}set localRotation(t){this._localRotation.set(t),this.updateTransformRecursive()}set localScaling(t){this._localScaling.set(t),this.updateTransformRecursive()}get scene(){return this._scene}get position(){return this._parent?i.b.mulPoint(this._parent.localToWorldMatrix,this.localPosition):this.localPosition}set position(t){this._parent?i.b.mulPoint(this._localPosition,this._parent.worldToLocalMatrix,t):this.localPosition.set(t),this.updateTransformRecursive()}get rotation(){return this._rotation}set rotation(t){this._parent?(s.b.mul(this._localRotation,this._parent._inv_rotation,t),s.b.normalize(this._localRotation,this._localRotation)):s.b.normalize(this._localRotation,t),this.updateTransformRecursive()}get localToWorldMatrix(){return this._localToWorld}get worldToLocalMatrix(){return this._worldToLocal}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.children.add(this),this.updateTransformRecursive()}translate(t){this._parent?this.localPosition.plus(i.b.mulVector(this._parent.worldToLocalMatrix,t)):this.localPosition.plus(t),this.updateTransformRecursive()}__addToScene(t){this._scene=t}__removeFromScene(t){this._scene=null}updateTransformRecursive(){this._rotation.set(this._localRotation),i.b.rts(this._localToWorld,this._localRotation,this._localPosition,this._localScaling),this._parent&&(i.b.mul(this._localToWorld,this._parent._localToWorld,this._localToWorld),s.b.mul(this._rotation,this._parent._rotation,this._rotation)),i.b.invert(this._worldToLocal,this._localToWorld),s.b.invert(this._inv_rotation,this._rotation);for(const t of this.children)t.updateTransformRecursive()}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var i=r(25),n=r(28),s=r(15);class o extends i.b{constructor(t){super(),this.engine=void 0,this.eventEmitter=new n.a,this.addsNextFrame=new Map,this.removesNextFrame=new Set,this.assetID=s.b.newAssetID(this),this.name="Scene_"+this.assetID,this.physics=new t}add(t,e=null){if(t.destroyed)console.error("Attempt to add destroyed entity");else{this.addsNextFrame.set(t,e);for(const e of t.children)this.add(e,t)}}remove(t){this.removesNextFrame.add(t)}rootEntities(){return this._entities.filter(t=>null===t.parent)}getEntities(){return this._entities}getEntitiesOfType(t){return this.entities.filter(e=>e instanceof t)}withPhysics(t){return this.physics=t,this}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}clearAll(){var t,e;const r=null!==(e=null===(t=this.engine)||void 0===t?void 0:t.time)&&void 0!==e?e:{time:0,deltaTime:0};for(const t of this._entities)t.destroy();this.addsNextFrame.clear(),this.removesNextFrame.clear(),this.removePendingEntites(r),this._entities=[],this.entityMap.clear()}destroy(){this.clearAll()}__update(t){var e;this.addPendingEntities(t),this.removePendingEntites(t);const r=this.rootEntities();for(const e of r)e.__updateRecursive(t);null===(e=this.physics)||void 0===e||e.update(t)}addPendingEntities(t){const e=this.addsNextFrame;this.addsNextFrame=new Map;for(const[t,r]of e){super.add(t),t.__addToScene(this);t.constructor;r&&(t.parent=r),this.eventEmitter.emit("entity-add",t,r||null)}for(const[r,i]of e)r.__start(t)}removePendingEntites(t){const e=this.removesNextFrame;this.removesNextFrame=new Set;for(const t of e)super.remove(t),t.__removeFromScene(this),this.eventEmitter.emit("entity-remove",t,t.parent);for(const r of e)r.__exit(t)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(39),n=r(43);const s={spriteDefault:new i.a,tilemapDefault:new i.a,particleDefault:new n.a}},function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return u}));var i=r(11),n=r(3),s=r(10),o=r(15);class a extends o.a{constructor(t=Object(n.b)()){var e,r;super(),this._verts=[],this._colors=[],this._lines=[],this.dirty=!0,this.vertices=new Float32Array(0),this.indices=new Uint32Array(0),this.name="Lines_"+this.assetID,this.gl=t,this.VBO=null!==(e=t.createBuffer())&&void 0!==e?e:Object(s.c)("Failed to create vertex buffer."),this.EBO=null!==(r=t.createBuffer())&&void 0!==r?r:Object(s.c)("Failed to create element buffer.")}get verts(){return this._verts}set verts(t){this._verts=t,this.dirty=!0}get colors(){return this._colors}set colors(t){this._colors=t,this.dirty=!0}get lines(){return this._lines}set lines(t){this._lines=t,this.dirty=!0}clear(){this.verts=[],this.colors=[],this.lines=[]}update(){if(this.dirty){const t=this.gl;if(this.lines.length%2!=0)throw new Error("Invalid lines.");if(this.colors.length!==this.verts.length&&(this.colors=[...this.colors,...Object(s.a)(i.a.white,this.verts.length-this.colors.length)]),this.vertices=new Float32Array(this.verts.flatMap((t,e)=>[...t,...this.colors[e]])),this.vertices.length!=7*this.verts.length)throw new Error("Buffer with invalid length.");this.indices=new Uint32Array(this.lines.flat()),t.bindBuffer(t.ARRAY_BUFFER,this.VBO),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.EBO),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.DYNAMIC_DRAW),this.dirty=!1}}bind(t){const e=this.gl;this.update();const r=t.attributes;e.bindBuffer(e.ARRAY_BUFFER,this.VBO),r.vert>=0&&(e.vertexAttribPointer(r.vert,3,e.FLOAT,!1,28,0),e.enableVertexAttribArray(r.vert)),r.color>=0&&(e.vertexAttribPointer(r.color,4,e.FLOAT,!1,28,12),e.enableVertexAttribArray(r.color)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.EBO)}destroy(){this.destroyed||(this.gl.deleteBuffer(this.VBO),this.gl.deleteBuffer(this.EBO),super.destroy())}}class u{constructor(t=0,e=Object(n.b)()){this.verts=[],this.colors=[],this.lines=[],this.gl=e}addLine(t,e=i.a.white){const r=this.verts.length,[n,s]=t;this.verts.push(n,s),this.colors.push(e,e),this.lines.push(r,r+1)}toLines(){const t=new a(this.gl);return t.verts=this.verts,t.colors=this.colors,t.lines=this.lines,t.update(),t}}},function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return s}));var i=r(3);class n{constructor(){this.mainAsset=null,this.assets=new Map}add(t,e){e.name=t,this.assets.set(t,e)}setMain(t){this.mainAsset=t}get(t){for(const[e,r]of this.assets)if(r instanceof t)return r;return null}getAll(t){return Array.from(this.assets.values()).filter(e=>e instanceof t)}}class s{constructor(t){this.importers=t}async url(t,e=Object(i.d)()){const r=await fetch(t).then(t=>t.arrayBuffer());return await this.buffer(r,e)}async blob(t,e=Object(i.d)()){const r=await t.arrayBuffer();return await this.buffer(r,e)}async buffer(t,e=Object(i.d)()){const r={};for(const i in this.importers)r[i]=r=>this.importers[i].import(t,r,e);return r}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return w}));var i=r(10),n=r(3),s=r(11),o=r(9),a=r(17),u=r(12),h=r(0),c=r(8),l=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};var d=r(18),f=r(20),m=r(14);var p=r(1),b=r(24);class v{constructor(t){const e=t.gl;this.gl=e,t.assets=this,this.BuiltinUniforms=d.a,this.shaderSources=f.BuiltinShaderSources,this.shaders=Object(d.b)(e),this.meshes=function(t){return{quad:b.a.quad(h.b.zero(),h.b.one(),t),screenQuad:b.a.ndcQuad(t),cube:b.a.cube(p.b.zero(),p.b.one(),t)}}(t),this.textures=function(t){var e;const r=document.createElement("canvas");r.width=r.height=64;const n=null!==(e=r.getContext("2d"))&&void 0!==e?e:Object(i.c)("Failed to create default texture.");n.fillStyle="black",n.fillRect(0,0,64,64),n.fillStyle="cyan",n.fillRect(0,0,32,32),n.fillRect(32,32,32,32);const s=new u.e(64,64,m.a.RGBA,u.b.Linear,t);s.setData(r),s.name="Texture-Error",n.fillStyle="blue",n.fillRect(0,0,64,64);const o=new u.e(64,64,m.a.RGBA,u.b.Linear,t);o.setData(r),o.name="Default-Normal",n.fillStyle="white",n.fillRect(0,0,64,64);const a=new u.e(64,64,m.a.RGBA,u.b.Linear,t);return a.setData(r),a.name="Default-White",{default:a,defaultNormal:o,error:s}}(t),this.types=function(t,e,r){let i=class extends(Object(c.b)(r.DefaultShader)){constructor(){super(...arguments),this.color=s.a.white,this.mainTexture=e.default}};l([Object(c.e)("uColor","color")],i.prototype,"color",void 0),l([Object(c.e)("uMainTex","tex2d")],i.prototype,"mainTexture",void 0),i=l([c.d],i);let n=class extends(Object(c.b)(r.BlitCopy)){constructor(){super(...arguments),this.source=null,this.flip=Object(h.b)(0,0)}};l([Object(c.e)("uMainTex","tex2d")],n.prototype,"source",void 0),l([Object(c.e)("uFlip","vec2")],n.prototype,"flip",void 0),n=l([c.d],n);let o=class extends(Object(c.b)(r.DefaultShader)){constructor(){super(...arguments),this.color=s.a.white,this.mainTexture=e.default,this.normalTexture=e.defaultNormal,this.emission=s.a.black,this.specular=s.a.white,this.metiallic=.023,this.smoothness=.5,this.fresnel=5}};return l([Object(c.e)("uColor","color")],o.prototype,"color",void 0),l([Object(c.e)("uMainTex","tex2d")],o.prototype,"mainTexture",void 0),l([Object(c.e)("uNormalTex","tex2d")],o.prototype,"normalTexture",void 0),l([Object(c.e)("uEmission","color")],o.prototype,"emission",void 0),l([Object(c.e)("uSpecular","color")],o.prototype,"specular",void 0),l([Object(c.e)("uMetallic","float")],o.prototype,"metiallic",void 0),l([Object(c.e)("uSmoothness","float")],o.prototype,"smoothness",void 0),l([Object(c.e)("uFresnel","float")],o.prototype,"fresnel",void 0),o=l([c.d],o),{DefaultMaterial:i,BlitCopy:n,DefaultLit:o}}(0,this.textures,this.shaders),this.materials=function(t,e,r,i){const n=new c.a(r.ErrorShader,t);return n.setProp("uMainTex","tex2d",i.error),{error:n,default:new e.DefaultMaterial(t),blitCopy:new e.BlitCopy(t),ColoredLine:new c.a(r.ColoredLine,t)}}(e,this.types,this.shaders,this.textures)}}var g=r(21),y=r(6);class x{constructor(t){this.pool=[],this.allocator=t}get(...t){return this.pool.length<=0?this.allocator(...t):this.pool.pop()}release(t){this.pool.push(t)}}class w{constructor(t,e,r){this.viewProjectionMatrix=o.b.identity(),this.viewMatrix=o.b.identity(),this.projectionMatrix=o.b.identity(),this.target=a.a.CanvasBuffer,this.shader=null,this.globalUniforms=new Map,this.globalTextures=new Map,this.framebufferPool=new x((t,e)=>new a.a(t,e)),this.blitFramebuffer=[new a.a,new a.a],this.canvas=t,this.width=void 0===e?t.width:e,this.height=void 0===r?t.height:r,this.canvas.width=this.width,this.canvas.height=this.height,this.scissor=new g.a(h.b.zero(),Object(h.b)(this.width,this.height)),this.gl=Object(i.d)(this.canvas.getContext("webgl2"),"WebGL2 is not support on current device."),this.gl.getExtension("EXT_color_buffer_float"),this.gl.getExtension("EXT_color_buffer_half_float"),this.ctx=new n.c,Object.assign(this.ctx,{gl:this.gl,width:this.width,height:this.height,assets:{},renderer:this}),this.assets=new v(this.ctx),this.ctx.assets=this.assets,Object(n.d)()||this.use(),this.helperAssets={clipBlitMesh:b.a.ndcQuad(),blitMesh:b.a.ndcTriangle()}}use(){Object(n.e)(this.ctx)}setSize(t,e){t=Math.floor(t),e=Math.floor(e),this.canvas.width=t,this.canvas.height=e,this.width=t,this.height=e,this.ctx.width=t,this.ctx.height=e}get canvasSize(){return Object(h.b)(this.width,this.height)}setViewProjection(t,e){o.b.mul(this.viewProjectionMatrix,e,t)}setFramebuffer(t,e){let r;if(t===a.a.CanvasBuffer)r=a.a.CanvasBuffer;else if(t instanceof a.a)r=t;else if(t instanceof Array){let i=0,n=0;t.length>0?(i=t[0].width,n=t[0].height):e&&(i=e.width,n=e.height);const s=this.getTempFramebuffer(i,n);for(let e=0;e<t.length;e++)s.addColorAttachment(t[e],e);e&&s.setDepthAttachment(e),r=s}else{const i=t,n=this.getTempFramebuffer(i.width,i.height);n.addColorAttachment(i,0),e&&n.setDepthAttachment(e),r=n}r!==this.target&&(this.detachCurrentFramebuffer(),this.target=r),this.scissor.min.set([0,0]),this.scissor.max.set(this.target.size),this.target.bind()}detachCurrentFramebuffer(){this.target.__isTemp&&this.framebufferPool.release(this.target)}getTempFramebuffer(t,e){const r=this.framebufferPool.get(t,e);return r.__isTemp=!0,r.reset(t,e),r}blitCopy(t,e){const r=this.gl,[i,n]=this.blitFramebuffer;i.reset(t.width,t.height),i.addColorAttachment(t),i.bind(),n.reset(t.width,t.height),r.bindFramebuffer(r.READ_FRAMEBUFFER,i.glFBO()),t instanceof u.c?r.framebufferTexture2D(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,t.glTex(),0):r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,t.glBuf()),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,n.glFBO()),e instanceof u.c?r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.glTex(),0):r.framebufferRenderbuffer(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.glBuf()),r.blitFramebuffer(0,0,t.width,t.height,0,0,e.width,e.height,r.COLOR_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)}clear(t=s.a.black,e=!0){this.gl.clearColor(t.r,t.g,t.b,t.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT|(e?this.gl.DEPTH_BUFFER_BIT:0))}blit(t,e,r=this.assets.materials.blitCopy,i,n){const s=this.target;this.setFramebuffer(e),e=this.target;const u=this.viewProjectionMatrix;let c=this.helperAssets.blitMesh,l=e===a.a.CanvasBuffer?new g.a(h.b.zero(),this.canvasSize):new g.a(h.b.zero(),e.size.clone());if(t&&(i||n)&&(l=n||l,i)){c=this.helperAssets.clipBlitMesh;let e=Object(y.f)(i.min,t.size),r=Object(y.f)(i.max,t.size);c.uvs=[Object(h.b)(e.x,e.y),Object(h.b)(r.x,e.y),Object(h.b)(r.x,r.y),Object(h.b)(e.x,r.y)],c.update()}this.target=e,this.scissor=l,this.viewProjectionMatrix=o.b.identity(),t&&r.setProp(d.a.mainTex,"tex2d",t),this.drawMesh(c,o.b.identity(),r),this.setFramebuffer(s),this.viewProjectionMatrix=u}useShader(t){this.gl;this.shader=t,t.use()}setupTransforms(t,e){this.gl;const r=o.b.mul(this.viewProjectionMatrix,e),i=o.b.create();o.b.invert(i,e)?o.b.transpose(i,i):i.fill(0);const n=o.b.mul(this.viewMatrix,e);o.b.invert(n,n)?o.b.transpose(n,n):n.fill(0),t.setupBuiltinUniform({matM:e,matVP:this.viewProjectionMatrix,matMVP:r,matM_IT:i,matMV_IT:n})}setupGlobalUniforms(t){for(const e of this.globalUniforms.values())t.setUniformDirectly(e.name,e.type,e.value)}drawMeshInstance(t,e,r,i){r||(r=this.assets.materials.error);const n=this.gl,s={assets:this.assets,gl:n,nextTextureUnit:0,size:Object(h.b)(this.width,this.height)};this.target.bind(),this.setupScissor(),this.useShader(r.shader),r.upload(s),this.setupTransforms(r.shader,o.b.identity());const a=t.bind();e.bindVertexArray(!0,r.shader.attributes),n.drawElementsInstanced(n.TRIANGLES,a,n.UNSIGNED_INT,0,i),e.unbindVertexArray(!0,r.shader.attributes),t.unbind(),r.unbindRenderTextures()}drawMeshProceduralInstance(t,e,r){e||(e=this.assets.materials.error);const i=this.gl,n={assets:this.assets,gl:i,nextTextureUnit:0,size:Object(h.b)(this.width,this.height)};this.target.bind(),this.setupScissor(),this.useShader(e.shader),e.upload(n),this.setupTransforms(e.shader,o.b.identity());const s=t.bind();i.drawElementsInstanced(i.TRIANGLES,s,i.UNSIGNED_INT,0,r),e.unbindRenderTextures()}drawMesh(t,e,r){r||(r=this.assets.materials.error);const i=this.gl,n={assets:this.assets,gl:i,nextTextureUnit:0,size:Object(h.b)(this.width,this.height)};this.target.bind(),this.setupScissor(),this.useShader(r.shader),r.upload(n),this.setupTransforms(r.shader,e),this.setupGlobalUniforms(r);let s=t.bind();i.drawElements(i.TRIANGLES,s,i.UNSIGNED_INT,0),t.unbind(),r.unbindRenderTextures()}drawLines(t,e,r){const i=this.gl,n={assets:this.assets,gl:i,nextTextureUnit:0,size:Object(h.b)(this.width,this.height)};this.target.bind(),this.setupScissor(),this.useShader(r.shader),r.upload(n),this.setupTransforms(r.shader,e),t.bind(r.shader),i.drawElements(i.LINES,t.lines.length,i.UNSIGNED_INT,0)}setGlobalUniform(t,e,r){this.globalUniforms.set(t,{name:t,type:e,value:r})}unsetGlobalUniform(t){this.globalUniforms.delete(t)}setupScissor(){this.gl.viewport(this.scissor.xMin,this.scissor.yMin,this.scissor.size.x,this.scissor.size.y)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return f}));var i=r(14),n=r(12),s=r(9),o=r(57),a=r(29),u=r(11),h=r(17),c=r(50),l=r(1),d=r(45);class f{constructor(t){this.msaa=4,this.materialReplaceMap=new Map,this.debugLayer=new d.a,this.cameraOutputFBOs=new Map,this.cameraOutputTextures=new Map,this.renderer=t;const e=Object(u.d)(1,1,1,.1),r=new c.a(0,t.gl);for(let t=-10;t<=10;t+=1)r.addLine([Object(l.b)(t,0,-10),Object(l.b)(t,0,10)],e),r.addLine([Object(l.b)(-10,0,t),Object(l.b)(10,0,t)],e);this.grid=r.toLines()}render(t,e,r){for(let i=0;i<r.length;i++){const n=a.a.create(r[i],e,this.getFramebuffer(t,r[i]));this.renderCamera(t,n)}}setupLight(t,e){t.renderer.setGlobalUniform("uLightDir","vec3",Object(l.b)(-1,1,0).normalize()),t.renderer.setGlobalUniform("uAmbientSky","color",Object(u.c)(.2,.2,.2)),t.renderer.setGlobalUniform("uLightPos","vec3",e.camera.position.clone()),t.renderer.setGlobalUniform("uLightColor","color",Object(u.c)(.8,.8,.8))}renderCamera(t,e){const r=e.camera;r.__preRender(t),t.renderer.setFramebuffer(e.cameraOutput),t.renderer.clear(r.clearColor,r.clearDepth),t.renderer.setViewProjection(r.worldToLocalMatrix,r.projectionMatrix),t.renderer.setGlobalUniform("uCameraPos","vec3",r.position.clone()),this.setupLight(t,e);const i=e.getVisibleObjects(a.b.NearToFar);for(const r of i)r.render(t,e);this.renderGrid(t,e),this.finalBlit(t,e),r.__postRender(t)}finalBlit(t,e){var r,s,o,a;const u=e.camera;let c=this.cameraOutputTextures.get(u);c||(c=new n.c(null!==(s=null===(r=e.camera.output)||void 0===r?void 0:r.width)&&void 0!==s?s:t.renderer.canvasSize.x,null!==(a=null===(o=e.camera.output)||void 0===o?void 0:o.height)&&void 0!==a?a:t.renderer.canvasSize.y,!1,i.a.RGBA,n.b.Linear),this.cameraOutputTextures.set(u,c)),t.renderer.blitCopy(e.cameraOutput.colorAttachments[0],c),t.renderer.blit(c,h.a.CanvasBuffer)}renderGrid(t,e){this.renderer.drawLines(this.grid,s.b.identity(),this.renderer.assets.materials.ColoredLine)}drawWithMaterial(t,e,r){this.materialReplaceMap.has(r.constructor)?this.renderer.drawMesh(t,e,this.materialReplaceMap.get(r.constructor)):this.renderer.drawMesh(t,e,r)}replaceMaterial(t,e){this.materialReplaceMap.set(t,e)}getFramebuffer(t,e){let r=this.cameraOutputFBOs.get(e);if(!r){r=new h.a(t.renderer.canvas.width,t.renderer.canvas.height);const n=new o.b(r.width,r.height,i.a.RGBA8,this.msaa);r.addColorAttachment(n),this.cameraOutputFBOs.set(e,r)}return r}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return p}));var i=r(8),n=r(7),s=r(13),o=r(12),a=r(3),u=r(11),h=r(0),c=r(6),l=r(14),d=r(19),f=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};class m extends(Object(i.b)(new n.e(...d.ShaderSource.boxBlur))){constructor(){super(...arguments),this.texture=null,this.textureSize=s.b.one(),this.sampleOffset=1}}f([Object(i.e)("uMainTex","tex2d")],m.prototype,"texture",void 0),f([Object(i.e)("uTexSize","vec4")],m.prototype,"textureSize",void 0),f([Object(i.e)("uSampleOffset","float")],m.prototype,"sampleOffset",void 0);class p{constructor(){this.steps=[],this.downsampleMaterial=new m,this.upsampleMaterial=new m}init(t){this.steps[0]||(this.steps[0]=new o.c(t.width,t.height,!1,t.format,t.filterMode),this.steps[0].wrapMode=o.g.Clamp,this.steps[0].updateParameters()),this.steps[0].width===t.width&&this.steps[0].height===t.height||this.steps[0].resize(t.width,t.height,o.f.Discard)}blur(t,e=4,r=this.steps[0],i=Object(a.d)()){return r==this.steps[0]&&(this.steps[0]||(this.steps[0]=new o.c(t.width,t.height,!1,t.format,t.filterMode)),this.init(t),r=this.steps[0]),i.renderer.setFramebuffer(r),i.renderer.clear(u.a.black),this.downSample(i.renderer,t,e),this.upSample(i.renderer,e,r)}downSample(t,e,r){for(let i=1;i<=r;i++){const r=h.b.floor(Object(c.f)(e.size,Object(h.b)(2)));this.steps[i]||(this.steps[i]=new o.c(r.x,r.y,!1,l.a.RGBA,o.b.Linear),this.steps[i].wrapMode=o.g.Clamp,this.steps[i].updateParameters());const n=this.steps[i];n.width===r.x&&n.height===r.y||n.resize(r.x,r.y,o.f.Discard),this.downsampleMaterial.texture=e,this.downsampleMaterial.textureSize=Object(s.b)(e.width,e.height,1/e.width,1/e.height),this.downsampleMaterial.sampleOffset=1,t.blit(e,n,this.downsampleMaterial),e=n}}upSample(t,e,r=this.steps[0]){let i=this.steps[e];for(let n=e-1;n>=0;n--){const e=Object(c.i)(i.size,Object(h.b)(2));this.steps[n]||(this.steps[n]=new o.c(e.x,e.y,!1,l.a.RGBA,o.b.Linear),this.steps[n].wrapMode=o.g.Clamp,this.steps[n].updateParameters());const a=0===n?r:this.steps[n];this.upsampleMaterial.texture=i,this.upsampleMaterial.textureSize=Object(s.b)(i.width,i.height,1/i.width,1/i.height),this.upsampleMaterial.sampleOffset=.5,t.blit(i,a,this.upsampleMaterial),i=a}return i}}},function(t,e,r){"use strict";var i=r(4),n=r(0);r.d(e,"h",(function(){return n.a})),r.d(e,"y",(function(){return n.b}));var s=r(1);r.d(e,"i",(function(){return s.a})),r.d(e,"z",(function(){return s.b}));var o=r(13);r.d(e,"j",(function(){return o.a})),r.d(e,"A",(function(){return o.b}));var a=r(11);r.d(e,"a",(function(){return a.a})),r.d(e,"p",(function(){return a.b})),r.d(e,"w",(function(){return a.c})),r.d(e,"x",(function(){return a.d}));var u=r(6);r.d(e,"b",(function(){return u.a})),r.d(e,"f",(function(){return u.b})),r.d(e,"k",(function(){return u.c})),r.d(e,"l",(function(){return u.d})),r.d(e,"m",(function(){return u.e})),r.d(e,"n",(function(){return u.f})),r.d(e,"o",(function(){return u.g})),r.d(e,"r",(function(){return u.h})),r.d(e,"s",(function(){return u.i})),r.d(e,"t",(function(){return u.j}));var h=r(9);r.d(e,"d",(function(){return h.a})),r.d(e,"q",(function(){return h.b}));var c=r(22);r.d(e,"e",(function(){return c.a})),r.d(e,"u",(function(){return c.b}));var l=r(56);r.d(e,"v",(function(){return l.a}));var d=r(21);r.d(e,"g",(function(){return d.a}));var f=r(2);r.d(e,"c",(function(){return f.a})),i.a.setMatrixArrayType(Array)},function(t,e,r){"use strict";function i(t,e){return{origin:t,direction:e.normalized}}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";r.d(e,"b",(function(){return u})),r.d(e,"a",(function(){return h}));var i=r(0),n=r(10),s=r(15),o=r(3),a=r(14);class u extends s.c{constructor(t,e,r=a.a.RGBA8,n=0,s=Object(o.d)()){super(s),this.multiSampling=0,this.format=a.a.RGBA8,this._glBuf=null,this.size=Object(i.b)(t,e),this.format=r,this.multiSampling=n,this.tryInit(!1)}get width(){return this.size.x}get height(){return this.size.y}glBuf(){return this.tryInit(!0),this._glBuf}resize(t,e){if(this.size.x=t,this.size.y=e,!this.initialized)return this;const r=this.ctx.gl;return r.bindRenderbuffer(r.RENDERBUFFER,this._glBuf),r.renderbufferStorageMultisample(r.RENDERBUFFER,this.multiSampling,this.format,this.size.x,this.size.y),r.bindRenderbuffer(r.RENDERBUFFER,null),this}updateParams(){this.tryInit(!0);const t=this.ctx.gl;t.bindRenderbuffer(t.RENDERBUFFER,this._glBuf),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multiSampling,this.format,this.size.x,this.size.y)}init(){var t;const e=this.ctx.gl;return this._glBuf=null!==(t=e.createRenderbuffer())&&void 0!==t?t:Object(n.c)("Failed to create render buffer."),e.bindRenderbuffer(e.RENDERBUFFER,this._glBuf),e.renderbufferStorageMultisample(e.RENDERBUFFER,this.multiSampling,this.format,this.size.x,this.size.y),e.bindRenderbuffer(e.RENDERBUFFER,null),!0}bindFramebuffer(t){this.tryInit(!0);const e=this.ctx.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,this._glBuf)}destroy(){super.destroy();this.ctx.gl.deleteRenderbuffer(this._glBuf)}}class h extends s.c{constructor(t,e,r=0,n=Object(o.d)()){super(n),this.multiSampling=0,this.format=a.a.RGBA8,this.glBuf=null,this.size=Object(i.b)(t,e),this.format=a.a.DEPTH_COMPONENT,this.multiSampling=r,this.tryInit(!1)}get width(){return this.size.x}set width(t){this.size.x=t}get height(){return this.size.y}set height(t){this.size.y=t}updateParams(){this.tryInit(!0);const t=this.ctx.gl;t.bindRenderbuffer(t.RENDERBUFFER,this.glBuf),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multiSampling,this.format,this.size.x,this.size.y)}init(){var t;const e=this.ctx.gl;return this.glBuf=null!==(t=e.createRenderbuffer())&&void 0!==t?t:Object(n.c)("Failed to create render buffer."),e.bindRenderbuffer(e.RENDERBUFFER,this.glBuf),e.renderbufferStorageMultisample(e.RENDERBUFFER,this.multiSampling,this.format,this.size.x,this.size.y),e.bindRenderbuffer(e.RENDERBUFFER,null),!0}bindFramebuffer(){this.tryInit(!0);const t=this.ctx.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.glBuf)}destroy(){super.destroy();this.ctx.gl.deleteRenderbuffer(this.glBuf)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));const i={create:t=>({renderer:t,screen:{width:t.canvas.width,height:t.canvas.height}})}},function(t,e,r){"use strict";r.d(e,"m",(function(){return n.b})),r.d(e,"c",(function(){return n.a})),r.d(e,"n",(function(){return s.a})),r.d(e,"j",(function(){return i})),r.d(e,"i",(function(){return u})),r.d(e,"d",(function(){return o.a})),r.d(e,"e",(function(){return o.b})),r.d(e,"o",(function(){return h.a})),r.d(e,"q",(function(){return c.a})),r.d(e,"r",(function(){return l.a})),r.d(e,"g",(function(){return d.b})),r.d(e,"f",(function(){return d.a})),r.d(e,"h",(function(){return d.c})),r.d(e,"p",(function(){return f.c})),r.d(e,"a",(function(){return f.a})),r.d(e,"b",(function(){return f.b})),r.d(e,"k",(function(){return m.a})),r.d(e,"l",(function(){return m.b}));var i,n=r(34),s=r(27),o=r(25),a=r(11);!function(t){t[t.Directional=0]="Directional",t[t.Point=1]="Point"}(i||(i={}));class u extends o.a{constructor(t=i.Directional){super(),this.intensity=1,this.color=a.a.white,this.type=t}}var h=r(48),c=r(47),l=r(62),d=r(31),f=r(76),m=r(43)},function(t,e,r){"use strict";r.d(e,"g",(function(){return i.a})),r.d(e,"j",(function(){return n.b})),r.d(e,"i",(function(){return n.a})),r.d(e,"h",(function(){return s.a})),r.d(e,"d",(function(){return o.a})),r.d(e,"e",(function(){return a.d})),r.d(e,"f",(function(){return a.e})),r.d(e,"a",(function(){return a.a})),r.d(e,"c",(function(){return a.c})),r.d(e,"b",(function(){return a.b})),r.d(e,"k",(function(){return u}));var i=r(53),n=r(29),s=r(58),o=r(64),a=r(61);class u{setup(t,e){}cleanup(t,e){}}},function(t,e,r){"use strict";r.d(e,"d",(function(){return n.a})),r.d(e,"e",(function(){return n.b})),r.d(e,"a",(function(){return s.a})),r.d(e,"c",(function(){return i})),r.d(e,"b",(function(){return a}));var i,n=r(38),s=r(74),o=r(54);!function(t){t[t.Downsample=0]="Downsample",t[t.Gussian=1]="Gussian"}(i||(i={}));class a extends n.a{constructor(t=i.Downsample){super(),this.radius=64,this.blurRenderer=new o.a,this.method=t}render(t,e,r){this.radius>0?this.blurRenderer.blur(e,Math.log2(this.radius),r):t.renderer.blit(e,r)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));var i=r(48),n=r(53),s=r(58),o=r(34),a=r(52),u=r(28),h=r(46);class c{constructor(t,e=n.a){this.fixedDeltaTime=!1,this._time={deltaTime:0,time:0},this.renderer=new a.a(t,t.width,t.height),this.renderPipeline=new e(this.renderer),this._scene=new i.a(h.b),this.eventEmitter=new u.a}get time(){return this._time}get scene(){return this._scene}set scene(t){const e=this._scene;this._scene=t,t.engine=this,this.eventEmitter.emit("scene-change",t,e)}renderScene(){const t=this.scene.getEntitiesOfType(o.a);this.renderPipeline.render(s.a.create(this.renderer),this.scene,t)}start(){let t=0,e=0,r=0;const i=n=>{if(0===t)return e=t=n,void requestAnimationFrame(i);this.fixedDeltaTime?r+=16:r=n;const s=(r-t)/1e3;t=r;const a={time:(r-e)/1e3,deltaTime:s};this._time=a,this.eventEmitter.emit("update",a),this.scene.__update(a),this.eventEmitter.emit("render",this.scene.getEntitiesOfType(o.a)),this.renderScene(),requestAnimationFrame(i)};requestAnimationFrame(i)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}},function(t,e,r){"use strict";var i=r(8);r.d(e,"u",(function(){return i.a})),r.d(e,"v",(function(){return i.b})),r.d(e,"B",(function(){return i.c})),r.d(e,"J",(function(){return i.d})),r.d(e,"K",(function(){return i.e}));var n=r(16);r.d(e,"h",(function(){return n.a})),r.d(e,"i",(function(){return n.b})),r.d(e,"w",(function(){return n.c})),r.d(e,"x",(function(){return n.d})),r.d(e,"G",(function(){return n.e}));var s=r(52);r.d(e,"I",(function(){return s.a}));var o=r(7);r.d(e,"c",(function(){return o.a})),r.d(e,"e",(function(){return o.b})),r.d(e,"g",(function(){return o.c})),r.d(e,"k",(function(){return o.d})),r.d(e,"A",(function(){return o.e}));var a=r(12);r.d(e,"l",(function(){return a.a})),r.d(e,"n",(function(){return a.b})),r.d(e,"z",(function(){return a.c})),r.d(e,"C",(function(){return a.d})),r.d(e,"D",(function(){return a.e})),r.d(e,"F",(function(){return a.f})),r.d(e,"H",(function(){return a.g}));var u=r(15);r.d(e,"a",(function(){return u.a})),r.d(e,"b",(function(){return u.b})),r.d(e,"q",(function(){return u.c})),r.d(e,"r",(function(){return u.d}));var h=r(50);r.d(e,"s",(function(){return h.a})),r.d(e,"t",(function(){return h.b}));var c=r(28);r.d(e,"m",(function(){return c.a}));var l=r(23);r.d(e,"d",(function(){return l.a})),r.d(e,"p",(function(){return l.b}));var d=r(57);r.d(e,"j",(function(){return d.a})),r.d(e,"y",(function(){return d.b}));var f=r(17);r.d(e,"o",(function(){return f.a}));var m=r(36);r.d(e,"f",(function(){return m.a}));var p=r(14);r.d(e,"E",(function(){return p.a}))},function(t,e,r){"use strict";r.d(e,"a",(function(){return z}));var i=r(14),n=r(57),s=r(0),o=r(29),a=r(11),u=r(17),h=r(45),c=r(3),l=r(23),d=r(12),f=r(24),m=r(13),p=r(1),b=r(8),v=r(7),g=r(16),y=r(33),x=r(19),w=r(26),M=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};class O extends w.a{constructor(t,e){super(),this.light2DShadowMaterial=new R,this.lightComposeMaterial=new T,this.lightInstancingMaterial=new A,this.lightInstancingBuffer=new l.b(_,64),this.settings=e,this.lightmap=new d.c(t.screen.width,t.screen.height,!1,i.a.RGBA16F,d.b.Linear),this.simpleLightMesh=f.a.quad(s.b.zero(),Object(s.b)(2)),this.lightInstancingBuffer.static=!1}render(t,e){e.cameraOutput.size.equals(this.lightmap.size)||this.lightmap.resize(e.cameraOutput.width,e.cameraOutput.height,d.f.Discard);const r=e.scene.getEntitiesOfType(y.a),i=r.filter(t=>t.shadowType===y.d.Hard||t.shadowType===y.d.Soft),n=r.filter(t=>!1===t.shadowType);t.renderer.setFramebuffer(this.lightmap),t.renderer.clear(a.a.black),this.drawShadowLights(t,e,i),this.drawSimpleLights(t,e,n),t.renderer.blit(this.lightmap,e.cameraOutput,this.lightComposeMaterial)}drawSimpleLights(t,e,r){r.length>this.lightInstancingBuffer.length&&this.lightInstancingBuffer.resize(2*this.lightInstancingBuffer.length);for(let t=0;t<r.length;t++)m.b.set(this.lightInstancingBuffer[t].lightColor,r[t].lightColor),p.b.set(this.lightInstancingBuffer[t].lightPos,r[t].position),this.lightInstancingBuffer[t].lightParams[0]=r[t].volumnRadius,this.lightInstancingBuffer[t].lightParams[1]=r[t].lightRange,this.lightInstancingBuffer[t].lightParams[2]=r[t].attenuation,this.lightInstancingBuffer[t].lightParams[3]=r[t].intensity;t.renderer.drawMeshInstance(this.simpleLightMesh,this.lightInstancingBuffer,this.lightInstancingMaterial,r.length)}drawShadowLights(t,e,r){for(let t=0;t<this.light2DShadowMaterial.lightParamsList.length;t++)this.light2DShadowMaterial.lightParamsList[t].fill(0);for(let i=0;i<r.length;i++){const n=r[i];this.light2DShadowMaterial.lightPosList[i]=this.light2DShadowMaterial.lightPosList[i]||m.b.zero(),m.b.set(this.light2DShadowMaterial.lightPosList[i],n.position),this.light2DShadowMaterial.lightPosList[i].w=1,this.light2DShadowMaterial.lightParamsList[i]=this.light2DShadowMaterial.lightParamsList[i]||m.b.zero(),this.light2DShadowMaterial.lightParamsList[i].x=n.volumnRadius,this.light2DShadowMaterial.lightParamsList[i].y=n.lightRange,this.light2DShadowMaterial.lightParamsList[i].z=n.attenuation,this.light2DShadowMaterial.lightParamsList[i].w=n.intensity,this.light2DShadowMaterial.lightColorList[i]=this.light2DShadowMaterial.lightColorList[i]||a.a.white,this.light2DShadowMaterial.lightColorList[i].set(n.lightColor),this.light2DShadowMaterial.shadowMapList[i]=n.getShadowMap(t,e)}this.light2DShadowMaterial.lightCount=r.length,this.light2DShadowMaterial.cameraParams.x=e.camera.position.x,this.light2DShadowMaterial.cameraParams.y=e.camera.position.y,this.light2DShadowMaterial.cameraParams.z=2*e.camera.viewHeight*e.camera.aspectRatio,this.light2DShadowMaterial.cameraParams.w=2*e.camera.viewHeight,m.b.mul(this.light2DShadowMaterial.ambientLightColor,this.settings.ambientLightColor,this.settings.ambientIntensity),t.renderer.blit(null,this.lightmap,this.light2DShadowMaterial)}}class R extends(Object(b.b)(new v.e(...x.ShaderSource.light2D,{blend:[v.a.One,v.a.Zero],depth:v.d.Disable,zWrite:!1}))){constructor(){super(...arguments),this.lightPosList=[],this.lightColorList=[],this.lightParamsList=[],this.shadowMapList=[],this.lightCount=0,this.cameraParams=m.b.zero(),this.ambientLightColor=a.a.white}}M([Object(b.e)("uLightPosList","vec4[]")],R.prototype,"lightPosList",void 0),M([Object(b.e)("uLightColorList","color[]")],R.prototype,"lightColorList",void 0),M([Object(b.e)("uLightParamsList","vec4[]")],R.prototype,"lightParamsList",void 0),M([Object(b.e)("uShadowMapList","tex2d[]")],R.prototype,"shadowMapList",void 0),M([Object(b.e)("uLightCount","int")],R.prototype,"lightCount",void 0),M([Object(b.e)("uCameraParams","vec4")],R.prototype,"cameraParams",void 0),M([Object(b.e)("uAmbientLightColor","color")],R.prototype,"ambientLightColor",void 0);class T extends(Object(b.b)(new v.e(...x.ShaderSource.blitCopy,{blend:[v.a.DstColor,v.a.Zero],depth:v.d.Disable,zWrite:!1}))){}const _=Object(g.e)({lightPos:"vec3",lightParams:"vec4",lightColor:"vec4"});class A extends(Object(b.b)(new v.e(...x.ShaderSource.light2DSimple,{vertexStructure:Object.assign(Object.assign({},g.a),_),attributes:{lightPos:"aLightPos",lightColor:"aLightColor",lightParams:"aLightParams"},blend:[v.a.One,v.a.One]}))){}class E extends w.a{constructor(t,e){super(),this.renderOrder=t,this.filter=e}render(t,e){e.camera;t.renderer.setFramebuffer(e.cameraOutput);const r=e.getVisibleObjects(this.renderOrder,this.filter);for(const i of r)i.render(t,e)}}var S=r(38);class j extends w.a{constructor(t,e){super(),this.tempRT=new d.c(t.screen.width,t.screen.height,!1,e)}render(t,e){var r,i;e.cameraOutput.size.equals(this.tempRT.size)||this.tempRT.resize(e.cameraOutput.width,e.cameraOutput.height);const s=e.camera;if(e.postprocessOutput)t.renderer.blit(e.postprocessOutput,null!==(r=s.output)&&void 0!==r?r:u.a.CanvasBuffer);else{if(e.cameraOutput===u.a.CanvasBuffer)return;e.cameraOutput instanceof u.a&&(e.cameraOutput.colorAttachments[0]instanceof n.b?s.output instanceof d.c?t.renderer.blitCopy(e.cameraOutput.colorAttachments[0],s.output):(t.renderer.blitCopy(e.cameraOutput.colorAttachments[0],this.tempRT),t.renderer.blit(this.tempRT,u.a.CanvasBuffer)):e.cameraOutput.colorAttachments[0]instanceof d.c&&t.renderer.blit(e.cameraOutput.colorAttachments[0],null!==(i=s.output)&&void 0!==i?i:u.a.CanvasBuffer))}}}class P extends w.a{render(t,e){const r=e.camera;t.renderer.setFramebuffer(e.cameraOutput),t.renderer.clear(r.clearColor,r.clearDepth)}}class z{constructor(){this.msaa=4,this.renderFormat=i.a.RGBA8,this.debuglayer=new h.a,this.ambientLightColor=new a.a(1,1,1,1),this.ambientIntensity=1,this.perCameraResources=new Map,Object(c.a)(this.debuglayer)}render(t,e,r){for(const i of r){const r=this.getCameraResources(t,i),n=o.a.create(i,e,r.outputFBO);this.renderCamera(t,n)}}replaceMaterial(t,e){throw new Error("Method not implemented.")}renderCamera(t,e){const r=e.camera;r.__preRender(t),t.renderer.setViewProjection(r.worldToLocalMatrix,r.projectionMatrix);const i=this.getCameraResources(t,r);for(const r of i.renderPass)r.setup(t,e),r.render(t,e);for(const r of i.renderPass)r.cleanup(t,e);this.debuglayer.render(t,e),r.__postRender(t)}getCameraResources(t,e){let r=this.perCameraResources.get(e);if(!r){const i=new u.a(t.renderer.canvas.width,t.renderer.canvas.height),s=new n.b(i.width,i.height,this.renderFormat,this.msaa);i.addColorAttachment(s),r={outputFBO:i,outputBuffer:s,renderPass:this.createRenderPass(t,e)},this.perCameraResources.set(e,r)}const i=null===e.output?Object(s.b)(t.screen.width,t.screen.height):e.output.size;if(!i.equals(r.outputFBO.size)){console.log("resize",r.outputFBO.size,i);const t=r.outputFBO.colorAttachments[0].resize(i.x,i.y);r.outputFBO.reset(i.x,i.y),r.outputFBO.addColorAttachment(t,0)}return r}createRenderPass(t,e){return[new P,new E(o.b.FarToNear),new O(t,this),new S.b(t,this.renderFormat),new j(t,this.renderFormat)]}}},,function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var i=r(11),n=r(21),s=r(6);class o{constructor(t,e,r){this.color=i.a.white,this.texture=t,this.uvRect=new n.a(Object(s.f)(r,e),Object(s.f)(1,e))}}},,,,function(t,e){var r,i,n=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var u,h=[],c=!1,l=-1;function d(){c&&u&&(c=!1,u.length?h=u.concat(h):l=-1,h.length&&f())}function f(){if(!c){var t=a(d);c=!0;for(var e=h.length;e;){for(u=h,h=[];++l<e;)u&&u[l].run();l=-1,e=h.length}u=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new m(t,e)),1!==h.length||c||a(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(0),n=r(6);class s{constructor(){this.gravity=i.b.zero(),this.colliderList=[]}__addCollider(t){(t=t).__colliderIdx=this.colliderList.push(t)-1}__removeCollider(t){const e=t;if(e.__colliderIdx>=0){if(this.colliderList.length>1){const t=this.colliderList[this.colliderList.length-1];t.__colliderIdx=e.__colliderIdx,this.colliderList[e.__colliderIdx]=t}this.colliderList.length--}}__getColliders(){return this.colliderList}update(t){var e,r,s,o,a;this.updateMotion(t);for(let t=0;t<this.colliderList.length;t++){const u=this.colliderList[t];for(let h=t+1;h<this.colliderList.length;h++){if(t===h)continue;const c=this.colliderList[h];if(!u.checkContact(c))continue;if(u.__eventEmitter.emit("onContact",c),c.__eventEmitter.emit("onContact",u),!u.rigidbody&&!c.rigidbody)continue;const[l,d]=c.rigidbody?[u,c]:[c,u],f=Object(n.h)(null!==(r=null===(e=d.rigidbody)||void 0===e?void 0:e._motion)&&void 0!==r?r:i.b.zero(),null!==(o=null===(s=l.rigidbody)||void 0===s?void 0:s._motion)&&void 0!==o?o:i.b.zero()),m=l.checkCollision(d,f);if(m){if(l.rigidbody&&d.rigidbody){console.warn("Collision between two rigidbody is not implement");continue}null===(a=d.entity)||void 0===a||a.translate(m.seperation.toVec3()),l.__eventEmitter.emit("onCollide",m),m.self=d,m.other=l,d.__eventEmitter.emit("onCollide",m)}}}}updateMotion(t){var e;const r=this.gravity,i=0!==r.x&&0!==r.y;for(let s=0;s<this.colliderList.length;s++){const o=this.colliderList[s].rigidbody;if(!o)continue;i&&o.addAcceleration(r),o._velocity.x+=o._acceleration.x*t.deltaTime,o._velocity.y+=o._acceleration.y*t.deltaTime;const a=Object(n.i)(o._velocity,t.deltaTime);null===(e=o.collider.entity)||void 0===e||e.translate(a.toVec3()),o._motion=a}}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var i=r(12),n=r(3),s=r(14);const o={tex2d:{import:(t,e,r=Object(n.d)())=>new Promise((n,o)=>{const a=new Blob([t]),u=new Image;u.src=URL.createObjectURL(a);const h=()=>{const t={width:u.width,height:u.height,filterMode:i.b.Linear,format:s.a.RGBA,mipmap:!0,wrapMpde:i.g.Repeat},o=Object.assign(Object.assign({},t),e),a=new i.e(o.width,o.height,o.format,o.filterMode,r);a.autoMipmap=o.mipmap,a.wrapMode=o.wrapMpde,a.updateParameters(),a.setData(u),n(a)};u.complete?h():u.onload=h})}},a=new(r(51).a)(o)},function(t,e,r){"use strict";r.d(e,"a",(function(){return f}));var i=r(8),n=r(7),s=r(12),o=r(14),a=r(19),u=r(54),h=r(38),c=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};class l extends(Object(i.b)(new n.e(...a.ShaderSource.bloomFilter,{depth:n.d.Disable,zWrite:!1}))){constructor(){super(...arguments),this.texture=null,this.threshold=1,this.softThreshold=.5}}c([Object(i.e)("uMainTex","tex2d")],l.prototype,"texture",void 0),c([Object(i.e)("uThreshold","float")],l.prototype,"threshold",void 0),c([Object(i.e)("uSoftThreshold","float")],l.prototype,"softThreshold",void 0);class d extends(Object(i.b)(new n.e(...a.ShaderSource.bloomCompose,{blendRGB:[n.a.One,n.a.One],blendAlpha:[n.a.Zero,n.a.One],depth:n.d.Disable,zWrite:!1}))){constructor(){super(...arguments),this.intensity=1}}c([Object(i.e)("uIntensity","float")],d.prototype,"intensity",void 0);class f extends h.a{constructor(){super(...arguments),this.intensity=1,this.blurSteps=4,this.threshold=1,this.softThreshold=.25,this.materialFilter=new l,this.materialCompose=new d,this.blurRenderer=new u.a,this.filterOutput=null}create(t){this.filterOutput=new s.c(t.renderer.canvasSize.x,t.renderer.canvasSize.y,!1,o.a.RGBA16F),this.blurRenderer.upsampleMaterial.setPipelineStateOverride({blend:[n.a.One,n.a.One]})}render(t,e,r){e.size.equals(this.filterOutput.size)||this.filterOutput.resize(e.width,e.height,s.f.Discard),t.renderer.blit(e,this.filterOutput,this.materialFilter);const i=this.blurRenderer.blur(this.filterOutput,this.blurSteps);this.materialCompose.intensity=this.intensity,t.renderer.blit(e,r),t.renderer.blit(i,r,this.materialCompose)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return u}));var i=r(16),n=r(9),s=r(0),o=r(6),a=r(27);class u extends a.a{constructor(){super(...arguments),this.mesh=new i.c,this.dirty=!1,this.points=[]}updateMesh(){this.dirty=!0}render(t,e){this.rebuildMesh(),t.renderer.drawMesh(this.mesh,n.b.identity(),this.materials[0])}rebuildMesh(){if(!this.dirty)return;const t=this.points.length-1;t<1&&this.mesh.resize(this.mesh.vertices.length,0),this.mesh.resize(4*t,6*t,!1);const e=s.b.zero(),r=s.b.zero(),i=s.b.zero(),n=s.b.zero(),o=s.b.zero(),a=s.b.zero();for(let t=0;t<this.points.length-1;t++){const u=this.points[t],c=this.points[t+1];if(s.b.minus(e,c.position,u.position),e.normalize(),e.isZero)continue;s.b.perpendicular(r,e),t>0?h([i,n],this.points[t-1],this.points[t],this.points[t+1]):(i.set(r).mul(u.width/2).plus(u.position),n.set(r).mul(-u.width/2).plus(u.position)),t<this.points.length-2?h([o,a],this.points[t],this.points[t+1],this.points[t+2]):(o.set(r).mul(c.width/2).plus(c.position),a.set(r).mul(-c.width/2).plus(c.position));const l=4*t;this.mesh.vertices[l+0].vert.set(i),this.mesh.vertices[l+1].vert.set(n),this.mesh.vertices[l+2].vert.set(o),this.mesh.vertices[l+3].vert.set(a),this.mesh.vertices[l+0].color.set(u.color),this.mesh.vertices[l+1].color.set(u.color),this.mesh.vertices[l+2].color.set(c.color),this.mesh.vertices[l+3].color.set(c.color),this.mesh.vertices[l+0].uv.set([0,1]),this.mesh.vertices[l+1].uv.set([0,0]),this.mesh.vertices[l+2].uv.set([1,1]),this.mesh.vertices[l+3].uv.set([1,0]);const d=6*t;this.mesh.indices[d+0]=l+0,this.mesh.indices[d+1]=l+1,this.mesh.indices[d+2]=l+3,this.mesh.indices[d+3]=l+0,this.mesh.indices[d+4]=l+3,this.mesh.indices[d+5]=l+2}this.dirty=!1}destroy(){this.destroyed||(super.destroy(),this.mesh.destroy())}}function h(t,e,r,i){const[n,a]=t;s.b.minus(n,e.position,r.position).normalize(),s.b.minus(a,i.position,r.position).normalize();const u=Object(o.j)(n,a).div(2);let h=0;s.b.dot(u,u)<=1e-7||n.isZero?(s.b.perpendicular(u,a),h=1):a.isZero?(s.b.perpendicular(u,n),h=-1):(u.normalize(),h=Math.sign(s.b.cross(a,n))*Math.sqrt((1-Object(o.g)(n,a))/2));const c=r.width/2/h,l=n.set(u).mul(c).plus(r.position),d=a.set(u).mul(-c).plus(r.position);return(isNaN(l.x)||isNaN(l.y)||isNaN(d.x)||isNaN(d.y))&&console.log(l,d),[l,d]}},function(t,e,r){"use strict";r.d(e,"c",(function(){return n})),r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return a}));var i=r(2);function n(t){const e=Object.keys(t.frames).map(t=>({key:t,time:parseFloat(t)})).sort((t,e)=>t.time-e.time),r={loop:t.loop||!1,duration:t.duration,frames:[],updater:t.updater};for(const i of e)r.frames.push({time:i.time,values:t.frames[i.key]});return r}class s{constructor(t,e,r){this.frameTime=0,this.time=0,this.timeScale=1,this.target=void 0,this.updater=void 0,this.state="stopped",this.currentFrame={},this.frameTime=0,this.timeline=t,this.loop=t.loop,this.duration=t.duration,this.target=e,this.updater=r,!this.updater&&e&&t.updater&&(this.updater=r=>{t.updater(r.frame,e)})}get playing(){return"playing"===this.state||"pending"===this.state}get finished(){return"stopped"===this.state}play(t=0){return new Promise((e,r)=>{this.resolver=e,this.rejector=r,this.frameTime=t,this.frameTime=t,this.state="pending",this.timeline&&this.timeline.frames.length>0&&Object.assign(this.currentFrame,this.timeline.frames[0].values)})}stop(){this.state="stopped"}update(t){switch(this.state){case"stopped":return;case"pending":this.state="playing",this.checkEnd(),this.updateAnimation(t);break;case"playing":this.time+=t*this.timeScale,this.checkEnd(),this.updateAnimation(t)}}reject(){var t;null===(t=this.rejector)||void 0===t||t.call(this)}updateAnimation(t){this.updater&&(this.loop?this.frameTime=this.time%this.timeline.duration:this.frameTime=this.time,this.updateFrame(),this.updater({deltaTime:t,frame:this.currentFrame,animator:this,target:this.target,time:this.time,frameTime:this.frameTime,progress:this.frameTime/this.duration}))}updateFrame(){if(this.timeline&&this.timeline.frames.length>0){for(let t=0;t<this.timeline.frames.length;t++)if(this.timeline.frames[t].time>=this.frameTime)return 0===t||this.timeline.frames[t].time===this.frameTime?Object.assign(this.currentFrame,this.timeline.frames[t].values):this.interpolate(this.currentFrame,this.timeline.frames[t-1],this.timeline.frames[t]),this.currentFrame;this.loop?this.interpolate(this.currentFrame,this.timeline.frames[this.timeline.frames.length-1],this.timeline.frames[0]):Object.assign(this.currentFrame,this.timeline.frames[this.timeline.frames.length-1].values)}}interpolate(t,e,r){let n=(this.frameTime-e.time)/(r.time-e.time);r.time<e.time&&(n=(this.frameTime-e.time)/(this.timeline.duration+r.time-e.time));for(const s in e.values)t[s]=e.values[s],"number"==typeof e.values[s]&&"number"==typeof r.values[s]&&(t[s]=i.a.lerp(e.values[s],r.values[s],n));return t}checkEnd(){var t;this.time>=this.duration&&(this.time=this.duration,this.state="stopped",null===(t=this.resolver)||void 0===t||t.call(this,this))}}class o{constructor(t,e){this.currentTime=0,this.state="stopped",this.totalTime=t,this.updater=e}get finished(){return"stopped"===this.state}play(){return new Promise((t,e)=>{this.rejector=e,this.resolver=t,"stopped"===this.state&&(this.state="pending")})}stop(){this.resolver=void 0,this.state="stopped"}update(t){var e;switch(this.state){case"stopped":return;case"pending":this.state="playing";case"playing":this.currentTime+=t,this.checkEnd(),null===(e=this.updater)||void 0===e||e.call(this,this.currentTime/this.totalTime,t)}}reject(){var t;null===(t=this.rejector)||void 0===t||t.call(this)}checkEnd(){var t;this.currentTime>=this.totalTime&&(this.currentTime=this.totalTime,this.state="stopped",null===(t=this.resolver)||void 0===t||t.call(this))}}class a{constructor(t){this.tracks=[],this.defaultTarget=t}playOn(t,e,r=this.defaultTarget,i=e.duration,n){const o=new s(e,r,n);o.duration=i;const a=o.play();return this.tracks[t]&&this.tracks[t].reject(),this.tracks[t]=o,a}play(t,e=this.defaultTarget,r=t.duration,i){return this.playOn(this.tracks.length,t,e,r,i)}playProceduralOn(t,e,r,i=0){const n=new o(e,r);n.currentTime=i;const s=n.play();return this.tracks[t]&&this.tracks[t].reject(),this.tracks[t]=n,s}playProcedural(t,e,r=0){return this.playProceduralOn(this.tracks.length,t,e)}wait(t,e){const r=new o(t),i=r.play();this.tracks.push(r),i.then(e)}update(t){for(let e=0;e<this.tracks.length;e++){const r=this.tracks[e];r&&(r.update(t),r.finished&&(this.tracks[e]=void 0))}}clear(){for(const t of this.tracks)null==t||t.reject();this.tracks.length=0}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));var i=r(0),n=r(24),s=r(11),o=r(13),a=r(27),u=r(49);const h=[Object(i.b)(-.5,-.5),Object(i.b)(.5,-.5),Object(i.b)(.5,.5),Object(i.b)(-.5,.5)];class c extends a.a{constructor(){super(),this.mesh=n.a.quad(),this.material=u.a.spriteDefault,this._sprite=null,this._size=i.b.one(),this._color=s.a.white,this.meshes[0]=this.mesh,this.materials[0]=this.material}get size(){return this._size}set size(t){this._size.set(t),i.b.mul(this.mesh.vertices[0].vert,h[0],this._size),i.b.mul(this.mesh.vertices[1].vert,h[1],this._size),i.b.mul(this.mesh.vertices[2].vert,h[2],this._size),i.b.mul(this.mesh.vertices[3].vert,h[3],this._size),this.mesh.update()}get color(){return this._color}set color(t){this._color.set(t),this.sprite?(o.b.mul(this.mesh.vertices[0].color,this.sprite.color,t),o.b.mul(this.mesh.vertices[1].color,this.sprite.color,t),o.b.mul(this.mesh.vertices[2].color,this.sprite.color,t),o.b.mul(this.mesh.vertices[3].color,this.sprite.color,t)):(o.b.set(this.mesh.vertices[0].color,t),o.b.set(this.mesh.vertices[1].color,t),o.b.set(this.mesh.vertices[2].color,t),o.b.set(this.mesh.vertices[3].color,t)),this.mesh.update()}get sprite(){return this._sprite}set sprite(t){this._sprite=t,t?(this.mesh.vertices[0].uv.set([t.uvRect.xMin,t.uvRect.yMin]),this.mesh.vertices[1].uv.set([t.uvRect.xMax,t.uvRect.yMin]),this.mesh.vertices[2].uv.set([t.uvRect.xMax,t.uvRect.yMax]),this.mesh.vertices[3].uv.set([t.uvRect.xMin,t.uvRect.yMax]),this.mesh.vertices[0].color.set(t.color),this.mesh.vertices[1].color.set(t.color),this.mesh.vertices[2].color.set(t.color),this.mesh.vertices[3].color.set(t.color),this.mesh.update()):this.material.texture=null}render(t,e){var r;this.material.setProp("uMainTex","tex2d",(null===(r=this.sprite)||void 0===r?void 0:r.texture)||null),t.renderer.drawMesh(this.mesh,this.localToWorldMatrix,this.material)}destroy(){this.destroyed||(super.destroy(),this.mesh.destroy())}}},function(t,e,r){!function(t){function e(t){function e(t,e,r){this.x=t,this.y=e,this.z=r}e.prototype.dot2=function(t,e){return this.x*t+this.y*e},e.prototype.dot3=function(t,e,r){return this.x*t+this.y*e+this.z*r},this.grad3=[new e(1,1,0),new e(-1,1,0),new e(1,-1,0),new e(-1,-1,0),new e(1,0,1),new e(-1,0,1),new e(1,0,-1),new e(-1,0,-1),new e(0,1,1),new e(0,-1,1),new e(0,1,-1),new e(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(t||0)}e.prototype.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=this.p,r=0;r<256;r++){var i;i=1&r?e[r]^255&t:e[r]^t>>8&255;var n=this.perm,s=this.gradP;n[r]=n[r+256]=i,s[r]=s[r+256]=this.grad3[i%12]}};var r=.5*(Math.sqrt(3)-1),i=(3-Math.sqrt(3))/6,n=1/6;function s(t){return t*t*t*(t*(6*t-15)+10)}function o(t,e,r){return(1-r)*t+r*e}e.prototype.simplex2=function(t,e){var n,s,o=(t+e)*r,a=Math.floor(t+o),u=Math.floor(e+o),h=(a+u)*i,c=t-a+h,l=e-u+h;c>l?(n=1,s=0):(n=0,s=1);var d=c-n+i,f=l-s+i,m=c-1+2*i,p=l-1+2*i;a&=255,u&=255;var b=this.perm,v=this.gradP,g=v[a+b[u]],y=v[a+n+b[u+s]],x=v[a+1+b[u+1]],w=.5-c*c-l*l,M=.5-d*d-f*f,O=.5-m*m-p*p;return 70*((w<0?0:(w*=w)*w*g.dot2(c,l))+(M<0?0:(M*=M)*M*y.dot2(d,f))+(O<0?0:(O*=O)*O*x.dot2(m,p)))},e.prototype.simplex3=function(t,e,r){var i,s,o,a,u,h,c=(t+e+r)*(1/3),l=Math.floor(t+c),d=Math.floor(e+c),f=Math.floor(r+c),m=(l+d+f)*n,p=t-l+m,b=e-d+m,v=r-f+m;p>=b?b>=v?(i=1,s=0,o=0,a=1,u=1,h=0):p>=v?(i=1,s=0,o=0,a=1,u=0,h=1):(i=0,s=0,o=1,a=1,u=0,h=1):b<v?(i=0,s=0,o=1,a=0,u=1,h=1):p<v?(i=0,s=1,o=0,a=0,u=1,h=1):(i=0,s=1,o=0,a=1,u=1,h=0);var g=p-i+n,y=b-s+n,x=v-o+n,w=p-a+2*n,M=b-u+2*n,O=v-h+2*n,R=p-1+.5,T=b-1+.5,_=v-1+.5;l&=255,d&=255,f&=255;var A=this.perm,E=this.gradP,S=E[l+A[d+A[f]]],j=E[l+i+A[d+s+A[f+o]]],P=E[l+a+A[d+u+A[f+h]]],z=E[l+1+A[d+1+A[f+1]]],F=.5-p*p-b*b-v*v,C=.5-g*g-y*y-x*x,L=.5-w*w-M*M-O*O,D=.5-R*R-T*T-_*_;return 32*((F<0?0:(F*=F)*F*S.dot3(p,b,v))+(C<0?0:(C*=C)*C*j.dot3(g,y,x))+(L<0?0:(L*=L)*L*P.dot3(w,M,O))+(D<0?0:(D*=D)*D*z.dot3(R,T,_)))},e.prototype.perlin2=function(t,e){var r=Math.floor(t),i=Math.floor(e);t-=r,e-=i,r&=255,i&=255;var n=this.perm,a=this.gradP,u=a[r+n[i]].dot2(t,e),h=a[r+n[i+1]].dot2(t,e-1),c=a[r+1+n[i]].dot2(t-1,e),l=a[r+1+n[i+1]].dot2(t-1,e-1),d=s(t);return o(o(u,c,d),o(h,l,d),s(e))},e.prototype.perlin3=function(t,e,r){var i=Math.floor(t),n=Math.floor(e),a=Math.floor(r);t-=i,e-=n,r-=a,i&=255,n&=255,a&=255;var u=this.perm,h=this.gradP,c=h[i+u[n+u[a]]].dot3(t,e,r),l=h[i+u[n+u[a+1]]].dot3(t,e,r-1),d=h[i+u[n+1+u[a]]].dot3(t,e-1,r),f=h[i+u[n+1+u[a+1]]].dot3(t,e-1,r-1),m=h[i+1+u[n+u[a]]].dot3(t-1,e,r),p=h[i+1+u[n+u[a+1]]].dot3(t-1,e,r-1),b=h[i+1+u[n+1+u[a]]].dot3(t-1,e-1,r),v=h[i+1+u[n+1+u[a+1]]].dot3(t-1,e-1,r-1),g=s(t),y=s(e),x=s(r);return o(o(o(c,m,g),o(l,p,g),x),o(o(d,b,g),o(f,v,g),x),y)},t.Noise=e}(t.exports)},,,,,,function(t,e,r){"use strict";e.a=r.p+"static/img/checkboard.png"},,,,,,,,,,,,,,,,,function(t,e,r){"use strict";r.r(e),r.d(e,"SnakeGame",(function(){return ut}));var i=r(78),n=r.n(i),s=r(37),o=r(28),a=r(62),u=r(64),h=r(14),c=r(31),l=r(48),d=r(72),f=r(1),m=r(34),p=r(74),b=r(0),v=r(5),g=r(66),y=r(73),x=r(11),w=r.p+"static/img/snake-food.png",M=r.p+"static/img/snake-food-boost.png";let O={};var R=r(9),T=r(21);function _(t,e){return r=>{let i=0,n=1,s=.5;for(let o=0;o<t;o++)n*=.5,s*=2,i+=n*e(r*s);return i/=1-n,i}}const A=new n.a.Noise,E=-Math.log(.01);class S extends m.a{constructor(){super(...arguments),this.followOffset=b.b.zero(),this.followStart=b.b.zero(),this.deadZoneOffset=b.b.zero(),this.deadZoneSize=Object(b.b)(.5,.5),this.damping=Object(b.b)(5,5),this.shake=0,this.shakeOctave=1,this.shakeAmplitude=1,this.shakeMatrix=R.b.identity(),this.shakeInverse=R.b.identity(),this.shakedLocalToWorld=R.b.identity(),this.shakedWorldToLocal=R.b.identity()}get followTarget(){return this._followTarget}set followTarget(t){this._followTarget=t}get worldToLocalMatrix(){return R.b.mul(this.shakedWorldToLocal,this.shakeInverse,super.worldToLocalMatrix)}get localToWorldMatrix(){return R.b.mul(this.shakedLocalToWorld,super.localToWorldMatrix,this.shakeMatrix)}update(t){this.followTarget&&this.followTarget.scene&&this.updateFollow(this.followTarget,t),this.updateShaking(t)}updateFollow(t,e){const r=R.b.mulPoint2(super.worldToLocalMatrix,t.position),i=b.b.div(r,Object(b.b)(this.viewHeight*this.aspectRatio,this.viewHeight)).minus(this.followOffset).minus(this.followStart),n=new T.a(b.b.minus(this.deadZoneOffset,this.deadZoneSize),b.b.mul(this.deadZoneSize,2));i.x>0?i.x=i.x/(n.xMax-this.followStart.x):i.x=i.x/(n.xMin+this.followStart.x),i.y>0?i.y=i.y/(n.yMax-this.followStart.y):i.y=i.y/(n.yMin+this.followStart.x),i.x>1||i.x<0?i.x=1:(i.y>1||i.y<0)&&(i.y=1);const s=Object(b.b)(E).div(this.damping).mul(e.deltaTime).mul(i).negate(),o=b.b.exp(s).oneMinus().mul(r);this.translate(o.toVec3(0))}updateShaking(t){if(this.shake>0){const e=_(this.shakeOctave,t=>A.perlin2(t,0)),r=_(this.shakeOctave,t=>A.perlin2(0,t)),i=Object(f.b)(e(t.time*this.shake)*this.shakeAmplitude,r(t.time*this.shake)*this.shakeAmplitude,0);R.b.fromTranslation(this.shakeMatrix,i),i.negate(),R.b.fromTranslation(this.shakeInverse,i)}}}var j=r(44),P=r(30),z=r(84);let F=new n.a.Noise;class C extends j.a{constructor(t,e){super(t,e),this.foodCount=0;for(let t=0;t<e;t++)for(let r=0;r<e;r++)this.genMap(t,r)}genMap(t,e){let r=1/8;const i=F.perlin2.bind(F);let n=0;for(let s=0;s<3;s++)n+=i((t+this.basePos.x)*r,(e+this.basePos.y)*r)*Math.pow(.5,s+1),r*=2;n>.05?this.setTile(Object(b.b)(t,e),L.tileWall):this.setTile(Object(b.b)(t,e),L.tileGround)}}class L extends j.b{constructor(t){F=new n.a.Noise(t),super(C),L.instance=this,this.collider=new P.a}static async loadMapAssets(){const t=await y.a.url(z.a).then(t=>t.tex2d());L.tileGround.sprite=new g.a(t,Object(b.b)(4),Object(b.b)(0,0)),L.tileGround.sprite.color=x.a.fromString("#eeeeee"),L.tileWall.sprite=new g.a(t,Object(b.b)(4),Object(b.b)(0,1)),L.tileWall.sprite.color=x.a.fromString("#cccccc"),L.tileSnake.sprite=new g.a(t,Object(b.b)(4),Object(b.b)(0,2)),L.tileSnake.sprite.color=x.a.fromString("#eeeeee"),L.tileFood.sprite=new g.a(t,Object(b.b)(4),Object(b.b)(0,3)),L.tileFood.sprite.color=x.a.fromString("#eeeeee")}}L.instance=null,L.tileGround={sprite:null,collide:!1,name:"ground"},L.tileWall={sprite:null,collide:!0,name:"wall"},L.tileSnake={sprite:null,collide:!1,name:"snake"},L.tileFood={sprite:null,collide:!1,name:"food"};var D=r(75),B=r(43),I=r(33),k=r(76),U=r(40),G=r(25),N=r(2),V=r(6),W=r(13);class q extends G.a{constructor(){super(),this.animator=new k.b,this.light=new I.a,this.light.lightColor=new x.a(-1,-1,-1,1),this.light.lightRange=0,this.light.volumnRadius=0,this.light.attenuation=0,this.light.intensity=0,this.light.shadowType=!1,this.particle=new B.b,this.particle.maxCount=32,this.particle.startSpeed=[-1,-1.6],this.particle.startAcceleration={x:0,y:0,z:0},this.particle.startColor=x.a.black,this.particle.lifetime=.3,this.particle.lifeSize=[.2,.05],this.particle.spawnRate=0,this.particle.emitter=B.b.circleEmitter(1);(new U.a).size=Object(b.b)(.1),this.collider=new U.a}async start(){var t,e;null===(t=this.scene)||void 0===t||t.add(this.light,this),null===(e=this.scene)||void 0===e||e.add(this.particle,this),this.light.localPosition=f.b.zero(),this.particle.localPosition=f.b.zero(),this.particle.play(),await this.animator.play(q.timelineSpawn,this,15,t=>{this.light.lightRange=.3*t.frame.size,this.light.intensity=t.frame.intensity,this.particle.spawnRate=t.frame.rate}),await this.animator.play(q.timelineExit,this,2,t=>{this.light.lightRange=.3*t.frame.size,this.light.intensity=t.frame.intensity,this.particle.spawnRate=t.frame.rate}),this.destroy()}update(t){this.animator.update(t.deltaTime)}}q.timelineSpawn=Object(k.c)({duration:2,frames:{0:{size:0,intensity:0,rate:0},.5:{size:.5,intensity:.5,rate:5},1:{size:1,intensity:1,rate:10},2:{size:1,intensity:1,rate:30}}}),q.timelineExit=Object(k.c)({duration:2,frames:{0:{size:1,intensity:1,rate:30},.5:{size:1,intensity:1,rate:5},1:{size:0,intensity:0,rate:0}}});var H=r(77);const K=Object(k.c)({loop:!0,duration:1,frames:{0:{opacity:1},.5:{opacity:1},.8:{opacity:0}},updater:(t,e)=>{const r=e.color.asMut();r.a=t.opacity,e.color=r}}),Y=Object(k.c)({duration:.2,frames:{0:{size:1,opacity:1},1:{size:0,opacity:0}},updater:(t,e)=>{e.localScaling=Object(f.b)(t.size);const r=e.color.asMut();r.a=t.opacity,e.color=r}}),X=Object(k.c)({duration:.5,frames:{0:{size:0},.5:{size:1}},updater:(t,e)=>{e.localScaling=Object(f.b)(t.size)}});class Q extends H.a{constructor(t){super(),this.foodSize=.5,this.animator=new k.b,this.sprite=O.foodSprite,this.position=t.toVec3(1),this.localScaling=Object(f.b)(this.foodSize);const e=new U.a;e.size=Object(b.b)(this.foodSize),this.collider=e,this.size=Object(b.b)(this.foodSize)}async start(){await this.animator.play(X,this,5),await this.animator.play(K,this,5),await this.animator.play(Y,this),this.destroy()}update(t){this.animator.update(t.deltaTime)}}class Z extends H.a{constructor(){super(),this.animator=new k.b(this),this.sprite=O.boostSprite;const t=new U.a;t.size=Object(b.b)(Z.size),this.collider=t}async start(){this.animator.play(Z.animBeat,this,Number.POSITIVE_INFINITY),await this.animator.play(X,this,5),await this.animator.play(K,this,5),await this.animator.play(Y,this),this.destroy()}update(t){this.animator.update(t.deltaTime)}}Z.size=.6,Z.animBeat=Object(k.c)({duration:.375,loop:!0,frames:{0:{size:1},.05:{size:.7},.375:{size:1}},updater:(t,e)=>{e.size=Object(b.b)(Z.size*t.size)}});const{Noise:$}=n.a;class J extends G.a{constructor(){super(),this.foodSize=.3,this.lights=[],this.noise=new $(Math.random()),this.animator=new k.b,this.shakeRange=0,this.color=x.a.fromHSL(360*Math.random(),1,.5);(new U.a).size=Object(b.b)(this.foodSize),this.collider=new U.a}async start(){var t;for(let e=0;e<3;e++)this.lights[e]=new I.a,this.lights[e].lightRange=N.a.lerp(.1,.2,Math.random()),this.lights[e].volumnRadius=0,this.lights[e].shadowType=!1,this.lights[e].intensity=0,this.lights[e].attenuation=.9,this.lights[e].lightColor=this.color,null===(t=this.scene)||void 0===t||t.add(this.lights[e],this);await this.animator.playProcedural(1,t=>{this.lights.forEach(e=>e.intensity=.4*t),this.shakeRange=.4*t}),await this.animator.playProcedural(10),await this.animator.playProcedural(1,t=>{this.lights.forEach(e=>e.intensity=.4*(1-t)),this.shakeRange=N.a.lerp(.4,1,t)}),this.destroy()}update(t){this.animator.update(t.deltaTime);for(let e=0;e<3;e++)this.lights[e].localPosition=Object(f.b)(this.noise.perlin2(e,1*t.time),this.noise.perlin2(1*t.time,e),0).mul(this.shakeRange)}}const tt=function(t){const e=t.reduce((t,e)=>t+e.weight,0);return r=>{let i=0;for(const n of t)if(i+=n.weight,r<i/e)return n.value;return t[t.length-1].value}}([{weight:3,value:(t,e)=>{var r;const i=new Q(e);return null===(r=t.snake.scene)||void 0===r||r.add(i),i}},{weight:.5,value:(t,e)=>{var r;L.instance.setTile(e,L.tileFood);const i=new J;return i.position=e.toVec3(),null===(r=t.snake.scene)||void 0===r||r.add(i),i}},{weight:.8,value:(t,e)=>{var r;L.instance.setTile(e,L.tileFood);const i=new Z;return i.position=e.toVec3(),null===(r=t.snake.scene)||void 0===r||r.add(i),i}},{weight:.3,value:(t,e)=>{var r;L.instance.setTile(e,L.tileFood);const i=new q;return i.position=e.toVec3(),null===(r=t.snake.scene)||void 0===r||r.add(i),i}}]);class et extends G.a{constructor(t){super(),this.spawnInterval=[1,2],this.spawnRadius=15,this.foodSize=.5,this.foodDistance=3,this.perChunkFoodLimit=12,this.foods=new Set,this.snake=t}start(){this.spawnFood()}update(){}spawnFood(){if(this.snake.isDead)return;const t=Math.round(N.a.lerp(1,3,Math.pow(Math.random(),2)));for(let e=0;e<t;e++)this.spawnOne();setTimeout(this.spawnFood.bind(this),1e3*N.a.lerp(...this.spawnInterval,Math.random()))}spawnOne(){const t=this.getSpawnPos(this.spawnRadius);if(t){const e=tt(Math.random())(this,t);e.on("exit",()=>{this.foods.delete(e),L.instance.getChunkAt(t).foodCount--}),L.instance.getChunkAt(t).foodCount++,this.foods.add(e)}}getSpawnPos(t){let e=b.b.zero();for(let r=0;r<32;r++){e=b.b.math(Math.floor)(b.b.math(Math.random)().minus(.5).mul(2).mul(t).plus(this.snake.head)).plus(.5);let r=!0;for(const t of this.foods)if(b.a.distance(t.position.toVec2(),e)<this.foodDistance){r=!1;break}if(r&&(!(L.instance.getChunkAt(e).foodCount>=this.perChunkFoodLimit)&&L.instance.getTile(e)===L.tileGround))return e}return null}}const rt=0,it=1,nt=2;class st extends D.a{constructor(t,e,r,i){super(),this.initialLightRange=15,this.initialLightIntensity=.4,this.initialAmbient=.2,this.maxLightIntensity=.6,this.intensityDropDamping=()=>160*Math.log(this.actualLength),this.lightRangeDropDamping=()=>50*Math.log(this.actualLength),this.ambientDropDamping=()=>10*Math.log(this.actualLength),this.speed=3,this.width=.6,this.inputCacheSize=3,this.step=1,this.color=x.a.white,this.headMoveDistance=0,this.tailMoveDistance=0,this.boostTimeout=-1,this.isDead=!1,this.bodies=[],this.headDir=b.b.right(),this.inputQueue=[],this.growingQueue=[],this.foodParticle=new B.b,this.deadParticle=new B.b,this.light=new I.a,this.animator=new k.b(this),this.currentLength=t.length,this.actualLength=t.length,this.color=new x.a(1.8,1.8,1.8,1),this.bodies=t,this.headDir=e,this.camera=r,r.position=this.head.toVec3(r.position.z),this.input=i,this.foodGenerator=new et(this);const n=new U.a;n.size=Object(b.b)(this.width),this.collider=n,n.on("onContact",this.onContact.bind(this)),this.headEntity=new G.a,this.foodParticle.maxCount=256,this.foodParticle.startColor=()=>new x.a(1,1,1,1).mul(N.a.lerp(1,3,Math.random())),this.foodParticle.startAcceleration={x:0,y:0,z:0},this.foodParticle.lifeSpeed=[10,0],this.foodParticle.lifetime=[.3,.4],this.foodParticle.lifeSize=[.3,0],this.deadParticle.maxCount=256,this.deadParticle.startColor=()=>new x.a(1,1,1,1).mul(N.a.lerp(2,5,Math.random())),this.deadParticle.startAcceleration={x:0,y:0,z:0},this.deadParticle.lifeSpeed=[3,0],this.deadParticle.lifetime=[.4,1],this.deadParticle.lifeSize=[.3,0],this.light.shadowType=I.d.Soft,this.light.lightRange=15,this.light.intensity=.4,this.light.lightColor=new x.a(1,1,1,1),this.light.volumnRadius=this.width/3,this.light.attenuation=-.8;for(const t of this.bodies)this.points.push({position:t.clone(),color:this.color,width:this.width});this.points.push({position:Object(V.i)(e,this.width/2).plus(this.head),color:this.color,width:this.width}),this.points[0].position=Object(V.i)(this.tailDir,-this.width/2).plus(this.tail),this.headEntity.position=b.b.mul(this.headDir,-this.width/2).plus(this.points[this.points.length-1].position).toVec3(0)}get ambientIntensity(){return ut.instance.engine.renderPipeline.ambientIntensity}set ambientIntensity(t){ut.instance.engine.renderPipeline.ambientIntensity=t}start(){var t,e,r,i,n;null===(t=this.scene)||void 0===t||t.add(this.foodGenerator),null===(e=this.scene)||void 0===e||e.add(this.foodParticle),null===(r=this.scene)||void 0===r||r.add(this.deadParticle),null===(i=this.scene)||void 0===i||i.add(this.headEntity),null===(n=this.scene)||void 0===n||n.add(this.light,this.headEntity)}update(t){this.animator.update(t.deltaTime),this.isDead||(this.decayLight(t),this.handleInput());let e=this.speed*t.deltaTime,r=this.speed*t.deltaTime,i=!1;if(this.growingQueue.length>0){i=!0;const n=this.growingQueue[0];e=n.headSpeed*this.speed*t.deltaTime,r=n.tailSpeed*this.speed*t.deltaTime;let s=e-r;if(Math.sign(n.length-(this.currentLength+s))!==Math.sign(s)){const i=Math.abs(n.length-this.currentLength)/Math.abs(s)*t.deltaTime;this.growingQueue=this.growingQueue.slice(1),this.growingQueue.length>0?(e=n.headSpeed*this.speed*i+(t.deltaTime-i)*this.growingQueue[0].headSpeed*this.speed,r=n.tailSpeed*this.speed*i+(t.deltaTime-i)*this.growingQueue[0].tailSpeed*this.speed):(e=n.headSpeed*this.speed*i+(t.deltaTime-i)*this.speed,r=n.tailSpeed*this.speed*i+(t.deltaTime-i)*this.speed)}}if(this.moveHead(e),this.moveTail(r),this.updateMesh(),!this.isDead){this.checkHitSelf();const r=e/t.deltaTime,i=N.a.mapClamped(0,6,7,13,r),n=r<=3.1?2:.5;this.camera.viewHeight=N.a.damp(this.camera.viewHeight,i,n,t.deltaTime),this.headEntity.position=b.b.mul(this.headDir,-this.width/2).plus(this.points[this.points.length-1].position).toVec3(0);this.collider.offset=this.headEntity.position.toVec2()}}moveHead(t){if(this.bodies.length<=0||this.points.length<=0)return;if(this.headMoveDistance+=t,this.currentLength+=t,this.headMoveDistance>=this.step){for(this.bodies.push(Object(V.i)(this.headDir,this.step).plus(this.head));this.inputQueue.length>0;){if(Object(V.g)(this.inputQueue[0],this.headDir)>=0){this.headDir=this.inputQueue[0],this.inputQueue=this.inputQueue.slice(1);break}this.inputQueue=this.inputQueue.slice(1)}let t=Object(V.j)(this.head,this.headDir);L.instance.getTile(t)===L.tileGround&&L.instance.setTile(Object(V.j)(this.head,this.headDir),L.tileSnake),this.points[this.points.length-1].position=this.head.clone(),this.points.push({position:Object(V.i)(this.headDir,this.width/2).plus(this.head),color:this.color,width:this.width}),this.headMoveDistance-=this.step}const e=this.points[this.points.length-1],r=Object(V.i)(this.headDir,this.width/2).plus(this.head);e.position.set(this.headDir).mul(this.headMoveDistance).plus(r)}moveTail(t){if(!(this.bodies.length<=0||this.points.length<=0))for(this.currentLength-=t;t>0;){if(this.tailMoveDistance+t>=this.step?(t-=this.step-this.tailMoveDistance,this.tailMoveDistance=this.step,L.instance.getTile(this.tail)===L.tileSnake&&L.instance.setTile(this.tail,L.tileGround),this.bodies=this.bodies.slice(1),this.points=this.points.slice(1),this.tailMoveDistance-=this.step):(this.tailMoveDistance+=t,t-=t),!this.tail)return;const e=this.points[0],r=Object(V.i)(this.tailDir,-this.width/2).plus(this.tail);e.position.set(this.tailDir).mul(this.tailMoveDistance).plus(r)}}onContact(t){if(!this.isDead)if(t.entity instanceof L)this.dead();else if(t.entity instanceof Q){this.foodParticle.emit(9,t.entity.position),t.entity.destroy();const e=N.a.lerp(this.light.lightRange,this.initialLightRange,.8);let r=N.a.lerp(this.light.intensity,this.maxLightIntensity,.5);r=Math.min(r,this.maxLightIntensity-this.ambientIntensity),this.animator.playProceduralOn(rt,2,t=>{this.light.lightRange=N.a.lerp(this.light.lightRange,e,t),this.light.intensity=N.a.lerp(this.light.intensity,r,t)})}else if(t.entity instanceof J){this.growTail(5,6);const e=t.entity,r=this.foodParticle.startColor;this.foodParticle.startColor=()=>W.b.mul(x.a.white,e.color,N.a.lerp(.3,2,Math.random())),this.foodParticle.emit(16,t.entity.position),this.foodParticle.startColor=r,t.entity.destroy();const i=this.initialLightRange,n=this.initialLightIntensity,s=this.initialAmbient,o=e.color.plus(this.light.lightColor).mul(.5);this.animator.playProceduralOn(rt,3,t=>{this.light.lightRange=N.a.lerp(this.light.lightRange,i,t),this.light.intensity=Math.min(this.maxLightIntensity-this.ambientIntensity,N.a.lerp(this.light.intensity,n,t)),this.light.lightColor=W.b.mathNonAlloc(N.a.lerp)(this.light.lightColor,this.light.lightColor,o,Object(W.b)(t)),this.ambientIntensity=N.a.lerp(this.ambientIntensity,s,t)})}else if(t.entity instanceof Z){this.boostTimeout>0&&clearTimeout(this.boostTimeout),this.foodParticle.emit(9,t.entity.position),t.entity.destroy();const e=Math.sqrt(this.speed**2+10);this.animator.playOn(nt,Object(k.c)({duration:10,frames:{0:{speed:this.speed},1:{speed:e},8:{speed:e},10:{speed:3}},updater:(t,e)=>{e.speed=t.speed}}),this),this.animator.playOn(it,Object(k.c)({duration:.9,frames:{0:{shake:5,amplitude:.6},.9:{shake:0,amplitude:0}},updater:(t,e)=>{e.shake=t.shake,e.shakeAmplitude=t.amplitude}}),this.camera)}else if(t.entity instanceof q){const e=1;this.growingQueue=[],this.enqueueGrowing({length:2,headSpeed:0,tailSpeed:(this.actualLength-2)/e/this.speed}),this.enqueueGrowing({length:this.actualLength,headSpeed:1,tailSpeed:0}),this.animator.playOn(it,Object(k.c)({duration:1.5,frames:{0:{shake:0,amplitude:0},.2:{shake:10,amplitude:.3},1:{shake:10,amplitude:.3},1.5:{shake:0,amplitude:0}},updater:(t,e)=>{e.shake=t.shake,e.shakeAmplitude=t.amplitude}}),this.camera);t.entity;const r=this.foodParticle.startColor;this.foodParticle.startColor=()=>x.a.black,this.foodParticle.emit(16,t.entity.position),this.foodParticle.startColor=r,t.entity.destroy();const i=.8*this.light.lightRange,n=.8*this.light.intensity,s=.2*this.ambientIntensity;this.animator.playProceduralOn(rt,2,t=>{this.light.lightRange=N.a.lerp(this.light.lightRange,i,t),this.light.intensity=N.a.lerp(this.light.intensity,n,t),this.ambientIntensity=N.a.lerp(this.ambientIntensity,s,t)})}}decayLight(t){this.light.intensity=N.a.damp(this.light.intensity,0,this.intensityDropDamping(),t.deltaTime),this.ambientIntensity=N.a.damp(this.ambientIntensity,0,this.ambientDropDamping(),t.deltaTime),this.light.lightRange=N.a.damp(this.light.lightRange,0,this.lightRangeDropDamping(),t.deltaTime)}handleInput(){(this.input.getKeyDown(c.c.A)||this.input.getKeyDown(c.c.Left))&&this.inputQueue.push(b.b.left()),(this.input.getKeyDown(c.c.D)||this.input.getKeyDown(c.c.Right))&&this.inputQueue.push(b.b.right()),(this.input.getKeyDown(c.c.W)||this.input.getKeyDown(c.c.Up))&&this.inputQueue.push(b.b.up()),(this.input.getKeyDown(c.c.S)||this.input.getKeyDown(c.c.Down))&&this.inputQueue.push(b.b.down()),this.inputQueue.length>this.inputCacheSize&&(this.inputQueue=this.inputQueue.slice(this.inputQueue.length-this.inputCacheSize))}checkHitSelf(){for(let t=0;t<this.bodies.length-1;t++)if(b.a.distance(this.points[this.points.length-1].position,this.bodies[t])<this.width/2)return void this.dead()}enqueueGrowing(t){this.growingQueue.push(t)}growTail(t,e){this.actualLength+=t,this.growingQueue.push({length:this.actualLength,headSpeed:1,tailSpeed:(e-t)/e})}reverse(){const t=this.tailDir.negate();this.bodies.push(Object(V.i)(this.headDir,this.step).plus(this.head)),this.bodies=this.bodies.slice(1),this.bodies=this.bodies.reverse(),this.points=this.points.reverse(),[this.headMoveDistance,this.tailMoveDistance]=[this.step-this.tailMoveDistance,this.step-this.headMoveDistance],this.headDir=t,this.updateMesh()}async dead(){this.isDead=!0,this.animator.playProceduralOn(rt,1,(t,e)=>{this.light.intensity=N.a.damp(this.light.intensity,this.initialLightIntensity,1,e),this.ambientIntensity=N.a.damp(this.ambientIntensity,this.initialAmbient,1,e)});const t=this.headEntity;this.headEntity=new G.a,this.reverse();let e=3;const r=Math.max(this.speed,this.currentLength/e);e=this.currentLength/r,this.enqueueGrowing({headSpeed:0,tailSpeed:r/this.speed,length:0}),this.camera.shake=6,this.camera.shakeAmplitude=3,this.camera.shakeOctave=2,this.animator.playProceduralOn(it,e,(t,r)=>{this.camera.shake=N.a.damp(this.camera.shake,0,e,r,.01),this.camera.shakeAmplitude=N.a.damp(this.camera.shakeAmplitude,.2,e,r)}),await this.animator.playProcedural(e+1,(r,i)=>{if(this.light.intensity=N.a.damp(this.light.intensity,0,e,i),this.points.length<=1)return;const n=this.points[0].position;t.position=this.tailDir.mul(this.width/2).plus(n).toVec3(),this.deadParticle.emit(1,t.position)}),this.camera.shake=0,ut.instance.eventEmitter.emit("gameover",this.actualLength)}get head(){return this.bodies[this.bodies.length-1]}get tail(){return this.bodies[0]}get tailDir(){return this.bodies.length>1?Object(V.h)(this.bodies[1],this.bodies[0]).normalize():this.headDir.clone()}}window.Noise=n.a.Noise,window.ZograEngine=s,window.ZograRenderer=v;const ot=document.querySelector("#canvas"),at=ot.getBoundingClientRect();ot.width=at.width,ot.height=at.height;class ut{constructor(t){this.eventEmitter=new o.a,ut.instance=this,this.engine=new a.a(t,u.a),this.engine.renderPipeline.ambientIntensity=.2,this.engine.renderPipeline.msaa=4,this.engine.renderPipeline.renderFormat=h.a.RGBA16F,this.input=new c.a,this.engine.start(),this.engine.on("update",()=>{this.input.update(),this.input.getKeyDown(c.c.F2)&&this.reload()}),window.onresize=()=>{const e=t.getBoundingClientRect();this.engine.renderer.setSize(e.width,e.height)}}async loadAssets(){await L.loadMapAssets(),await async function(){const t={foodSprite:new g.a(await y.a.url(w).then(t=>t.tex2d()),b.b.one(),b.b.zero()),boostSprite:new g.a(await y.a.url(M).then(t=>t.tex2d()),b.b.one(),b.b.zero())};return t.foodSprite.color=new x.a(2,2,2,1),t.boostSprite.color=new x.a(3,3,3,1),Object.assign(O,t),t}()}async reload(){this.engine.scene.destroy();const t=new l.a(d.a);this.engine.scene=t;const e=new S;e.position=Object(f.b)(0,0,20),e.projection=m.b.Orthographic,e.viewHeight=10,t.add(e);const r=new p.a;r.threshold=1,r.softThreshold=.5,e.postprocess.push(r);const i=new L(Math.random());let n;for(t.add(i);;){let t=b.b.math(Math.floor)(b.b.math(Math.random)().mul(1e3)).plus(.5),r=[];for(let e=0;e<10;e++)i.getTile(t.plus(b.b.right()))===L.tileGround?e<4&&r.push(t.clone()):r=[];if(4==r.length){n=new st(r,b.b.right(),e,this.input),e.position=e.position.set(t.toVec3(e.position.z));break}}t.add(n),e.followTarget=n.headEntity,e.position=n.headEntity.position.clone().setZ(20)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}(async()=>{const t=new ut(ot);await t.loadAssets(),t.reload()})()}]);